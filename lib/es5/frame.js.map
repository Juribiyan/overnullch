{"version":3,"sources":["../../babel/src/frame.js"],"names":["_WIKI","_SITENAME","main","parent","allReady","lazyBoy","init","$","ajaxSetup","dataType","on","jq","data","slideToggle","settings","onToggle","click","toggleBehavior","menu","toggle","_frames","layout","_","contains","behavior","open","chans","live","hasClass","attr","router","noFollow","fadeToggle","window","test","navigator","userAgent","injector","inject","makeEscapeTagLiteralFn","fn","v","strings","result","i","length","replace","rx","escapeRegExp","openMenu","close","closeMenu","_open","flatProps","assocProps","allProps","concat","forEach","propGroup","val","LSfetchJSON","param","isEmpty","getChanSpecificPreferences","chid","ret","prop","includes","handleCheck","$ch","toggleClass","find","each","href","push","without","save","toggleAssoc","catname","hasOwnProperty","key","props","localStorage","JSON","stringify","$el","is","match","deleteCategory","$cat","parents","hide","show","restoreCats","deletedCats","handleBoardClick","brd","handleLinkClick","addClass","handleHomeClick","a","removeClass","history","replaceState","own","id","wiki","boards","name","url","build","model","html","reduce","htm","ch","buildChan","insertWidgets","cssCache","lessCompiler","compile","rebuildChan","chan","findIndex","sync","assign","prefix","defaults","hasBoards","userboards","useAnonym","escape","colors","headOnly","showDirs","preventRouterRegistering","register","cats","widgets","supported","wiType","widgetType","widgetID","newWidget","userboards_system","userboards_catname","cachedUserboards","proceedUbrds","ubrds","normalizeUbrds","eq","updateUserboards","get","done","bind","fail","console","error","err","status","http_code","contents","hiddenChans","h","cat","buildCat","flat","catID","hidden","hiddenCats","hiddenCompletely","desc","board","dir","cleanURL","external","postfix","chansCache","fetchPromises","Promise","resolve","reject","getJSON","Date","getTime","origin","myDrafts","myDraftsValid","draft","version","catalogVersions","all","then","versMap","allChans","changed","sect","ver","filter","section","map","remove","warn","removeItem","onlinechans","info","chg","versions","replaceWith","document","querySelectorAll","wph","getAttribute","pool","widget","parentNode","replaceChild","el","postcount","title","boardUri","boardName","boardDescription","postsPerHour","lastPostId","uniqueIps","inactive","tags","uri","subtitle","indexed","sfw","posts_total","time","weight","locale","max","active","pph","ppd","pph_average","ws_board","per_page","pages","max_filesize","max_webm_filesize","max_comment_chars","max_webm_duration","bump_limit","image_limit","cooldowns","meta_description","is_archived","category","default_name","enable_names","enable_sage","last_num","speed","threads","unique_posters","parse","e","res","idClassEscaped","advanced_less","base","less","render","output","css","NodeList","prototype","Array","alias","existing","getElementById","innerHTML","head","getElementsByTagName","style","createElement","type","styleSheet","cssText","appendChild","createTextNode","removeChild","radio","streams","currentStream","saved","volume","stream","$_name","template","$_path","path","mixedRange","n","mime","audio","appendTo","playPause","onloadeddata","$selectWrapper","options","ix","setStream","append","change","value","addJob","$volumeter","buildVolumeter","reflectVolumeChange","setV","setVolume","onCategoryClose","paused","streamID","playing","setAttribute","play","force","networkState","pause","width","height","onchange","baseV","evToVal","ev","down","pageX","$vm","offset","left","buildSVG","cns","createElementNS","tag","svg","classList","add","cls","poly","bg","fg","$w","mousedown","mousemove","input","m","re","exec","index","lastIndex","range","exp","RegExp","split","flatten","currentHash","determineIdentity","guro","indicateOn","$chan","isOWN","decodeURIComponent","$brd","text","event","script_installed","scriptInstalled","frames","location","protocol","host","identity","follow","hash","clearHash","load","execute","que","ready","splice","job","addEventListener","pathname","postMessage","check3d","getComputedStyle","has3d","transforms","t","body","insertBefore","getPropertyValue","transform","update","showForm","scheduleUpdate","textStatus","jqXHR","currentList","responseText","onoff","link","buildLink","description","getDomainName","toggleShare","focus","ms","clearInterval","interval","setInterval"],"mappings":"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","file":"frame.js","sourcesContent":["\"use strict\"\n\nconst _WIKI = 'https://wiki.1chan.ca/'\n, _SITENAME = \"Овернульч\"\n\nfunction main() {\n  parent.allReady()\n\n  lazyBoy.init()\n\n  $.ajaxSetup({ dataType: 'json' })\n\n  // Colorization mode selector\n  $('body')\n  .on('click', '.toggler', function() {\n    $(jq`#${$(this).data('toggle')}`).slideToggle('fast', function() {\n      settings.onToggle($(this))\n    })\n  })\n  \n\n  $('#pinunpin').click(parent.toggleBehavior)\n\n  $('.menu-toggle').click(menu.toggle)\n  $('#menu-show').on('mouseenter', function() {\n    if(parent._frames.layout == 'vertical' && _.contains(['overlay', 'shift'], parent._frames.behavior)) {\n      menu.open()\n    }\n  })\n\n  settings.init()\n  chans.init()\n  live.init()\n\n  $('#refresh').click(function() {\n    if ($(this).hasClass('script-installed')) {\n      parent.$('#main').attr('src', router.noFollow)\n    }\n    else {\n      $('#noscript-warning').fadeToggle('fast')\n    }\n  })\n\n  if (('netscape' in window) && / rv:/.test(navigator.userAgent)) {\n    injector.inject('no-shadow-for-you', `.showlive #live-toggle svg, #live-panel svg {filter: none!important; -webkit-filter: none!important;}`)\n  }\n}\n\n// Produces a function which applies fn() to all values\nfunction makeEscapeTagLiteralFn(fn = v => v) {\n  return function(strings, ...values) {\n    let result = \"\"\n    for (let i = 0; i < strings.length; i++) {\n      result += strings[i]\n      if (i < values.length) {\n        result += fn(''+values[i])\n      }\n    }\n    return result\n  }\n}\n// Escape tag literal functions for jQuery queries and regular expressions\nvar jq = makeEscapeTagLiteralFn(v => v.replace(/([!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^`{|}~ ])/g, \"\\\\$1\"))\n, rx = makeEscapeTagLiteralFn(_.escapeRegExp)\n\nvar menu = {\n  open: function() {\n    parent.openMenu()\n  },\n  close: function() {\n    parent.closeMenu()\n  },\n  toggle: function() {\n    if(parent._open) menu.close()\n    else menu.open()\n  }\n}\n\nvar settings = {\n  flatProps: ['hiddenChans', 'showDirs', 'useAnonym', 'headOnly'],\n  assocProps: ['hiddenCats', 'deletedCats', 'cachedUserboards'],\n  init: function() {\n    this.allProps = this.flatProps.concat(this.assocProps)\n    ;['flatProps', 'assocProps'].forEach((propGroup) => {\n      this[propGroup].forEach(param => {\n        let val = LSfetchJSON(param)\n        this[param] = _.isEmpty(val) ? (propGroup==='flatProps' ? [] : {}) : val\n      })\n    })\n  },\n  getChanSpecificPreferences: function(chid) {\n    let ret = {}\n    this.flatProps.forEach(prop => {\n      ret[prop] = !!_.includes(this[prop], chid)\n    })\n    this.assocProps.forEach(prop => {\n      ret[prop] = this[prop][chid] || []\n    })\n    return ret\n  },\n  handleCheck: function(prop, chid) {\n    let on = !_.includes(this[prop], chid)\n\n    let $ch = $(jq`.chan_${chid}`)\n    if (prop === 'showDirs' || prop === 'headOnly') {\n      $ch.toggleClass(prop, !!on)\n    }\n    if (prop === 'useAnonym') {\n      $ch.find('a[data-href]').each(function() {\n        let href = (on ? 'https://anonym.to?' : '') + $(this).data('href')\n        $(this).attr('href', href)\n      })\n    }\n\n    this.toggle(chid, prop, on)\n\n    return false\n  },\n  toggle: function(chid, prop, on) {\n    if (!on) {\n      this[prop] = _.without(this[prop], chid)\n    }\n    else {\n      this[prop].push(chid)\n    }\n    this.save()\n  },\n  toggleAssoc: function(prop, chid, catname, on) {\n    if (! this[prop].hasOwnProperty(chid)) {\n      if (on) {\n        this[prop][chid] = [catname]\n      }\n    }\n    else {\n      if (on) {\n        this[prop][chid].push(catname)\n      }\n      else {\n        this[prop][chid] = _.without(this[prop][chid], catname)\n      }\n    }\n    this.save()\n    return this[prop][chid].length\n  },\n  save: function(key) {\n    let props = key ? [key] : this.allProps\n    props.forEach(prop => localStorage[prop] = JSON.stringify(this[prop]))\n  },\n  onToggle: function($el) {\n    let on = $el.is(':visible')\n    if ($el.hasClass('boards')) {\n      let chid = $el.attr('id').match(/^boards_(.+)/)[1]\n      this.toggle(chid, 'hiddenChans', !on)\n    }\n    if ($el.hasClass('cat-boards')) {\n      this.toggleAssoc('hiddenCats', $el.data('chid'), $el.data('catname'), !on)\n    }\n  },\n  deleteCategory: function(chid, catname) {\n    let $cat = $(jq`#cat_${chid}_${catname}`).parents('.category')\n    $cat.hide()\n    this.toggleAssoc('deletedCats', chid, catname, true)\n    $cat.parents('.chan').find('.restore-cats').show()\n  },\n  restoreCats: function(chid) {\n    let $ch = $(jq`.chan_${chid}`)\n    $ch.find('.category').show()\n    $ch.find('.restore-cats').hide()\n    if (this.deletedCats.hasOwnProperty(chid)) {\n      this.deletedCats[chid] = []\n      this.save()\n    }\n  }\n}\n\nfunction handleBoardClick(brd) {\n  handleLinkClick(brd)\n  $(brd).addClass('boardover').parents('.chan').addClass('onchan')\n}\n\nfunction handleHomeClick(a) {\n  handleLinkClick(a)\n  $(a).parents('.chan').addClass('onchan')\n}\n\nfunction handleLinkClick(a) {\n  $('.boardover').removeClass('boardover')\n  $('.onchan').removeClass('onchan')\n  if(parent._frames.layout == 'horizontal') {\n    menu.close()\n  }\n  parent.history.replaceState(null, null, `/#/${a.href}`);\n}\n\nvar chans = {\n  own: {\n    own: true,\n    id: '!OWN',\n    wiki: 'Овернульч',\n    boards: [\n      {\n        \"name\": \"\",\n        \"boards\": [\n          /*{\n            \"desc\": \"Метадоска\",\n            \"dir\": \"meta\"\n          },*/\n          {\n            \"desc\": \"Каталог сайтов\",\n            \"dir\": \"catalog\"\n          },\n          {\n            \"desc\": \"Редактор сайтов\",\n            \"dir\": \"editor\"\n          },\n          {\n            \"desc\": \"Ballsmash\",\n            \"dir\": \"mash\"\n          },\n          {\n            \"desc\": \"Библиотека лупов\",\n            \"dir\": \"loops\"\n          }\n        ]\n      }\n    ],\n    // colors:[\"aaaaaa\",\"bbbbbb\"],\n    name: \"Овернульч\",\n    url: '//0chan.one'\n  },\n  build: function(chans) {\n    this.model = chans\n    $('#content').html([this.own].concat(chans).reduce((htm, ch) => htm + this.buildChan(ch), ''))\n    this.insertWidgets()\n    let cssCache = localStorage['compiledCSS']\n    if (cssCache) {\n      injector.inject('framestyles', cssCache)\n    }\n    else {\n      lessCompiler.compile(this.model.concat(this.own))\n    }\n  },\n  rebuildChan: function(chan) {\n    this.model[_.findIndex(this.model, {id: chan.id})] = chan\n    $(jq`.chan_${chan.id}`).html(this.buildChan(chan))\n    this.insertWidgets()\n    this.sync()\n  },\n  buildChan: function(chan) {\n    _.assign(chan, settings.getChanSpecificPreferences(chan.id))\n    if (! (chan.wiki && chan.wiki.match(/https?:\\/\\//))) {\n      chan.wiki = _WIKI+(chan.wiki || chan.name)\n    }\n    if (chan.prefix === '') {\n      delete chan.prefix\n    }\n    _.defaults(chan, this.defaults)\n\n    let hasBoards = (chan.boards && chan.boards.length) || chan.userboards\n    , url = chan.own ? `${chan.url}/index.html` : (((!chan.own && chan.useAnonym) ? 'https://anonym.to?' : '') + chan.url)\n    , name = _.escape(chan.name)\n    , htm = html`\n    <div class=\"chan chan_${chan.id}${!chan.colors ? ' uncolorized' : ''}${chan.headOnly ? ' headOnly' : ''}${chan.showDirs ? ' showDirs' : ''}${!hasBoards ? ' no-boards' : ''}\">\n      <a onclick=\"handleHomeClick(this)\" target=\"main\" href=\"${url}\" class=\"chan-header head-link\" data-href=\"${chan.url}\"${chan.own ? ' onclick=\"router.clearHash()\"' : ''}>\n        <div class=\"chan-name\">${name}</div>\n      </a>\n      <div class=\"chan-header\">\n        <div class=\"chan-name toggler\" data-toggle=\"boards_${chan.id}\">${name}</div>\n      </div>\n      <div class=\"chan-overlay chan-overlay-left\">\n        ${hasBoards ? html`<a onclick=\"handleHomeClick(this)\" class=\"iconic-link home-link\" target=\"main\" href=\"${url}\" data-href=\"${chan.url}\" title=\"Домашняя страница\"${chan.own ? ' onclick=\"router.clearHash()\"' : ''}>\n          <svg class=\"icon\"><use xlink:href=\"#i-home\"></use></svg>\n        </a>` : ''}\n        <a class=\"iconic-link\" target=\"main\" href=\"${chan.wiki}\" title=\"Информация на вики\">\n          <svg class=\"icon\"><use xlink:href=\"#i-info\"></use></svg>\n        </a>\n      </div>\n      <div class=\"chan-overlay chan-overlay-right\">\n        <button class=\"toggler\" data-toggle=\"settings_${chan.id}\" title=\"Меню сайта\">\n          <svg class=\"icon\"><use xlink:href=\"#i-dots\"></use></svg>\n        </button>\n      </div>\n      <div class=\"chan-menu\" style=\"display:none\" id=\"settings_${chan.id}\">\n        <div class=\"settings-entry ifnoboards-hide\">\n          <label for=\"showdirs_${chan.id}\">\n          <input type=\"checkbox\" id=\"showdirs_${chan.id}\" ${chan.showDirs ? 'checked' : ''} onchange=\"settings.handleCheck('showDirs', '${chan.id}')\">\n          <span>Показывать директории</span>\n          </label>\n        </div>\n        <div class=\"settings-entry ifnoboards-hide\">\n          <label for=\"headonly_${chan.id}\">\n          <input type=\"checkbox\" id=\"headonly_${chan.id}\" ${chan.headOnly ? 'checked' : ''} onchange=\"settings.handleCheck('headOnly', '${chan.id}')\">\n          <span>Скрыть доски</span>\n          </label>\n        </div>\n        ${!chan.own ? \n        html`<div class=\"settings-entry\">\n          <label for=\"useanonym_${chan.id}\">\n          <input type=\"checkbox\" id=\"useanonym_${chan.id}\" ${chan.useAnonym ? 'checked' : ''} onchange=\"settings.handleCheck('useAnonym', '${chan.id}')\">\n          <span>Использовать anonym.to</span>\n          </label>\n        </div>\n        <div class=\"settings-entry restore-cats\" ${chan.deletedCats.length ? '' : 'style=\"display:none\"'}>\n          <button class=\"trash-btn\" onclick=\"settings.restoreCats('${chan.id}')\">\n            <svg class=\"icon\">\n              <use class=\"i-trash\" xlink:href=\"#i-trash\"></use>\n              <use class=\"i-trash-open\" xlink:href=\"#i-trash-open\"></use>\n            </svg>\n            <span>Восстановить категории</span>\n          </button>\n        </div>\n        <div class=\"settings-entry\">\n          <button onclick=\"chans.remove('${chan.id}')\">\n            <svg class=\"icon\"><use xlink:href=\"#i-delete\"></use></svg>\n            <span>Удалить из фрейма</span>\n          </button>\n        </div>` : ''}\n      </div>`\n\n    if (!this.preventRouterRegistering) {\n    \trouter.register(chan)\n    }\n\n    let cats = chan.boards\n\n    widgets.supported.forEach(wiType => {\n      if (chan.hasOwnProperty(wiType)) {\n        cats = [{\n          name: widgets[wiType].name,\n          widgetType: wiType,\n          widgetID: widgets[wiType].newWidget(chan[wiType], chan.id)\n        }].concat(cats)\n      }\n    })\n\n    if (chan.userboards) {\n      if (!chan.userboards_system) {\n        chan.userboards_system = 'instant'\n      }\n\n      cats = [{\n        name: chan.userboards_catname,\n        boards: chan.cachedUserboards,\n        userboards: true\n      }].concat(cats)\n\n      let proceedUbrds = data => {\n        let ubrds = normalizeUbrds[chan.userboards_system](data)\n        if (! _.eq(chan.cachedUserboards, ubrds)) {\n          this.updateUserboards(chan, ubrds)\n        }\n      }\n\n      $.get(chan.userboards)\n      .done(proceedUbrds.bind(this))\n      .fail(err => {\n        console.error(err)\n        $.get(`/cors-proxy.php?url=${chan.userboards}`)\n        .done(data => {\n          if(data.status.http_code == 200) {\n            proceedUbrds(data.contents)\n          }\n        })\n        .fail(function(err) {\n          console.error(err)\n        })\n      })\n    }\n\n    if (cats && cats.length) {\n      htm += `<div class=\"boards\" id=\"boards_${chan.id}\" ${chan.hiddenChans ? 'style=\"display:none\"' : ''}>`\n      + cats.reduce((h, cat) => h + this.buildCat(chan, cat, !(cats.length > 1)), '')\n      + '</div>'\n    }\n\n    htm += `</div>`\n\n    return htm\n  },\n  buildCat: function(chan, cat, flat) {\n    cat.name = _.escape(cat.name).replace(' ', ' ')\n    let catID = cat.widgetType ? `!${cat.widgetType}` : cat.name\n    , hidden = _.includes(chan.hiddenCats, catID)\n    , hasBoards = (cat.boards && cat.boards.length)\n    , hide = ' style=\"display:none\"'\n    , hiddenCompletely = (!cat.widgetID && !hasBoards) || _.includes(chan.deletedCats, catID)\n    , htm = `<div class=\"category${cat.userboards ? ' userboards' : ''}\"${hiddenCompletely ? hide : ''}${cat.widgetID ? ` data-widget=\"${cat.widgetID}\"` : ''}>`\n    if (!flat) {\n      htm += html`\n      <div class=\"cat-header toggler\" data-toggle=\"cat_${chan.id}_${catID}\">\n        <div class=\"ch-name\">${cat.name}</div>\n        <div class=\"cat-options\">\n          <svg class=\"icon i-delete del-cat\" onclick=\"event.stopPropagation();settings.deleteCategory('${chan.id}', '${catID}')\"><use xlink:href=\"#i-delete\"></use></svg>\n        </div>\n      </div>`\n    }\n    if (hasBoards || cat.widgetID) {\n      htm += `<div class=\"cat-boards\"${hidden ? hide : ''}${!flat ? ` id=\"cat_${chan.id}_${catID}\" data-chid=\"${chan.id}\" data-catname=\"${catID}\"` : ''}>`\n    }\n    if (hasBoards) {\n      cat.boards.forEach(board => {\n        let desc = _.escape(board.desc)\n        , dir = _.escape(board.dir)\n        , cleanURL = board.external ? board.url : (chan.url + chan.prefix + dir + chan.postfix)\n        , url = (chan.useAnonym ? 'https://anonym.to?' : '') + cleanURL\n        htm += html`\n        <a target=\"main\" href=\"${url}\" class=\"board${board.external ? ' external' : ''}\" data-href=\"${cleanURL}\" data-dir=\"${dir}\" onclick=\"handleLinkClick(this)\">\n          ${board.external ? '' : `<span class=\"board-dir\">/${dir}/ - </span>`}<span class=\"board-name\">${desc}</span>\n        </a>`\n      })\n      htm += '</div>'\n    }\n    if(cat.widgetID) {\n      htm += `<div class=\"widget-placeholder\" id=\"${cat.widgetID}\"></div></div>` // /.widget-placeholder /.cat-boards\n    }\n    \n    htm += `</div>` // /.category\n\n    return htm\n  },\n  defaults: {\n    userboards_catname: '2.0',\n    prefix: '/',\n    postfix: ''\n  },\n  init: function() {\n    // Build frame from cache\n    let chansCache = LSfetchJSON('myChans_new')\n    if (chansCache) {\n      // Style frame from cache\n      this.build(chansCache)\n    }\n    // Get some fress JSON\n    let fetchPromises = [new Promise((resolve, reject) => {\n      $.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\n      .done(data => {\n        data.origin = 'server'\n        resolve(data)\n      })\n      .fail(reject)\n    })]\n    let myDrafts = LSfetchJSON('mydrafts')\n    if (myDrafts && myDrafts.chans) {\n      fetchPromises.push(new Promise((resolve, reject) => {\n        let myDraftsValid = []\n        myDrafts.chans.forEach(draft => {\n          if (draft.name && draft.url) {\n            draft.id = `${draft.id}!draft`\n            myDraftsValid.push(draft)\n          }\n        })\n        resolve({\n          origin: 'drafts',\n          chans: myDraftsValid,\n          version: myDrafts.version || 'unknown'\n        })\n      }))\n    }\n    // Versions from the last update\n    let catalogVersions = LSfetchJSON('catalogVersions')\n    Promise.all(fetchPromises).then(data => {\n      let versMap = {}\n      , allChans = []\n      , changed = []\n      data.forEach(sect => {\n        versMap[sect.origin] = sect.version\n        allChans = allChans.concat(sect.chans)\n        let ver = catalogVersions ? (+catalogVersions[sect.origin] || null) : null\n        if (chansCache && chansCache.length) {\n          // Check if data for currect origin is newer\n          if (ver !== +sect.version) {\n            changed.push({\n              origin: sect.origin,\n              version: sect.version\n            })\n            let filter = sect.origin == 'drafts' ? {section: 'drafts'} : (i => (i.section == 'default' || i.section == 'custom' || i.section == 'offline'))\n            // Update all installed chans\n            _.map(_.filter(chansCache, filter), 'id').forEach(id => {\n              let ch = _.find(sect.chans, {id: id})\n              if (ch) {\n                this.rebuildChan(ch)\n              }\n              else {\n                this.remove(id)\n                console.warn(`Removed unknown chan #${id} from frame`)\n              }\n            })\n          }\n        }\n      })\n      // Register chans in router to properly display name\n      allChans.forEach(router.register.bind(router))\n      this.preventRouterRegistering = true\n\n      if (!(chansCache && chansCache.length)) {\n        localStorage.removeItem('compiledCSS')\n        let onlinechans = _.filter(allChans, 'offline', null)\n        this.build(_.filter(onlinechans, 'included'))\n      }\n      if (changed.length) {\n        // Restyle chans if needed\n        lessCompiler.compile(this.model.concat(this.own))\n        changed.forEach(chg => {\n          console.info(`Updated ${chg.origin}-originated chans' cache to v.=${chg.version}`)\n        })\n      }\n      this.versions = versMap\n      this.sync()\n    })\n  },\n  preventRouterRegistering: false,\n  remove: function(chid) {\n    _.remove(this.model, {id: chid})\n    $(jq`.chan_${chid}`).remove()\n    this.sync()\n    return false\n  },\n  updateUserboards: function(chan, boards) {\n    let cat = {\n      name: chan.userboards_catname,\n      boards: boards,\n      userboards: true\n    }\n    $(jq`.chan_${chan.id} .userboards`).replaceWith(this.buildCat(chan, cat, false))\n    settings.cachedUserboards[chan.id] = boards\n    settings.save('cachedUserboards')\n  },\n  sync: function() {\n    _.each(this.model, ch => delete ch.cachedUserboards)\n    localStorage['catalogVersions'] = JSON.stringify(this.versions)\n    localStorage['myChans_new'] = JSON.stringify(this.model)\n  },\n  insertWidgets: function() {\n    document.querySelectorAll('.widget-placeholder').forEach(wph => {\n      let widgetID = wph.getAttribute('id')\n      if(widgets.pool.hasOwnProperty(widgetID)) {\n        let widget = widgets.pool[widgetID]\n        wph.parentNode.replaceChild(widget.el, wph)\n      }\n    })\n  }\n}\n\nvar normalizeUbrds = {\n  'instant': data => data.map(brd => {\n    if (brd.name) {\n      brd.dir = brd.name\n    }\n    delete brd.postcount\n    delete brd.name\n    return brd\n  }),\n  '0chan': data => data.boards.map(brd => {\n    brd.desc = brd.name\n    delete brd.name\n    return brd\n  }),\n  'meguca': data => data.map(brd => {\n    brd.dir = brd.id\n    brd.desc = brd.title\n    delete brd.title\n    delete brd.id\n    return brd\n  }),\n  'lynxchan': data => data.boards.map(brd => {\n    brd.dir = brd.boardUri\n    brd.desc = brd.boardName\n    delete brd.boardDescription\n    delete brd.postsPerHour\n    delete brd.lastPostId\n    delete brd.uniqueIps\n    delete brd.inactive\n    delete brd.tags\n    return brd\n  }),\n// vichan will work only if board owner enabled vichan's/infinity's/openib's API support\n  'vichan': data => data.map(brd => {\n    brd.dir = brd.uri\n    brd.desc = brd.title\n    delete brd.uri\n    delete brd.title\n    if (brd.subtitle) {\n      delete brd.subtitle\n    }\n    if (brd.indexed) {\n      delete brd.indexed\n    }\n    if (brd.sfw) {\n      delete brd.sfw\n    }\n    if (brd.posts_total) {\n      delete brd.posts_total\n    }\n    if (brd.time) {\n      delete brd.time\n    }\n    if (brd.weight) {\n      delete brd.weight\n    }\n    if (brd.locale) {\n      delete brd.locale\n    }\n    if (brd.tags) {\n      delete brd.tags\n    }\n    if (brd.max) {\n      delete brd.max\n    }\n    if (brd.active) {\n      delete brd.active\n    }\n    if (brd.pph) {\n      delete brd.pph\n    }\n    if (brd.ppd) {\n      delete brd.ppd\n    }\n    if (brd.pph_average) {\n      delete brd.pph_average\n    }\n    return brd\n  }),\n  '4chan': data => data.boards.map(brd => {\n    brd.dir = brd.board\n    brd.desc = brd.title\n    delete brd.board\n    delete brd.title\n    delete brd.ws_board\n    delete brd.per_page\n    delete brd.pages\n    delete brd.max_filesize\n    delete brd.max_webm_filesize\n    delete brd.max_comment_chars\n    delete brd.max_webm_duration\n    delete brd.bump_limit\n    delete brd.image_limit\n    delete brd.cooldowns\n    delete brd.meta_description\n    delete brd.is_archived\n    return brd\n  }),\n  'sosach': data => data.boards.map(brd => {\n    brd.dir = brd.id\n    brd.desc = brd.name\n    delete brd.id\n    delete brd.name\n    delete brd.bump_limit\n    delete brd.category\n    delete brd.default_name\n    delete brd.enable_names\n    delete brd.enable_sage\n    delete brd.info\n    delete brd.last_num\n    delete brd.speed\n    delete brd.threads\n    delete brd.unique_posters\n    return brd\n  })   \n}\n\nfunction LSfetchJSON(key) {\n  let val = null, data = localStorage[key]\n  if (typeof data !== 'undefined') {\n    try {\n      val = JSON.parse(data)\n    }\n    catch(e) {\n      console.error(e)\n      localStorage.removeItem(key)\n    }\n  }\n  return val\n}\n\nvar lessCompiler = {\n  compile: function(chans) {\n    let res = ''\n    chans.forEach(ch => {\n      if (ch.colors) {\n        let idClassEscaped = ('chan_'+ch.id).replace('!', '\\\\!')\n        res += `.${idClassEscaped} { \n          @bgcolor: #${ch.colors[0]};  @linkcolor: #${ch.colors[1]}; `\n          + (ch.advanced_less || this.base) + '}\\n\\n'\n      }\n    })\n    less.render(res, (err, output) => {\n      if (err) {\n        console.error(err)\n      }\n      else {\n        localStorage['compiledCSS'] = output.css\n        injector.inject('framestyles', output.css)\n      }\n    })\n  },\n  base: \"background: @bgcolor; a, .chan-overlay .icon { color: @linkcolor; } &:hover { background: darken(@bgcolor, 8%); } &.onchan { box-shadow: inset -2px 0 fadeout(@linkcolor, 25%); } & when (lightness(@bgcolor) < 70%) { color: #C3C3C3; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: white; } .board:hover { background: rgba(255, 255, 255, .08); } } & when (lightness(@bgcolor) > 70%) { color: #404040; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: black; } .board:hover { background: rgba(0, 0, 0, .08); } }\"\n}\n\nNodeList.prototype.forEach = Array.prototype.forEach\n// NodeList.prototype.map = Array.prototype.map\n\nvar injector = {\n  inject: function(alias, css) {\n    var id = `injector:${alias}`\n    var existing = document.getElementById(id)\n    if (existing) {\n      existing.innerHTML = css\n      return\n    }\n    var head = document.head || document.getElementsByTagName('head')[0]\n    , style = document.createElement('style')\n    style.type = 'text/css'\n    style.id = id\n    if (style.styleSheet) {\n      style.styleSheet.cssText = css\n    } else {\n      style.appendChild(document.createTextNode(css))\n    }\n    head.appendChild(style)\n  },\n  remove: function(alias) {\n    var id = `injector:${alias}`\n    var style = document.getElementById(id)\n    if (style) {\n      var head = document.head || document.getElementsByTagName('head')[0]\n      if (head)\n        head.removeChild(document.getElementById(id))\n    }\n  }\n}\n\nvar widgets = {\n  pool: {},\n  supported: ['radio']\n}\nwidgets.radio = {\n  name: \"Радио\",\n  newWidget: function(props, id) {\n    var widget = {\n      streams: [],\n      currentStream: null,\n      url: props.url, \n      $el: $(`<div class=\"radio-widget disabled\"></div>`)\n    }\n\n    var saved = {\n      volume: +(localStorage[`radio_${id}_volume`] || 1),\n      stream: +(localStorage[`radio_${id}_streamid`] || 0),\n    }\n\n    props.streams.forEach(stream => {\n      if(stream.hasOwnProperty('n')) {\n        var $_name = _.template(stream.name)\n        , $_path = _.template(stream.path)\n        this.mixedRange(stream.n).forEach(n => {\n          widget.streams.push({\n            name: $_name({n: n}),\n            path: $_path({n: n}),\n            mime: stream.mime\n          })\n        })\n      }\n      else\n        widget.streams.push(stream)\n    })\n\n    widget.audio = $('<audio controls>')\n    .appendTo(widget.$el)[0]\n    widget.playPause = this.playPause.bind(widget)\n    widget.audio.volume = saved.volume\n    widget.audio.onloadeddata = () => widget.$el.removeClass('disabled')\n\n    $(html`<div class=\"rw-playpause\">\n      <div class=\"pause-icon\"></div>\n      <div class=\"play-icon\"></div>\n    </div>`)\n    .appendTo(widget.$el)\n    .click(widget.playPause)\n\n    var $selectWrapper = $('<div class=\"select-wrapper\">')\n    var options = []\n    widget.streams.forEach((stream, ix) => {\n      options.push(`<option value=\"${ix}\">${stream.name}</option>`)\n    })\n    widget.setStream = this.setStream.bind(widget)\n    $('<select>')\n    .append(options)\n    .val(saved.stream)\n    .change(function() {\n      widget.setStream(+this.value)\n      localStorage[`radio_${id}_streamid`] = +this.value\n    })\n    .appendTo($selectWrapper)\n    $selectWrapper.appendTo(widget.$el)\n    \n    lazyBoy.addJob(() => widget.setStream(saved.stream))\n \n    var $volumeter = this.buildVolumeter(id, 70, 20, v => {\n       widget.audio.volume = v\n       localStorage[`radio_${id}_volume`] = v\n    }, saved.volume)\n    widget.$el.append($volumeter)\n    widget.reflectVolumeChange = $volumeter.setV\n    widget.setVolume = this.setVolume.bind(widget)\n\n    widget.onCategoryClose = () => {\n      if(!widget.audio.paused)\n        widget.playPause()\n    }\n\n    widget.el = widget.$el[0]\n    widgets.pool[`radio_${id}`] = widget\n    return `radio_${id}`\n  },\n  all: {},\n  setStream: function(streamID, play) {\n    if(this.currentStream === streamID)\n      return\n    var stream = this.streams[streamID]\n    , playing = !this.audio.paused\n    this.audio.setAttribute('src', this.url + stream.path)\n    this.audio.setAttribute('type', stream.mime)\n    if(playing)\n      this.audio.play()\n  },\n  setVolume: function(v) {\n    this.audio.volume = v\n    this.reflectVolumeChange(v)\n  },\n  playPause: function(force) {\n    force = force || null\n    if(this.audio.networkState == 3) {\n      this.audio.pause()\n      this.$el.removeClass('streaming')\n    }\n    else if(this.audio.paused) {\n      $('.radio-widget audio').each(function() {\n        this.pause()\n      })\n      this.audio.play()\n      this.$el.addClass('streaming')\n    }\n    else {\n      this.audio.pause()\n      this.$el.removeClass('streaming')\n    }\n  },\n  buildVolumeter: function(id, width, height, onchange, baseV) {\n    baseV = baseV || 1\n\n    var $vm = $('<div class=\"volumeter\">')\n\n    var buildSVG = cls => {\n      var cns = tag => document.createElementNS(\"https://www.w3.org/2000/svg\", tag)\n\n      var svg = cns('svg')\n      svg.setAttribute('width', width)\n      svg.setAttribute('height', height)\n      svg.setAttribute('viewBox', `0 0 ${width} ${height}`)\n      svg.classList.add(cls)\n\n      var poly = cns('polygon')\n      poly.setAttribute('points', `0,${height} ${width},0 ${width},${height}`)\n      svg.appendChild(poly)\n\n      return svg\n    }\n\n    var bg = buildSVG('vm-bg')\n    , fg = buildSVG('vm-fg')\n\n    var $w = $('<div class=\"vm-fg-wrapper\">')\n    $w[0].appendChild(fg)\n\n    $vm.append($w)\n    $vm[0].appendChild(bg)\n\n    $vm.setV = val => $w.css({width: `${val * width}px`})\n    $vm.setV(baseV)\n\n    var down = false\n\n    function evToVal(ev) {\n      if(down) {\n        var val = (ev.pageX - $vm.offset().left) / width\n        if(val < 0) val = 0\n        if(val > 1) val = 1\n        $vm.setV(val)\n        if(onchange) \n          onchange(val)\n      }\n    }\n\n    $vm.mousedown(function(ev) {\n      down = true\n      evToVal(ev)\n    })\n    \n    $('body')\n    .mousemove(evToVal)\n    .on('mouseup mouseleave blur', ev => {\n      down = false\n    })\n\n    return $vm\n  },\n  mixedRange: function(input) {\n    var m\n    , output = []\n    , re = /(?:([0-9]+)(?:\\-([0-9]+))?(?:, ?)?)/g\n    \n    while ((m = re.exec(input)) !== null) {\n      if (m.index === re.lastIndex) {\n        re.lastIndex++\n      }\n      if(m[2]) {\n        output = output.concat(_.range(m[1], +m[2]+1))\n      }\n      else\n        output.push(+m[1])\n    }\n\n    return output\n  }\n}\n\nvar router = {\n  chans: {},\n  register: function(chan) {\n    this.chans[chan.id] = {\n      exp: new RegExp(rx`^(https?:\\/\\/${chan.url.split(/^https?:\\/\\//)[1] || chan.url})(?:${chan.prefix || chans.defaults.prefix}([^\\/\\?#]+))?`),\n      name: chan.name,\n      boards: _.flatten(_.map(chan.boards, 'boards'))\n    }\n  },\n  currentHash: '',\n  determineIdentity: function(url) {\n    let result = null\n    // console.log('router.chans:', this.chans)\n    _.find(this.chans, (chan, chid) => {\n      // console.log(`Checking ${chid}...`)\n      let guro = chan.exp.exec(url)\n      if (guro !== null) {\n        let dir = guro[2] || null\n        result = {\n          id: chid,\n          name: chan.name\n        }\n        if (dir) {\n          result.dir = dir\n          let brd = _.find(chan.boards, {dir: dir})\n          if (brd) {\n            result.desc = brd.desc\n          }\n        }\n        return 1\n      }\n      else return false\n    })\n    return result\n  },\n  indicateOn: function(i) { \n    let $chan = $(jq`.chan_${i.id}`)\n    , isOWN = (i.id === '!OWN')\n    , title = !isOWN ? i.name : ''\n    $('.onchan').removeClass('onchan')\n    $('.boardover').removeClass('boardover')\n    if($chan.length) {\n      $chan.addClass('onchan')\n    }\n    if (i.dir) {\n      i.dir = decodeURIComponent(i.dir)\n      var $brd = $chan.find(jq`a[data-dir=\"${i.dir}\"]`)\n      if($brd.length) {\n        $brd.addClass('boardover')\n        if (!i.desc) {\n          i.desc = $brd.find('.board-name').text()\n        }\n      }\n      if (i.desc) {\n        title += (!isOWN ? ':' : '') + i.desc\n      }\n    }\n    parent.document.title = (title ? `${title} • ` : '') + _SITENAME\n  },\n  sync: function(event) {\n    if (typeof event.data !== 'string') return;\n\n    if(event.data.match(/overnullchlive\\.html/)) {\n      parent.script_installed = true;\n      scriptInstalled()\n      try {\n        parent.frames.main.scriptInstalled()\n      }\n      catch(e) {  }\n      return\n    }\n    //prevent frame nesting\n    if (event.data.split(/\\/$/)[0] == parent.location.protocol + '//' + parent.location.host) {\n      parent.frames['main'].location.href = '/index.html'\n      this.noFollow = '/index.html'\n      return\n    }\n    //prevent follow\n    router.noFollow = event.data;\n    // set the hash\n    parent.history.replaceState(null, null, '/#/'+event.data)\n    // define chan\n    var identity = router.determineIdentity(event.data)\n    if(identity) {\n      router.indicateOn(identity)\n    }\n    else parent.document.title = _SITENAME;\n  },\n  follow: function() {\n  \tif (parent.location.hash && this.noFollow.split(/#\\/?/)[1] !== parent.location.hash) {\n  \t\tlet url = parent.location.hash.split(/#\\/?/)[1]\n  \t\tparent.frames['main'].location.href = url\n  \t\tthis.noFollow = url\n  \t}\n  },\n  clearHash: function() {\n    parent.document.title = _SITENAME;\n    parent.history.replaceState({}, parent.document.title, \"/\");\n  },\n  noFollow: false\n}\n\nfunction scriptInstalled() {\n  $('#refresh').addClass('script-installed').attr('title', 'Обновить')\n}\n\nvar lazyBoy = {\n  init: function() {\n    $(window).load(this.execute.bind(this))\n  },\n  que: [],\n  execute: function() {\n    this.ready = true\n    while (this.que.length) {\n      this.que.splice(0, 1)[0]()\n    }\n  },\n  addJob: function(job) {\n    if (this.ready) {\n      job()\n    }\n    else {\n      this.que.push(job)\n    }\n  },\n  ready: false\n}\n\nwindow.addEventListener(\"message\", router.sync, false)\n\ntry {\n  if (parent.frames.main.document.location.pathname.match(/catalog/)) {\n    parent.frames.main.window.postMessage('overnullchlive.html', chans.own.url)\n  }\n}\ncatch(e) {}\n\n\nfunction check3d() {\n  if (!window.getComputedStyle) {\n    return false;\n  }\n  \n  var el = document.createElement('p'),\n  has3d,\n  transforms = {\n    'webkitTransform':'-webkit-transform',\n    'OTransform':'-o-transform',\n    'msTransform':'-ms-transform',\n    'MozTransform':'-moz-transform',\n    'transform':'transform'\n  };\n\n  // Add it to the body to get the computed style\n  document.body.insertBefore(el, null);\n\n  for(var t in transforms){\n    if( el.style[t] !== undefined ){\n      el.style[t] = 'translate3d(1px,1px,1px)';\n      has3d = window.getComputedStyle(el).getPropertyValue(transforms[t]);\n    }\n  }\n\n  document.body.removeChild(el);\n\n  return (has3d !== undefined && has3d.length > 0 && has3d !== \"none\");\n}\n\nvar live = {\n  init: function() {\n    let transform = `transform: translate${check3d() ? '3d' : ''}(-50%${check3d() ? ',0,0' : ''});`\n    injector.inject('paneshift', `.showlive .pane-container { ${transform} -o-${transform} -webkit-${transform} -moz-${transform} -ms-${transform} }`)\n    this.update()\n    $('#live-toggle').click(() => {\n      if(parent._frames.layout == 'horizontal' && !parent._open) {\n        menu.open()\n        this.toggle(true)\n        return\n      }\n      this.toggle()\n    })\n    $('#live-add').click(this.showForm.bind(this))\n    $('#live-refresh').click(this.update.bind(this))\n    this.scheduleUpdate(60 * 1000)\n  },\n  update: function() {\n    $.get(`/live/live.json?v=${new Date().getTime()}`)\n    .done((data, textStatus, jqXHR) => {\n      if (this.hasOwnProperty('currentList') && this.currentList === jqXHR.responseText) {\n        return\n      }\n      this.build(data)\n      this.currentList = jqXHR.responseText\n    })\n  },\n  toggle: function(onoff) {\n    $('body').toggleClass('showlive', onoff)\n  },\n  build: function(data) {\n    $('#live-content').html(data.reduce((htm, link) => htm + this.buildLink(link), ''))\n  },\n  buildLink: function(link) {\n    return html`<a target=\"main\" href=\"${_.escape(link.url)}\" class=\"board external\" onclick=\"handleBoardClick(this)\">\n      <span class=\"board-name\">${_.escape(link.description)}</span>\n      <span class=\"link-domain\">${_.escape(this.getDomainName(link.url))}</span>\n    </a>`\n  },\n  showForm: function() {\n    if (parent._frames.layout == 'horizontal') {\n      menu.close()\n    }\n    parent.frames.live.$('#url').val(parent.location.hash.split(/^#\\/?/)[1])\n    parent.toggleShare()\n    parent.frames.live.$('#description').focus()\n  },\n  getDomainName: url => url.match(/^https?:\\/\\/(?:www\\.)?([^\\/#\\?]+)/i)[1],\n  scheduleUpdate: function(ms) {\n    clearInterval(this.interval)\n    this.interval = setInterval(this.update.bind(this), ms)\n  }\n}\n"]}