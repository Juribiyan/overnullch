{"version":3,"file":"editor.js","names":["IS_ADMIN","max_ball_size","width","height","main","saveAsNewDraft","libchan","setMode","drafts","submit","LSfetchJSON","$","addClass","toggleClass","localStorage","setTimeout","injector","inject","ajaxSetup","dataType","each","prepend","append","$tipper","parents","find","showErrors","mkErrorShower","errorDescriptors","attr","patternRX","RegExp","validate","silent","isDraft","Promise","resolve","reject","$this","val","errors","trim","maxlength","minlength","length","push","match","vconv","data","validations","hasOwnProperty","prop","finalize","setTipperState","afterValid","then","err","on","$sect","_","noop","change","gradient","update","bind","click","$use","minus","indexOf","_from","_to","_ref","id","tree","addBoard","removeBoard","$cat","hasClass","removeCategory","removeClass","addCategory","isMouseDown","radio","removeStream","focus","validateUI","load","_libdata","ev","preventDefault","stopPropagation","clearTimeout","offTimeout","currentTarget","target","$ch","parent","downloadJSON","ball","handleFile","getData","toggleView","text","removeAttribute","setAttribute","inc","override","clearInterval","incrementor","$input","offset","setInterval","validateJSON","styles","html","preamble","base","bindID","$b","jq","trigger","window","updateBindings","$area","slideDown","preValue","refreshCaptcha","ctrlKey","altKey","toggle","addStream","Sortable","create","document","querySelector","handle","animation","toggleLib","lastTab","tabID","$lib","f","replace","toLowerCase","remove","upForm","init","getJSON","Date","getTime","done","library","build","chans","clear","clone","current","switch_lang","Math","random","make","direction","stop1","stop2","prefixify","input","res","exec","rest","without","gradientDirection","ret","gradientType","isNaN","parseFloat","gradientStops","prefix","getValue","grad","alias","css","existing","getElementById","innerHTML","head","getElementsByTagName","style","createElement","type","styleSheet","cssText","appendChild","createTextNode","removeChild","originalEvent","files","dataTransfer","reader","FileReader","onload","e","setBall","result","readAsDataURL","chan","src","section","_id","ballv","$ball","one","file","fType","map","pos","sign","abs","catbg","stop","jscolor","fromString","toDataURL","getDataUri","top","left","cats","htm","JSON","parse","isFlat","name","boards","forEach","cat","buildCat","querySelectorAll","makeBoardsSortable","stringify","deconstruct","boardHeight","addBoardButtonHeight","buildBoards","empty","maxHeight","escape","brd","buildBoard","escHTML","external","dir","url","desc","recalcHeight","$brds","jQuery","n","px","$btn","board","$parent","el","group","onAdd","from","to","shake","obj","keys","r","allDirs","walkCat","catNames","dupCats","findDuplicates","$cats","i","dupDirs","$dirs","k","join","flat","$boards","$desc","$dir","$name","JSON_valid","errs","Array","$msgbox","any","mul","reduce","er","HTMLElement","fn","state","arr","dubs","role","vars","v","bgColor","linkColor","callback","userCode","parseInput","lessCode","less","render","message","colors","c","advanced_less","lessFormatter","minify","succ","errors_found","brackets","isBalanced","str","bracket","openBrackets","isClean","len","pop","reset","field","buildStream","strm","path","mime","$strm","streams","hide","proceed","$streams","stream","$range","mixedRange","dupProps","pluck","$inputs","addChan","offline","memoizeOrder","onEnd","reorder","sortingData","buildChan","console","error","ballSrc","search","wiki","dlbtn","order","$chan","fresh","appendTo","highlight","libdata","editChan","assign","replaceWith","deleteChan","sect","getOrder","call","ch","dataset","memoizedOrder","newOrder","oldOrder","rebuild","included","userboards","userboards_catname","userboards_system","postfix","show","prettify","rinse","_schema","integrity","required","optional","adminOnly","specialComps","pairs","objects","isNewBall","conversions","toFile","defaults","fns","eq","first","second","vals","cur","nu","toBlob","schema","props","intCls","cmpCls","eqFn","convCls","conv","defCls","mode","collectData","dataPromises","pr","treeToUI","validUI","admy","all","proceedWithData","isUpload","fd","FormData","propSchema","apnd","uniq","DO_DEBUG","log","value","w","model","lsDrafts","parsed","Error","removeItem","splice","findIndex","sync","add","edit","edited","version","newid","guro","draft","css_beautify","urlencode","encodeURI","checkuniq","get","encodeURIComponent","fail","NodeList","prototype","Blob","inspect","entries","pair","fr","String","split","bstr","atob","u8arr","Uint8Array","charCodeAt","image","Image","canvas","naturalWidth","naturalHeight","getContext","drawImage","m","output","re","index","lastIndex","concat","range","$form","actorFieldMap","fields","actor","fieldActorMap","draftDelete","checkFields","action","candidate","send","request","XMLHttpRequest","open","_this","status","response","warn","unbusy","handleResponse","admin","msg","includes","messages","filter","moveto","added","makeEscapeTagLiteralFn","key","dlAnchorElem"],"sources":["../../babel/src/editor.js"],"sourcesContent":["\"use strict\";\r\n\r\nvar IS_ADMIN = false;\r\n\r\nconst max_ball_size = {width: 300, height: 300}\r\n\r\nconst main = () => {\r\n\tif(LSfetchJSON('IS_ADMIN')) {\r\n\t\tIS_ADMIN = true\r\n\t\t$('body').addClass('is-admin')\r\n\t}\r\n\r\n\t$('#chan-library').toggleClass('expanded', localStorage['chanlib-expanded'] == 1)\r\n\tsetTimeout(() => injector.inject('lib-collapse', `.collapsible-content {  transition: width 0.3s; }`), 100)\r\n\r\n\t$.ajaxSetup({\r\n\t\tdataType: 'json'\r\n\t})\r\n\r\n\t$('.tipper').each(function() {\r\n\t\t$(this).prepend(`\r\n\t\t\t<svg class=\"icon t-i-q\"><use xlink:href=\"#i-question\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-e\"><use xlink:href=\"#i-warning\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-s spinning\"><use xlink:href=\"#i-spinner\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-ok\"><use xlink:href=\"#i-check\"></use></svg>`)\r\n\t})\r\n\t.append(`<div class=\"tooltip-wrap error-msg\"><div class=\"tooltip\"></div></div>`)\r\n\t\r\n\t$('.validable')\r\n\t.each(function() {\r\n\t\tlet $tipper = $(this).parents('.tip-container').find('.tipper')\r\n\t\tthis.showErrors = mkErrorShower($tipper)\r\n\t\tthis.errorDescriptors = {\r\n\t\t\t'too-long': 'Слишком длинное значение поля',\r\n\t\t\t'too-short': 'Слишком короткое значение поля',\r\n\t\t\t'invalid': 'Неверный формат данных',\r\n\t\t\t'missing': 'Поле обязательно для ввода',\r\n\t\t\t'occupied': 'Значение занято'\r\n\t\t}\r\n\t\tif ($(this).attr('pattern'))\r\n\t\t\tthis.patternRX = new RegExp($(this).attr('pattern'))\r\n\t\tthis.validate = (silent, isDraft) => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlet $this = $(this)\r\n\t\t\t\t, val = $this.val()\r\n\t\t\t\t, errors = []\r\n\r\n\t\t\t\tval = val.trim()\r\n\t\t\t\t$this.val(val)\r\n\r\n\t\t\t\tif (val) {\r\n\t\t\t\t\tlet maxlength = $this.attr('maxlength')\r\n\t\t\t\t\t, minlength = $this.attr('minlength')\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (minlength && val.length < minlength)\r\n\t\t\t\t\t\terrors.push(`Слишком короткое значение поля (нужно минимум ${minlength} симв.)`)\r\n\r\n\t\t\t\t\tif (this.patternRX && !val.match(this.patternRX)) \r\n\t\t\t\t\t\terrors.push('invalid')\r\n\r\n\t\t\t\t\tlet vconv = $this.data('valconvert')\r\n\t\t\t\t\tif (vconv && validations.hasOwnProperty(vconv)) {\r\n\t\t\t\t\t\tval = validations[vconv](val)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (maxlength && val.length > maxlength)\r\n\t\t\t\t\t\terrors.push(`Превышена макс. длина поля (${maxlength} символов)`)\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif ($(this).prop('required')) {\r\n\t\t\t\t\t\terrors.push('missing')\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet finalize = () => {\r\n\t\t\t\t\tif (! silent)\r\n\t\t\t\t\t\tthis.showErrors(errors)\r\n\t\t\t\t\tif (! errors.length) {\r\n\t\t\t\t\t\t$tipper.setTipperState('valid')\r\n\t\t\t\t\t\tresolve(val)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (isDraft)\r\n\t\t\t\t\t\t\tresolve(val)\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject(errors)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet afterValid = $this.data('aftervalid')\r\n\t\t\t\tif (! errors.length) {\r\n\t\t\t\t\t$tipper.setTipperState('spinner')\r\n\t\t\t\t\tif (afterValid && validations[afterValid]) {\r\n\t\t\t\t\t\tvalidations[afterValid](val, $this.data('uniq'))\r\n\t\t\t\t\t\t.then(() => finalize(), err => {\r\n\t\t\t\t\t\t\terrors.push(err)\r\n\t\t\t\t\t\t\tfinalize()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse finalize()\r\n\t\t\t\t}\r\n\t\t\t\telse finalize()\r\n\t\t\t})\r\n\t\t}\r\n\t})\r\n\t.on('focus', function() {\r\n\t\tlet $this = $(this)\r\n\t\t, $sect = $this.parents('.tip-container')\r\n\t\t, $tipper = $sect.find('.tipper')\r\n\t})\r\n\r\n\t$('.validable:not(.no-val-onblur)').on('blur', function() { \r\n\t\tthis.validate().then(_.noop, _.noop)\r\n\t})\r\n\t\r\n\t$('#color-selector .colorbox').change(gradient.update.bind(gradient))\r\n\r\n\t$('#change-direction').click(function() {\r\n\t\tlet $use = $(this).find('use')\r\n\t\t, minus = $use.attr('transform').indexOf('-90') < 0\r\n\t\t$use.attr('transform', `rotate(${minus ? '-' : ''}90 8 8)`)\r\n\t\tvar _from = $('#bgc-from')[0], _to = $('#bgc-to')[0];\r\n\t\tvar _ref = [_to.id, _from.id];\r\n\t\t_from.id = _ref[0];\r\n\t\t_to.id = _ref[1];\r\n\t\tgradient.update()\r\n\t})\r\n\r\n\t$('body')\r\n\t.on('click', '.add-board', function() {\r\n\t\ttree.addBoard($(this))\r\n\t})\r\n\t.on('click', '.delboard', function() {\r\n\t\ttree.removeBoard($(this))\r\n\t})\r\n\t.on('click', '.delcat', function() {\r\n\t\tlet $cat = $(this).parents('.tree-cat')\r\n\t\tif ($cat.hasClass('predelete') || $cat.hasClass('empty'))\r\n\t\t\ttree.removeCategory($(this))\r\n\t\telse\r\n\t\t\t$cat.addClass('predelete')\r\n\t})\r\n\t.on('click', '.cat-undelete', function() {\r\n\t\t$(this).parents('.tree-cat').removeClass('predelete')\r\n\t})\r\n\t.on('click', '.f-minus, .f-plus', function() {\r\n\t\t$(this).parents('.tree-cat').toggleClass('hidden')\r\n\t})\r\n\t.on('click', '.add-cat', tree.addCategory.bind(tree))\r\n\t.on('input', '.board-dir', function() {\r\n\t\t$(this).parents('.cat-brd').toggleClass('external', !! $(this).val().match(/^https?:\\/\\//))\r\n\t})\r\n\t.on('mouseup mouseleave blur touchend touchcancel', function(ev) {\r\n\t\tisMouseDown = false\r\n\t})\r\n\t.on('click', '.delstream', function() { radio.removeStream($(this)) })\r\n\t.on('click', '.templatize', function() {\r\n\t\t$(this).parents('.stream').toggleClass('templated').find('.stream-range').focus()\r\n\t})\r\n\t.on('blur', '#tree input', tree.validateUI.bind(tree))\r\n\t.on('click', '.lib-chan', function() {\r\n\t\tlibchan.load(this._libdata)\r\n\t})\r\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tev.stopPropagation()\r\n\t})\r\n\t.on('dragenter', function(ev) {\r\n\t\t$(this).addClass('dropping')\r\n\t\tclearTimeout(this.offTimeout)\r\n\t})\r\n\t.on('dragend drop dragleave', function(ev) {\r\n\t\tif (ev.currentTarget === ev.target) {\r\n\t\t\tthis.offTimeout = setTimeout(() => {\r\n\t\t\t\t$(this).removeClass('dropping')\r\n\t\t\t}, 100)\r\n\t\t}\r\n\t})\r\n\t.on('click', '.export-draft', function(ev) {\r\n\t\tev.stopPropagation()\r\n\t\tlet $ch = $(this).parent('.lib-chan')\r\n\t\t, data = $ch[0]._libdata\r\n\t\tdownloadJSON(data, data.id)\r\n\t})\r\n\r\n\t$('.chanball-wrap')\r\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tev.stopPropagation()\r\n\t})\r\n\t.on('dragenter dragover', function(ev) {\r\n\t\t$(this).addClass('file-over')\r\n\t\tclearTimeout(this.offTimeout)\r\n\t})\r\n\t.on('dragend drop dragleave', function(ev) {\r\n\t\tthis.offTimeout = setTimeout(() => {\r\n\t\t\t$(this).removeClass('file-over')\r\n\t\t}, 100)\r\n\t})\r\n\t.on('drop', ball.handleFile.bind(ball))\r\n\r\n\t$('#radio-editor').on('blur', 'input', () => {\r\n\t\tradio.getData().then(_.noop, _.noop)\r\n\t})\r\n\r\n\tvar isMouseDown = false\r\n\r\n\t$('.chanball-dropzone').click(() => $('#chanballFileInput').click())\r\n\t$('#chanballFileInput').on('change', ball.handleFile.bind(ball))\r\n\r\n\t$('#view-toggle .switch-body').click(() => tree.toggleView())\r\n\t$('#view-toggle label').click(function(ev) {\r\n\t\ttree.toggleView($(this).text())\r\n\t})\r\n\r\n\t$('#reup-chanball').click(() => {\r\n\t\t$('#chanballFileInput').click()\r\n\t})\r\n\r\n\t$('.password-reveal').on('mousedown', function() {\r\n\t\t$(this).parent().find('input').attr('type', 'text')\r\n\t})\r\n\t.on('mouseleave mouseup', function() {\r\n\t\t$(this).parent().find('input').attr('type', 'password')\r\n\t});\r\n\r\n\t$('#pswd').on('focus', function() {\r\n\t\tthis.removeAttribute('readonly')\r\n\t})\r\n\t.on('blur', function() {\r\n\t\tthis.setAttribute('readonly', true)\r\n\t})\r\n\r\n\t$('.cb-position-tweaker button')\r\n\t.on('mousedown touchstart', function() {\r\n\t\tisMouseDown = true\r\n\t\tlet inc = override => {\r\n\t\t\tif (!override && !isMouseDown)\r\n\t\t\t\treturn clearInterval(this.incrementor)\r\n\t\t\tlet $input = $(this).parent().find('input')\r\n\t\t\t, inc = +$(this).data('inc')\r\n\t\t\t$input.val(+$input.val() + inc)\r\n\t\t\tball.offset()\r\n\t\t}\r\n\t\tinc(true)\r\n\t\tthis.incrementor = setInterval(inc, 150)\r\n\t})\r\n\t.parent().find('input').on('input paste change', ball.offset)\r\n\r\n\t$('#tree-json').on('blur', function() {\r\n\t\ttree.validateJSON()\r\n\t})\r\n\r\n\t$('#chan-name').on('input paste change', function() {\r\n\t\t$('.channame-overlay').text($(this).val())\r\n\t})\r\n\r\n\t$('#color-theme input.color').change(styles.update.bind(styles))\r\n\t$('#less-enter').on('input', styles.update.bind(styles))\r\n\r\n\t$('#less-preamble').html(styles.preamble('html'))\r\n\t$('#less-enter').val(styles.base)\r\n\r\n\t$('.binded').each(function() {\r\n\t\tlet $this =  $(this)\r\n\t\t, bindID = $this.data('bind')\r\n\t\t, $b = $(jq`#${bindID}`)\r\n\t\tif (! $b.length) return;\r\n\t\t$b.on('input change paste', function() {\r\n\t\t\t$this.text($(this).val() || `{${bindID}}`)\r\n\t\t}).trigger('change')\r\n\t})\r\n\twindow.updateBindings = () => {\r\n\t\t$('.binded').each(function() {\r\n\t\t\t$(jq`#${$(this).data('bind')}`).trigger('change')\r\n\t\t})\r\n\t}\r\n\r\n\t$('#advance-less').change(function() {\r\n\t\tlet $area = $('#less-enter');\r\n\t\tif ($(this).prop('checked')) {\r\n\t\t\t$('.advanced-less').slideDown(() => {\r\n\t\t\t\t$area.prop('disabled', 0)\r\n\t\t\t\tif ($area[0].preValue)\r\n\t\t\t\t\t$area.val($area[0].preValue)\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$area[0].preValue = $area.val()\r\n\t\t\t$area.val(styles.base).prop('disabled', 1)\r\n\t\t}\r\n\t\tstyles.update()\r\n\t})\r\n\r\n\t$('.captcha').addClass('not-loaded').click(ev => refreshCaptcha(ev.ctrlKey || ev.altKey))\r\n\t\r\n\t$('.widget-list input').on('change', function() {\r\n\t\t$(jq`#${$(this).attr('name')}`).toggle($(this).prop('checked'))\r\n\t})\r\n\r\n\t$('.expander').click(function() {\r\n\t\t$(this).parents('.expandee').toggleClass('expanded')\r\n\t})\r\n\r\n\t$('#onchan').on('change', function() {\r\n\t\t$('.chan').toggleClass('onchan', $(this).prop('checked'))\r\n\t})\r\n\r\n\tstyles.update()\r\n\r\n\t$('#add-stream').click(radio.addStream.bind(radio))\r\n\r\n\tSortable.create(document.querySelector('#categories'), {\r\n\t\thandle: '.cat-dragger',\r\n\t\tanimation: 150\r\n\t})\r\n\r\n\tSortable.create(document.querySelector('#streams'), {\r\n\t\thandle: '.dragger',\r\n\t\tanimation: 150\r\n\t})\r\n\r\n\t$('.sidebar').click(toggleLib)\r\n\r\n\tlet lastTab = 'default'\r\n\t$('.tab').click(function() {\r\n\t\tlet tabID = $(this).data('tab')\r\n\t\t, $lib = $('#chan-library')\r\n\t\t, f = false\r\n\t\tif (tabID === 'search') {\r\n\t\t\tif ($lib.hasClass('show-search'))\r\n\t\t\t\ttabID = lastTab\r\n\t\t\telse\r\n\t\t\t\tf = true\r\n\t\t}\r\n\t\telse lastTab = tabID\r\n\t\t$lib.find('.tab').removeClass('selected')\r\n\t\t$lib.find(`.tab[data-tab=${tabID}]`).addClass('selected')\r\n\t\t$lib.removeClass('show-custom show-offline show-default show-drafts show-search').addClass(`show-${tabID}`)\r\n\t\tf && $('#searchbox').focus()\r\n\t})\r\n\r\n\t$('#searchbox').on('input paste', function() {\r\n\t\tlet val = $(this).val().trim().replace(/\\\"/g, '\\\\\"').toLowerCase()\r\n\t\tif (val.length)\r\n\t\t\tinjector.inject('lib-search', `.show-search .lib-chan[data-search *= \"${val}\"] {height: 40px}`)\r\n\t\telse\r\n\t\t\tinjector.remove('lib-search')\r\n\t})\r\n\r\n\tupForm.init()\r\n\r\n\t$.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\r\n\t.done(data => library.build(data.chans)) \r\n\r\n\t$('#new-chan').click(() => libchan.clear())\r\n\t$('#clone-this').click(() => libchan.clone())\r\n\t$('#publish').click(() => upForm.toggle('upload'))\r\n\t$('#delete-this').click(() => upForm.toggle('delete'))\r\n\t$('#save-draft').click(() => drafts.submit())\r\n\r\n\tfunction saveAsNewDraft() {\r\n\t\tlibchan.setMode('new', 'drafts')\r\n\t\tdrafts.submit(1)\r\n\t\treturn false\r\n\t}\r\n\t$('#draft-saveasnew').click(saveAsNewDraft)\r\n\t$('#draft-changeid').click(() => {\r\n\t\tdrafts.remove(libchan.current.id)\r\n\t\tsaveAsNewDraft()\r\n\t})\r\n\t$('#draft-savemodifiedid').click(() => {\r\n\t\t$('#chan-id').val($('#proposed-id').text())\r\n\t\tdrafts.submit()\r\n\t\treturn false\r\n\t})\r\n\t$('#draft-overwrite').click(() => {\r\n\t\tdrafts.remove($('#id-to-overwrite').text())\r\n\t\tdrafts.submit()\r\n\t\treturn false\r\n\t})\r\n\r\n\tdrafts.load()\r\n}\r\n\r\nfunction refreshCaptcha(switch_lang=false) {\r\n\t$('.captcha').attr('src', `/captcha.php?color=255,255,255&v=${Math.random()}${switch_lang ? '&switch' : ''}`).removeClass('not-loaded')\r\n\t$('#captcha').val('')\r\n}\r\n\r\nfunction toggleLib(on) {\r\n\t$('#chan-library').toggleClass('expanded', on)\r\n\tlocalStorage['chanlib-expanded'] = +$('#chan-library').hasClass('expanded')\r\n}\r\n\r\nvar gradient = {\r\n\tmake: (direction, stop1, stop2) =>\r\n\t\t(direction !== 'radial') \r\n\t\t\t? `linear-gradient(to ${direction}, ${stop1} 0%, ${stop2} 100%)`\r\n\t\t\t: `radial-gradient(ellipse at center, ${stop1} 0%, ${stop2} 100%)`,\r\n\tprefixify: function(input) {\r\n\t\tvar res = /(((?:radial|linear)-gradient)\\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\\));?/i.exec(input);\r\n\t\tif (res === null) return 'background:' + input;\r\n\t\tres = _.rest(_.without(res, undefined));\r\n\t\tvar ret = res[0]+'; ';\r\n\t\tvar gradientType = res[1];\r\n\t\tvar gradientDirection;\r\n\t\tif (!isNaN(res[2])) gradientDirection = (90 - parseFloat(res[2])) + 'deg, ';\r\n\t\telse if (res[2] == 'bottom') gradientDirection = 'top, ';\r\n\t\telse if (res[2] == 'right') gradientDirection = 'left, ';\r\n\t\telse gradientDirection = 'center, ellipse cover, ';\r\n\t\tvar gradientStops = res[3];\r\n\t\t_.each(['-o-', '-webkit-', '-moz-'], function(prefix) {\r\n\t\t\tret += 'background:' + prefix + gradientType + '(' + gradientDirection + gradientStops + '); ';\r\n\t\t});\r\n\t\treturn 'background:' + ret;\r\n\t},\r\n\tgetValue: function() {\r\n\t\tlet stop1 = '#' + $('#bgc-from').val()\r\n\t\t, stop2 = '#' + $('#bgc-to').val()\r\n\t\treturn this.make('bottom', stop1, stop2)\r\n\t},\r\n\tupdate: function() {\r\n\t\tlet grad = this.getValue()\r\n\t\tinjector.inject('chanball-background', `.chanball-wrap { ${this.prefixify(grad)} }`)\r\n\t}\r\n}\r\n\r\nvar injector = {\r\n\tinject: function(alias, css) {\r\n\t\tvar id = `injector:${alias}`\r\n\t\tvar existing = document.getElementById(id)\r\n\t\tif (existing) {\r\n\t\t\texisting.innerHTML = css\r\n\t\t\treturn\r\n\t\t}\r\n\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t, style = document.createElement('style');\r\n\t\tstyle.type = 'text/css'\r\n\t\tstyle.id = id\r\n\t\tif (style.styleSheet) {\r\n\t\t\tstyle.styleSheet.cssText = css\r\n\t\t} else {\r\n\t\t\tstyle.appendChild(document.createTextNode(css))\r\n\t\t}\r\n\t\thead.appendChild(style)\r\n\t},\r\n\tremove: function(alias) {\r\n\t\tvar id = `injector:${alias}`\r\n\t\tvar style = document.getElementById(id)\r\n\t\tif (style) {\r\n\t\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t\tif (head)\r\n\t\t\t\thead.removeChild(document.getElementById(id))\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar ball = {\r\n\thandleFile: function(ev) {\r\n\t\tev.stopPropagation()\r\n\t\tev.preventDefault()\r\n\t\tev = ev.originalEvent\r\n\r\n\t\t$('body').removeClass('dropping')\r\n\r\n\t\tlet files = (ev.type == \"drop\") ? ev.dataTransfer.files : ev.target.files\r\n\t\t, f = files[0]\r\n\r\n\t\tif (f && f.type == 'image/png') {\r\n\t\t\tvar reader = new FileReader()\r\n\t\t\t\r\n\t\t\treader.onload = (function(theFile) {\r\n\t\t\t\treturn (function(e) {\r\n\t\t\t\t\tthis.setBall(e.target.result)\r\n\t\t\t\t}).bind(this)\r\n\t\t\t}).bind(this)(f)\r\n\r\n\t\t\treader.readAsDataURL(f)\r\n\t\t}\r\n\t\telse if(f)\r\n\t\t\tthis.showErrors('image-not-png')\r\n\t},\r\n\tsetBall: function(chan) {\r\n\t\tlet src\r\n\t\tif (typeof chan === 'string') {\r\n\t\t\tsrc = chan\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (! chan.ball) {\r\n\t\t\t\tif(chan.section !== 'drafts') {\r\n\t\t\t\t\tsrc = `/chans/balls/${chan.section}/${chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.clear()\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsrc = chan.ball\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet $ball = $('#chanball').attr('src', src)\r\n\t\t$ball.one('load', () => {\r\n\t\t\tif ($ball.width() > max_ball_size.width || $ball.height > max_ball_size.height) \r\n\t\t\t\tthis.showErrors('image-too-large')\r\n\t\t\telse {\r\n\t\t\t\tthis.file = src\r\n\t\t\t\tthis.fType = src.indexOf('data:') === 0 ? 'dataURL' : 'file'\r\n\t\t\t\tthis.showErrors([])\r\n\t\t\t\t$('#chanball-sect').addClass('chanball-present')\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tgradient.update()\r\n\t},\r\n\tclear: function() {\r\n\t\t$('#chanball-sect').removeClass('chanball-present')\r\n\t\tthis.file = null\r\n\t},\r\n\tgetData: function(isDraft) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet errors = []\r\n\t\t\tif (!this.file)\r\n\t\t\t\terrors.push('no-file')\r\n\t\t\t\r\n\t\t\tlet offset = ['left', 'top'].map(pos => {\r\n\t\t\t\tlet $input = $(jq`#position-tweak-${pos}`)\r\n\t\t\t\t, val = +$input.val()\r\n\t\t\t\tif (isNaN(val))\r\n\t\t\t\t\tval = 0\r\n\t\t\t\tif (Math.abs(val) > 100)\r\n\t\t\t\t\tval = 100 * Math.sign(val)\r\n\t\t\t\t$input.val(val)\r\n\t\t\t\treturn val\r\n\t\t\t})\r\n\r\n\t\t\t, catbg = ['from', 'to'].map(stop => {\r\n\t\t\t\tlet $input = $(jq`#bgc-${stop}`)\r\n\t\t\t\t, val = $input.val()\r\n\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\r\n\t\t\t\t\tval = 'ffffff'\r\n\t\t\t\t\t$input[0].jscolor.fromString(val)\r\n\t\t\t\t}\r\n\t\t\t\treturn val\r\n\t\t\t})\r\n\r\n\t\t\tthis.offset()\r\n\t\t\tgradient.update()\r\n\r\n\t\t\tthis.showErrors(errors)\r\n\r\n\t\t\tif (errors.length && !isDraft) \r\n\t\t\t\treject(errors)\r\n\t\t\telse resolve({\r\n\t\t\t\tball: this.fType === 'file' ? 'default' : this.file,\r\n\t\t\t\toffset: offset,\r\n\t\t\t\tcatbg: catbg\r\n\t\t\t})\r\n\t\t})\r\n\t\t\r\n\t},\r\n\ttoDataURL: function() {\r\n\t\tif (this.fType == 'data' || !this.file)\r\n\t\t\treturn\r\n\t\tgetDataUri(this.file, data => {\r\n\t\t\tthis.file = data,\r\n\t\t\tthis.fType = 'data'\r\n\t\t})\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'no-file': 'Изображение отсутствует',\r\n\t\t'image-not-png': 'Неверный тип файла (должен быть PNG)',\r\n\t\t'image-too-large': 'Размер файла не должен превышать 200 пкс',\r\n\t\t'upload-error': 'Ошибка при сохраненнии файла'\r\n\t},\r\n\tfile: null, fType: null,\r\n\toffset: function() {\r\n\t\tlet top = +$('#position-tweak-top').val(),\r\n\t\tleft = +$('#position-tweak-left').val()\r\n\t\t$('#chanball').css({\r\n\t\t\t'transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-webkit-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-ms-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-moz-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-o-transform': `translate(${left}px, ${top}px)`\r\n\t\t})\r\n\t\treturn [top, left]\r\n\t},\r\n\tshowErrors: mkErrorShower('ball')\r\n}\r\n\r\nvar tree = {\r\n\tbuild: function(cats) {\r\n\t\tvar htm= ''\r\n\t\tif (cats) {\r\n\t\t\tif(typeof cats === 'string') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcats = JSON.parse(cats)\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tthis.toggleView('JSON', true)\r\n\t\t\t\t\t$('#tree-json').val(cats)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (cats.length && this.isFlat(cats)) \r\n\t\t\t\tcats = [{name: '', boards: cats}]\r\n\t\t\tcats.forEach(cat => {\r\n\t\t\t\thtm += this.buildCat(cat)\r\n\t\t\t})\r\n\t\t}\r\n\t\t$('#categories').html(htm)\r\n\t\t\r\n\t\tdocument.querySelectorAll('.tree-cat ul').forEach(this.makeBoardsSortable.bind(this));\r\n\r\n\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\r\n\r\n\t\treturn this.validateUI()\r\n\t},\r\n\tisFlat: cats => cats[0].hasOwnProperty('dir'),\r\n\tboardHeight: 24,\r\n\taddBoardButtonHeight: 27,\r\n\tbuildCat: function(cat) {\r\n\t\tcat.boards = cat.boards || []\r\n\t\tvar boards = this.buildBoards(cat.boards)\r\n\t\t, empty = (cat.boards.length === 0)\r\n\t\t, maxHeight = (cat.boards.length+1) * this.boardHeight + this.addBoardButtonHeight\r\n\t\treturn `<div class=\"tree-cat ${empty ? 'empty': ''}\">\r\n\t\t<div class=\"tree-cathead\">\r\n\t\t\t<svg class=\"icon f-plus\" title=\"Развернуть\"><use xlink:href=\"#i-folder-plus-fill\"></use></svg>\r\n\t\t\t<svg class=\"icon f-minus\" title=\"Свернуть\"><use xlink:href=\"#i-folder-minus-fill\"></use></svg>\r\n\t\t\t<svg class=\"icon f-empty\"><use xlink:href=\"#i-folder-empty\"></use></svg>\r\n\t\t\t<input type=\"text\" class=\"cat-title\" value=\"${_.escape(cat.name) || ''}\"></input>\r\n\t\t\t<button class=\"b-option cat-undelete\" title=\"Отменить удаление\">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-undo\"></use></svg>\r\n\t\t\t</button>\r\n\t\t\t<div class=\"cat-dragger\" title=\"Сортировать категории\">\r\n\t\t\t\t<svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg>\r\n\t\t\t</div>\r\n\t\t\t<button class=\"b-option delb delcat\" title=\"Удалить категорию\">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg>\r\n\t\t\t</button>\r\n\t\t</div>\r\n\t\t<div class=\"tree-catboards\" style=\"max-height: ${maxHeight}px\">${boards}</div></div>`\r\n\t},\r\n\tbuildBoards: function(boards) {\r\n\t\tvar htm ='<ul>'\r\n\t\tboards.forEach(brd => {\r\n\t\t\thtm += this.buildBoard(brd)\r\n\t\t})\r\n\t\thtm += `</ul><button class=\"tree-add add-board\" title=\"Добавить доску\">\r\n\t\t\t<div class=\"inner-border\">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-slash-plus-slash\"></use></svg>\r\n\t\t\t</div>\r\n\t\t</button>`\r\n\t\treturn htm\r\n\t},\r\n\tbuildBoard: brd => escHTML\r\n\t`<li class=\"cat-brd ${brd.external ? 'external' : ''}\">\r\n\t\t<input type=\"text\" class=\"board-dir\" value=\"${brd.dir || brd.url || ''}\">\r\n\t\t<input type=\"text\" class=\"board-desc\" value=\"${brd.desc || ''}\">\r\n\t\t<div class=\"dragger\" title=\"Сортировать доски\"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\r\n\t\t<button class=\"b-option delb delboard\" title=\"Удалить доску\"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button>\r\n\t</li>`,\r\n\trecalcHeight: function($brds) {\r\n\t\tif (!($brds instanceof jQuery)) \r\n\t\t\t$brds = $($brds).parent()\r\n\t\tlet n = $brds.find('.cat-brd').length\r\n\t\t, px = (n+1) * this.boardHeight + this.addBoardButtonHeight\r\n\t\t$brds.css({'max-height': `${px}px`})\r\n\t\t$brds.parent().toggleClass('empty', n == 0)\r\n\t},\r\n\taddBoard: function($btn, board) {\r\n\t\tboard = board || {}\r\n\t\t$btn.parent().find('ul').append(this.buildBoard)\r\n\t\tthis.recalcHeight($btn.parent())\r\n\t\t$btn.parent().find('.cat-brd:last input:first').focus()\r\n\t},\r\n\tremoveBoard: function($btn) {\r\n\t\tlet $parent = $btn.parents('.tree-catboards')\r\n\t\t$btn.parents('.cat-brd').remove()\r\n\t\tthis.recalcHeight($parent)\r\n\t\tthis.validateUI()\r\n\t},\r\n\taddCategory: function(cat) {\r\n\t\tif (!cat.hasOwnProperty('boards'))\r\n\t\t\tcat = {name: '', boards: []}\r\n\t\tlet $cat = $(this.buildCat(cat))\r\n\t\tthis.makeBoardsSortable($cat.find('ul')[0])\r\n\t\t$('#categories').append($cat)\r\n\t\t$cat.find('.cat-title').focus()\r\n\t},\r\n\tremoveCategory: function($btn) {\r\n\t\t$btn.parents('.tree-cat').remove()\r\n\t\tthis.validateUI()\r\n\t},\r\n\tmakeBoardsSortable: function(el) {\r\n\t\tSortable.create(el, {\r\n\t\t\thandle: '.dragger',\r\n\t\t\tanimation: 150, \r\n\t\t\tgroup: 'boards',\r\n\t\t\tonAdd: ev => {\r\n\t\t\t\t[ev.from, ev.to].forEach(this.recalcHeight.bind(this))\r\n\t\t\t\tthis.validateUI()\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tvalidateJSON: function() {\r\n\t\ttry {\r\n\t\t\tlet cats = JSON.parse($('#tree-json').val())\r\n\t\t\tthis.build(cats)\r\n\t\t\treturn 1\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tthis.showErrors(e)\r\n\t\t\t$('#view-toggle').shake()\r\n\t\t\treturn 0\r\n\t\t}\r\n\t},\r\n\tvalidateUI: function(isDraft) {\r\n\t\tlet errors = []\r\n\t\t, obj = this.deconstruct()\r\n\r\n\t\tif ($('#tree .invalid').length)\r\n\t\t\t_.keys(this.errorDescriptors).forEach(r => {\r\n\t\t\t\tif ($(jq`#tree .invalid.inv_${r}`).length) \r\n\t\t\t\t\terrors.push(r)\r\n\t\t\t})\r\n\r\n\t\tlet allDirs = []\r\n\t\t, walkCat = brd => allDirs.push(brd.external ? brd.url : brd.dir)\r\n\r\n\t\tlet catNames = []\r\n\t\tobj.forEach(cat => {\r\n\t\t\tcatNames.push(cat.name)\r\n\t\t\tcat.boards.forEach(walkCat)\r\n\t\t})\r\n\t\tlet dupCats = findDuplicates(catNames)\r\n\t\tif (dupCats.length) {\r\n\t\t\terrors.push('mul-cat')\r\n\t\t\tlet $cats = $('.cat-title')\r\n\t\t\tdupCats.forEach(i => $($cats[i]).addClass('invalid'))\r\n\t\t}\r\n\r\n\t\tlet dupDirs = findDuplicates(allDirs)\r\n\t\tif (dupDirs.length) {\r\n\t\t\terrors.push('mul-dir')\r\n\t\t\tlet $dirs = $('.board-dir')\r\n\t\t\tdupDirs.forEach(i => $($dirs[i]).addClass('invalid'))\r\n\t\t}\r\n\r\n\t\tthis.showErrors(errors)\r\n\t\treturn (errors.length && !isDraft) ? false : obj\r\n\t},\r\n\tdeconstruct: function() {\r\n\t\t$('#tree .invalid').removeClass('invalid ' + \r\n\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\r\n\t\tlet cats = []\r\n\t\t, $cats = $('.tree-cat')\r\n\t\t, flat = false\r\n\t\tif ($cats.length == 1)\r\n\t\t\tflat = true\r\n\t\t$('.tree-cat').each(function() {\r\n\t\t\tvar $cat = $(this)\r\n\t\t\t, boards = []\r\n\t\t\t, $boards = $cat.find('.cat-brd')\r\n\t\t\tif (! $boards.length)\r\n\t\t\t\t$cat.addClass('invalid inv_empty-dir')\r\n\t\t\telse $boards.each(function() {\r\n\t\t\t\tlet $desc = $(this).find('.board-desc')\r\n\t\t\t\t, desc = $desc.val().trim()\r\n\t\t\t\tif (!desc) \r\n\t\t\t\t\t$desc.addClass('invalid inv_no-desc')\r\n\t\t\t\tlet board = {desc: desc}\r\n\r\n\t\t\t\tlet $dir = $(this).find('.board-dir')\r\n\t\t\t\t, dir = $dir.val().trim()\r\n\t\t\t\tif (!dir)\r\n\t\t\t\t\t$dir.addClass('invalid inv_no-dir')\r\n\r\n\t\t\t\tlet external = !! dir.match(/^https?:\\/\\//)\r\n\t\t\t\t$(this).toggleClass('external', external)\r\n\t\t\t\tboard[external ? 'url' : 'dir'] = dir\r\n\t\t\t\tif (external) \r\n\t\t\t\t\tboard.external = true\r\n\r\n\t\t\t\tboards.push(board)\r\n\t\t\t})\r\n\r\n\t\t\tlet $name = $cat.find('.cat-title')\r\n\t\t\t, name = $name.val().trim()\r\n\t\t\tif (!flat && ! name) {\r\n\t\t\t\t$name.addClass('invalid inv_no-name')\r\n\t\t\t}\r\n\t\t\tcats.push({\r\n\t\t\t\tname: name,\r\n\t\t\t\tboards: boards\r\n\t\t\t})\r\n\t\t})\r\n\t\treturn cats\r\n\t},\r\n\ttoggleView: function(to, isDraft) {\r\n\t\tlet current = $('#chan-structure').hasClass('sw_UI') ? 'UI' : 'JSON'\r\n\r\n\t\tif (typeof to === 'undefined') \r\n\t\t\tto = current=='UI' ? 'JSON' : 'UI'\r\n\r\n\t\tif (current == to)\r\n\t\t\treturn null\r\n\r\n\t\tif (to === 'JSON') {\r\n\t\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\tlet JSON_valid = this.validateJSON()\r\n\t\t\tif (isDraft)\r\n\t\t\t\treturn $('#tree-json').val()/*.replace(/\\t|\\n/g, '')*/\r\n\t\t\telse if (! JSON_valid) \r\n\t\t\t\treturn false\r\n\t\t}\r\n\r\n\t\t$('#chan-structure')\r\n\t\t.removeClass('sw_UI sw_JSON')\r\n\t\t.addClass(`sw_${to}`)\r\n\r\n\t\treturn 1\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'no-name': 'Пустое название раздела',\r\n\t\t'no-dir': 'Пустой путь доски',\r\n\t\t'no-desc': 'Пустое название доски',\r\n\t\t'mul-dir': 'Повторяющиеся имена досок',\r\n\t\t'mul-cat': 'Повторяющиеся имена разделов',\r\n\t\t'empty-dir': 'Пустой раздел',\r\n\t\t'bad-json': 'JSON — инвалид'\r\n\t},\r\n\tshowErrors: mkErrorShower('struct')\r\n}\r\n\r\nfunction mkErrorShower(id) {\r\n\treturn function(errs) {\r\n\t\tif (! (errs instanceof Array))\r\n\t\t\terrs = [errs]\r\n\t\tlet $tipper = id instanceof jQuery ? id : $(jq`#${id}-tipper`)\r\n\t\t, $msgbox = $tipper.find('.error-msg .tooltip')\r\n\t\t, any = errs.length > 0\r\n\t\t, mul = errs.length > 1\r\n\t\tlet htm = (mul ? `Обнаружены ошибки: <ul>` : '')\r\n\t\t+ errs.reduce((htm, er) => htm + escHTML`${mul ? '<li>' : ''}${this.errorDescriptors && this.errorDescriptors[er] || er}${mul ? '</li>' : ''}`, '')\r\n\t\t+ (mul ? '</ul>' : '')\r\n\t\t$msgbox.html(htm)\r\n\t\t$tipper.setTipperState(any ? 'error-tip' : 'question')\r\n\t\tif (any) \r\n\t\t\t$tipper.shake()\r\n\t\tif(this instanceof HTMLElement) {\r\n\t\t\t$(this).toggleClass('invalid', any)\r\n\t\t}\r\n\t}\r\n}\r\n\r\n$.fn.shake = function() {\r\n\tthis.addClass('shake')\r\n\tsetTimeout(() => this.removeClass('shake'), 900)\r\n}\r\n$.fn.setTipperState = function(state) {\r\n\tthis.removeClass(_.without(['question', 'error-tip', 'spinner', 'valid'], state).join(' '))\r\n\t.addClass(state)\r\n}\r\n\r\n/*function hasDuplicates(a) {\r\n\treturn _.uniq(a).length !== a.length; \r\n}*/\r\n\r\nfunction findDuplicates(arr) {\r\n\tlet dubs = []\r\n\tarr.forEach((el, i) => {\r\n\t\tif (arr.length - _.without(arr, el).length > 1)\r\n\t\t\tdubs.push(i)\r\n\t})\r\n\treturn dubs\r\n}\r\n\r\nvar styles = {\r\n\tpreamble: function(role) {\r\n\t\tlet vars = []\r\n\t\t;['chan-id', 'bgColor', 'linkColor'].forEach(v =>\r\n\t\t\tvars[v] = (role == 'html')\r\n\t\t\t\t? `<span class=\"binded\" data-bind=\"${v}\"></span>`\r\n\t\t\t\t: $(jq`#${v}`).val()\r\n\t\t)\r\n\t\tif (role == 'less')\r\n\t\t\tvars['chan-id'] = 'css-preview'\r\n\t\treturn `.chan-${vars['chan-id']} {`+\r\n\t\t\t`\\n  @bgcolor: #${vars.bgColor};`+\r\n\t\t\t`\\n  @linkcolor: #${vars.linkColor};`;\r\n\t},\r\n\tupdate: function(callback) {\r\n\t\tcallback = (typeof callback === 'function') ? callback : null\r\n\t\tlet userCode = this.parseInput()\r\n\t\tif (!userCode) {\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(false)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet lessCode = this.preamble('less') + userCode + '}';\r\n\t\tless.render(lessCode).then(r => {\r\n\t\t\tinjector.inject('chanclass-preview', r.css)\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(true)\r\n\t\t},\r\n\t\terr => {\r\n\t\t\tthis.showErrors(err.message)\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(false)\r\n\t\t})\r\n\t},\r\n\tgetData: function(isDraft) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet res = {\r\n\t\t\t\tcolors: ['bg', 'link'].map(c => {\r\n\t\t\t\t\tlet $input = $(jq`#${c}Color`)\r\n\t\t\t\t\t, val = $input.val()\r\n\t\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\r\n\t\t\t\t\t\tval = $input.attr('value')\r\n\t\t\t\t\t\t$input[0].jscolor.fromString(val)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn val\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif ($('#advance-less').prop('checked')) {\r\n\t\t\t\tres.advanced_less = lessFormatter.minify($('#less-enter').val())\r\n\t\t\t\tthis.update(succ => {\r\n\t\t\t\t\tif (isDraft || succ) \r\n\t\t\t\t\t\tresolve(res) \r\n\t\t\t\t\telse \r\n\t\t\t\t\t\treject()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse resolve(res)\r\n\t\t})\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'bracket-imbalance': 'Скобки не сбалансированы',\r\n\t\t// 'parent-selector': 'Использование родительского селектора (&) запрещено (за исключением классов и псевдоклассов)'\r\n\t},\r\n\tparseInput: function() {\r\n\t\tlet errors_found = []\r\n\t\t, val = $('#less-enter').val()\r\n\t\t// check for bracket balance | http://codereview.stackexchange.com/a/15339\r\n\t\tlet brackets = val.replace(/\\/\\*.+?\\*\\/|\".+?\"|'.+?'/, '').replace(/[^()\\[\\]{}]/g, '')\r\n\t\t, isBalanced = (function(str) {\r\n\t\t\tvar bracket = {\r\n\t\t\t\t\"]\": \"[\",\r\n\t\t\t\t\"}\": \"{\",\r\n\t\t\t\t\")\": \"(\"\r\n\t\t\t},\r\n\t\t\topenBrackets = [], \r\n\t\t\tisClean = true,\r\n\t\t\ti = 0,\r\n\t\t\tlen = str.length;\r\n\r\n\t\t\tfor(; isClean && i<len; i++ ){\r\n\t\t\t\tif ( bracket[ str[ i ] ] ){\r\n\t\t\t\t\tisClean = ( openBrackets.pop() === bracket[ str[ i ] ] );\r\n\t\t\t\t}else{\r\n\t\t\t\t\topenBrackets.push( str[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn isClean && !openBrackets.length;\r\n\t\t})(brackets)\r\n\t\t\r\n\t\tif (!isBalanced)\r\n\t\t\terrors_found.push('bracket-imbalance')\r\n\r\n\t\t// check for parent selectors\r\n\t\t/*if (val.match(/&(?![:\\.])/))\r\n\t\t\terrors_found.push('parent-selector')*/\r\n\r\n\t\tthis.showErrors(errors_found)\r\n\r\n\t\treturn errors_found.length ? false : val\r\n\t},\r\n\tshowErrors: mkErrorShower('style'),\r\n\treset: function() {\r\n\t\t;['bg', 'link'].forEach(field => {\r\n\t\t\tlet $input = $(jq`#${field}Color`)\r\n\t\t\t$input[0].jscolor.fromString($input.data('default'))\r\n\t\t})\r\n\t\t$('#advance-less').prop('checked', 0).trigger('change')\r\n\t\tthis.update()\r\n\t\t$('#custom-css').prop('checked', 0).trigger('change')\r\n\t}\r\n}\r\n\r\nstyles.base = `background: @bgcolor;\r\na, .chan-overlay .icon {\r\n\tcolor: @linkcolor;\r\n}\r\n&:hover {\r\n\tbackground: darken(@bgcolor, 8%);\r\n}\r\n&.onchan {\r\n\tbox-shadow: inset -2px 0 fadeout(@linkcolor, 25%);\r\n}\r\n& when (lightness(@bgcolor) < 70%) {\r\n\tcolor: #C3C3C3;\r\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\r\n\t\tcolor: white;\r\n\t}\r\n\t.board:hover {\r\n\t\tbackground: rgba(255, 255, 255, .08);\r\n\t}\r\n}\r\n& when (lightness(@bgcolor) > 70%) {\r\n\tcolor: #404040;\r\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\r\n\t\tcolor: black;\r\n\t}\r\n\t.board:hover {\r\n\t\tbackground: rgba(0, 0, 0, .08);\r\n\t}\r\n}\r\n`;\r\n\r\n\r\nvar radio = {\r\n\tbuildStream: strm => escHTML\r\n\t`<li class=\"stream${strm.n ? ' templated' : ''}\">\r\n\t\t<input type=\"text\" class=\"stream-name\" placeholder=\"Название стрима\" title=\"Название стрима\" maxlength=\"20\" value=\"${strm.name || ''}\">\r\n\t\t<input type=\"text\" class=\"stream-range\" placeholder=\"Диапазон\" title=\"Диапазон\" maxlength=\"20\" value=\"${strm.n || ''}\">\r\n\t\t<div class=\"stream-options\">\r\n\t\t\t<button class=\"b-option templatize\" title=\"Размножать по шаблону\"><svg class=\"icon\">\r\n\t\t\t\t<use class=\"for-templated-hide\" xlink:href=\"#i-template\"></use>\r\n\t\t\t\t<use class=\"for-templated-show\" xlink:href=\"#i-untemplate\"></use>\r\n\t\t\t</svg></button>\r\n\t\t\t<div class=\"dragger\" title=\"Сортировать стримы\"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\r\n\t\t\t<button class=\"b-option delstream\" title=\"Удалить стрим\"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button><br>\r\n\t\t</div>\r\n\t\t<br>\r\n\t\t<input type=\"text\" class=\"stream-path\" placeholder=\"/path стрима\" title=\"/path стрима\" maxlength=\"50\" value=\"${strm.path || ''}\">\r\n\t\t<input type=\"text\" class=\"stream-mime\" placeholder=\"MIME стрима\" title=\"MIME стрима\" maxlength=\"20\" value=\"${strm.mime || ''}\">\r\n\t</li>`,\r\n\taddStream: function(strm) {\r\n\t\tstrm = strm || {}\r\n\t\tlet $strm = $(this.buildStream(strm))\r\n\t\t$('#streams').append($strm)\r\n\t},\r\n\tbuild: function(r) {\r\n\t\t$('#chan-radiourl').val(r.url)\r\n\t\t$('#streams').html(r.streams.reduce((htm, strm) => htm + this.buildStream(strm), ''))\r\n\t},\r\n\tremoveStream: $btn => $btn.parents('.stream').remove(),\r\n\treset: function() {\r\n\t\tthis.build({url: '', streams: []})\r\n\t\t$('#radio-editor').hide()\r\n\t\t$('#radio').prop('checked', false)\r\n\t},\r\n\tgetData: function(isDraft) { //aka validate\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet proceed = (url, errors) => {\r\n\t\t\t\terrors = errors ? errors.map(v => `URL: ${v}`) : []\r\n\t\t\t\t$('#chan-radiourl').toggleClass('invalid', !!errors.length)\r\n\r\n\t\t\t\t$('#streams input').removeClass('invalid ' + \r\n\t\t\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\r\n\t\t\t\tlet streams = []\r\n\t\t\t\t, $streams = $('.stream')\r\n\t\t\t\tif (! $streams.length)\r\n\t\t\t\t\terrors.push('no-streams')\r\n\t\t\t\telse {\r\n\t\t\t\t\t$streams.each(function() {\r\n\t\t\t\t\t\tlet $strm = $(this)\r\n\t\t\t\t\t\t, stream = {}\r\n\t\t\t\t\t\t;['name', 'path', 'mime'].forEach(prop => {\r\n\t\t\t\t\t\t\tlet $input = $strm.find(`.stream-${prop}`)\r\n\t\t\t\t\t\t\t, val = $input.val()\r\n\t\t\t\t\t\t\tif(!val)\r\n\t\t\t\t\t\t\t\t$input.addClass(`invalid inv_no-${prop}`)\r\n\t\t\t\t\t\t\tstream[prop] = val\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tstreams.push(stream)\r\n\r\n\t\t\t\t\t\tif ($strm.hasClass('templated')) {\r\n\t\t\t\t\t\t\tlet $range = $strm.find(`.stream-range`)\r\n\t\t\t\t\t\t\t, n = $range.val()\r\n\t\t\t\t\t\t\tif (! n)\r\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_no-range')\r\n\t\t\t\t\t\t\telse if(! mixedRange(n).length)\r\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_bad-range')\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tstream.n = n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tif ($('#streams .invalid').length)\r\n\t\t\t\t\t\t_.keys(this.errorDescriptors).forEach(r => {\r\n\t\t\t\t\t\t\tif ($(jq`#streams .invalid.inv_${r}`).length) \r\n\t\t\t\t\t\t\t\terrors.push(r)\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t;['name', 'path'].forEach(prop => {\r\n\t\t\t\t\t\tlet dupProps = findDuplicates(_.pluck(streams, prop))\r\n\t\t\t\t\t\tif (dupProps.length) {\r\n\t\t\t\t\t\t\terrors.push(`mul-${prop}`)\r\n\t\t\t\t\t\t\tlet $inputs = $(jq`.stream-${prop}`)\r\n\t\t\t\t\t\t\tdupProps.forEach(i => $($inputs[i]).addClass('invalid'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.showErrors(errors)\r\n\r\n\t\t\t\tif (!isDraft && errors.length)\r\n\t\t\t\t\treject(errors)\r\n\t\t\t\telse\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\turl: url,\r\n\t\t\t\t\t\tstreams: streams\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t$('#chan-radiourl')[0].validate(true).then(val => {\r\n\t\t\t\tproceed(val, null)\r\n\t\t\t},\r\n\t\t\terrors => {\r\n\t\t\t\tproceed(null, errors)\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tshowErrors: mkErrorShower('radio'),\r\n\terrorDescriptors: {\r\n\t\t'no-streams': 'Добавьте хотя бы один стрим',\r\n\t\t'no-name': 'Пустое имя стрима',\r\n\t\t'no-path': 'Пустая ссылка на стрим',\r\n\t\t'no-mime': 'Отсутствует MIME',\r\n\t\t'mul-name': 'Повторяющиеся имена стримов',\r\n\t\t'mul-path': 'Повторяющиеся ссылки на стримы',\r\n\t\t'no-range': 'Не введен диапазон размножения',\r\n\t\t'bad-range': 'Неверный формат диапазона размножения'\r\n\t}\r\n}\r\n\r\nvar library = {\r\n\tbuild: function(chans, section) {\r\n\t\tchans.forEach(chan => this.addChan(chan, section || (chan.offline ? 'offline' : (chan.default ? 'default' : 'custom'))))\r\n\t\tif (IS_ADMIN) {\r\n\t\t\tthis.memoizeOrder()\r\n\t\t\tSortable.create(document.querySelector('#chans'), {\r\n\t\t\t\tanimation: 150,\r\n\t\t\t\tonEnd: () => this.reorder()\r\n\t\t\t})\r\n\t\t\tthis.sortingData = null\r\n\t\t}\r\n\t},\r\n\tbuildChan: function(chan, section) {\r\n\t\tsection = section || chan.section\r\n\t\tif (! section)\r\n\t\t\treturn console.error('No section specified for buildChan()')\r\n\t\tlet ballSrc = chan.ball || `/chans/balls/${section}/${section == 'drafts' ? 'no-ball' : chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\r\n\t\t, search = `${chan.id} ${chan.name} ${chan.url.replace(/^https?:\\/\\//, '')} ${(chan.wiki || '').replace(/^https?:\\/\\//, '')}`\r\n\t\t.toLowerCase().trim().replace(/[<>\"\"]/g, '')\r\n\t\t, dlbtn = section === 'drafts' ? `\r\n\t\t<button class=\"btn export-draft\">\r\n\t\t\t<svg class=\"icon\" title=\"Экспортировать черновик\"><use xlink:href=\"#i-download\"></use></svg>\r\n\t\t</button>` : ''\r\n\t\t, htm = escHTML`<li class=\"lib-chan sect-${section}${!chan.name ? ' no-name' : ''}\" id=\"chan_${chan.id}\" data-search=\"${search}\" data-order=\"${chan.order}\" data-id=\"${chan._id}\">\r\n\t\t\t<img src=\"${ballSrc}\" class=\"lib-chanball\">\r\n\t\t\t<div class=\"chan-title\">${chan.name || 'Без имени'}</div>`+dlbtn+`\r\n\t\t</li>`\r\n\t\t, $chan = $(htm)\r\n\t\tchan.section = section\r\n\t\t$chan[0]._libdata = chan\r\n\t\treturn $chan\r\n\t},\r\n\taddChan: function(chan, section, fresh) {\r\n\t\tif (typeof fresh === 'undefined') fresh = false\r\n\t\tsection = section || chan.section\r\n\t\tif (! section)\r\n\t\t\treturn console.error('No section specified for addChan()')\r\n\t\tlet $chan = this.buildChan(chan, section)\r\n\t\t$chan.appendTo('#chans')\r\n\t\tfresh && this.highlight($chan)\r\n\t\tif (this.sortingData?.length)\r\n\t\t\tthis.reorder()\r\n\t\tlet libdata = $chan[0]._libdata\r\n\t\treturn libdata\r\n\t},\r\n\teditChan: function(chan) {\r\n\t\tlet $chan = $(jq`#chan_${chan.id}`)\r\n\t\t, libdata = $chan[0]._libdata\r\n\t\t_.assign(libdata, chan)\r\n\t\t$chan.replaceWith(this.buildChan(libdata, libdata.section))\r\n\t\tthis.highlight($(jq`#chan_${chan.id}`))\r\n\t\treturn libdata\r\n\t},\r\n\tdeleteChan: function(id) {\r\n\t\t$(jq`#chan_${id}`).remove()\r\n\t\tif (this.sortingData?.length)\r\n\t\t\tthis.reorder()\r\n\t},\r\n\thighlight: function($chan) {\r\n\t\tlet sect = $chan[0]._libdata.section\r\n\t\t$(jq`.tab[data-tab=${sect}]`).click()\r\n\t\t$chan.addClass('fresh')\r\n\t\ttoggleLib(true)\r\n\t},\r\n\tgetOrder: function() {\r\n\t\treturn [].map.call(document.querySelectorAll('.lib-chan:not(.sect-drafts)'), ch => ({\r\n\t\t\torder: +ch.dataset.order,\r\n\t\t\tid: +ch.dataset.id,\r\n\t\t\tname: ch.id\r\n\t\t}))\r\n\t},\r\n\tmemoizeOrder: function() {\r\n\t\tthis.memoizedOrder = this.getOrder()\r\n\t},\r\n\treorder: function() {\r\n\t\tlet data = [];\r\n\t\tthis.getOrder().forEach((newOrder, i) => {\r\n\t\t\tlet oldOrder = this.memoizedOrder[i]\r\n\t\t\tif (newOrder.order != oldOrder.order) {\r\n\t\t\t\tdata.push([\r\n\t\t\t\t\tnewOrder.id,\r\n\t\t\t\t\toldOrder.order\r\n\t\t\t\t])\r\n\t\t\t}\r\n\t\t})\r\n\t\tthis.sortingData = data\r\n\t\tupForm.toggle(data.length && 'sort')\r\n\t},\r\n\trebuild: function() {\r\n\t\tdocument.querySelector('#chans').innerHTML = ''\r\n\t\t$.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\r\n\t\t.done(data => this.build(data.chans))\r\n\t}\r\n}\r\n\r\nvar libchan = {\r\n\tload: function(chan) {\r\n\t\tupForm.toggle()\r\n\r\n\t\tthis.current = chan\r\n\r\n\t\tthis.current.offline = +chan.offline\r\n\t\tthis.current.default = +chan.default\r\n\t\tthis.current.included = +chan.included\r\n\r\n\t\tthis.setMode('edit', chan.section)\r\n\r\n\t\t$('#chan-id').val(chan.id)\r\n\t\t$('#chan-name').val(chan.name).trigger('input')\r\n\t\t$('#chan-url').val(chan.url)\r\n\t\t$('#chan-wiki').val(chan.wiki || '')\r\n\t\t$('#chan-userboards').val(chan.userboards || '')\r\n\t\t$('#chan-userboards_catname').val(chan.userboards_catname || '2.0')\r\n\t\t$('#chan-userboards_system').val(chan.userboards_system || 'instant')\r\n\t\t\r\n\t\tball.setBall(chan)\r\n\r\n\t\tlet offset = chan.offset || [0, 0]\r\n\t\t$('#position-tweak-left').val(offset[0])\r\n\t\t$('#position-tweak-top').val(offset[1])\r\n\t\tball.offset()\r\n\r\n\t\t$('#bgc-from')[0].jscolor.fromString(chan.catbg[0])\r\n\t\t$('#bgc-to')[0].jscolor.fromString(chan.catbg[1])\r\n\t\tgradient.update()\r\n\r\n\t\t$('#chan-prefix').val(chan.prefix || '')\r\n\t\t$('#chan-postfix').val(chan.postfix || '')\r\n\r\n\t\ttree.build(chan.boards)\r\n\r\n\t\t$('#custom-css').prop('checked', !!chan.colors)\r\n\t\tif (chan.colors) {\r\n\t\t\t$('#color-theme').show()\r\n\t\t\t$('#bgColor')[0].jscolor.fromString(chan.colors[0])\r\n\t\t\t$('#linkColor')[0].jscolor.fromString(chan.colors[1])\r\n\t\t\tif (chan.advanced_less) {\r\n\t\t\t\t$('#advance-less').prop('checked', 1).trigger('change')\r\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(chan.advanced_less))\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(styles.base))\r\n\t\t\t\t$('#advance-less').prop('checked', 0).trigger('change')\r\n\t\t\t}\r\n\t\t\tstyles.update()\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstyles.reset()\r\n\t\t}\r\n\t\t\r\n\t\tif (chan.radio) {\r\n\t\t\t$('#radio-editor').show()\r\n\t\t\tradio.build(chan.radio)\r\n\t\t\t$('#radio').prop('checked', true)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tradio.reset()\r\n\t\t}\r\n\r\n\t\t$('#default').prop('checked', !!chan.default)\r\n\t\t$('#included').prop('checked', !!chan.included)\r\n\t\t$('#offline').prop('checked', !!chan.offline)\r\n\r\n\t\tthis.rinse()\r\n\t},\r\n\t_schema: {\r\n\t\tintegrity: {\r\n\t\t\trequired: ['id', 'name', 'url', 'boards', 'ball', 'offset', 'catbg'],\r\n\t\t\toptional: ['userboards', 'prefix', 'postfix', 'wiki', 'radio', 'colors', 'advanced_less', 'userboards_catname', 'userboards_system'],\r\n\t\t\tadminOnly: ['default', 'included', 'offline']\r\n\t\t},\r\n\t\tspecialComps: {\r\n\t\t\tpairs: ['catbg', 'offset', 'colors'],\r\n\t\t\tobjects: ['boards', 'radio'],\r\n\t\t\tisNewBall: ['ball']\r\n\t\t},\r\n\t\tconversions: {\r\n\t\t\ttoFile: ['ball']\r\n\t\t},\r\n\t\tdefaults: {\r\n\t\t\t'': ['userboards', 'prefix', 'postfix', 'wiki'],\r\n\t\t\t'FFFFFF|FFFFFF': ['catbg'],\r\n\t\t\t'0|0': ['offset'],\r\n\t\t\t'2C333D|37C999': ['colors'],\r\n\t\t\t'2.0': ['userboards_catname'],\r\n\t\t\t'instant': ['userboards_system']\r\n\t\t},\r\n\t\tfns: {\r\n\t\t\tobjects: _.eq.bind(_),\r\n\t\t\tpairs: (first, second) => {\r\n\t\t\t\tlet vals = [first, second].map(val => (val instanceof Array) ? val.join('|').toLowerCase() : val)\r\n\t\t\t\treturn vals[0] === vals[1]\r\n\t\t\t},\r\n\t\t\tisNewBall: (cur, nu) => cur ? (nu===cur) : (nu==='default'),\r\n\t\t\ttoFile: v => v.indexOf('data:') === 0 ? v.toBlob() : v\r\n\t\t}\r\n\t},\r\n\tinit: function() {\r\n\t\tlet allProps = []\r\n\t\t, schema = {}\r\n\r\n\t\t_.each(this._schema.integrity, (props, intCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop] = {}\r\n\t\t\t\tschema[prop][intCls] = true\r\n\t\t\t\tif (intCls === 'optional')\r\n\t\t\t\t\tschema[prop].default = null\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.specialComps, (props, cmpCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].eqFn = this._schema.fns[cmpCls]\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.conversions, (props, convCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].conv = this._schema.fns[convCls]\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.defaults, (props, defCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].default = defCls\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t/*schema.offset.default = '0|0'\r\n\t\tschema.catbg.default = 'ffffff|ffffff'\r\n*/\r\n\t\tthis.schema = schema\r\n\t},\r\n\tmode: 'new',\r\n\tsetMode: function(mode, section) {\r\n\t\tthis.mode = mode\r\n\t\t$('body').toggleClass('edit-draft', mode === 'edit' && section === 'drafts')\r\n\t\t$('#chan-id, #save-draft').prop('disabled', mode === 'edit' && section !== 'drafts')\r\n\t\t$('#clone-this, #delete-this').prop('disabled', mode === 'new')\r\n\t},\r\n\trinse: () => {\r\n\t\t$('.tipper').setTipperState('question')\r\n\t\t$('input').removeClass('invalid')\r\n\t},\r\n\tcollectData: function(role) {\r\n\t\tlet isDraft = (role === 'draft')\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet chan = {}\r\n\t\t\t, dataPromises = []\r\n\t\t\t// basic data\r\n\t\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'userboards_catname', 'prefix', 'postfix'].forEach(prop => {\r\n\t\t\t\tlet pr = $(jq`#chan-${prop}`)[0].validate(0, isDraft).then(val => {\r\n\t\t\t\t\tchan[prop] = val\r\n\t\t\t\t})\r\n\t\t\t\tdataPromises.push(pr)\r\n\t\t\t})\r\n\t\t\t// ball data\r\n\t\t\tdataPromises.push(ball.getData(isDraft).then(data => {\r\n\t\t\t\t_.assign(chan, data)\r\n\t\t\t}))\r\n\t\t\t// tree data\r\n\t\t\tdataPromises.push(new Promise((resolve, reject) => {\r\n\t\t\t\tlet treeToUI = tree.toggleView('UI', isDraft)\r\n\t\t\t\tif (treeToUI)\r\n\t\t\t\t\tresolve(treeToUI)\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (treeToUI === false)\r\n\t\t\t\t\t\treject()\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet validUI = tree.validateUI(isDraft)\r\n\t\t\t\t\t\tif (validUI)\r\n\t\t\t\t\t\t\tresolve(validUI)\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tchan.boards = (tree.toggleView('UI') === false) ? false : tree.validateUI()\r\n\t\t\t}).then(data => {\r\n\t\t\t\tchan.boards = data\r\n\t\t\t}))\r\n\t\t\tchan.userboards_system = $('#chan-userboards_system').val()\r\n\t\t\t// options: radio\r\n\t\t\tif ($('#radio').prop('checked')) {\r\n\t\t\t\tdataPromises.push(radio.getData(isDraft).then(data => {\r\n\t\t\t\t\tchan.radio = data\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\t// options: styles\r\n\t\t\tif ($('#custom-css').prop('checked')) {\r\n\t\t\t\tdataPromises.push(styles.getData(isDraft).then(data => {\r\n\t\t\t\t\t_.assign(chan, data)\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\t// options: admy\r\n\t\t\tif (IS_ADMIN) {\r\n\t\t\t\tlet admy = {}\r\n\t\t\t\t;['default', 'included', 'offline'].forEach(prop => {\r\n\t\t\t\t\tadmy[prop] = +$(jq`#${prop}`).prop('checked')\r\n\t\t\t\t})\r\n\t\t\t\t_.assign(chan, admy)\r\n\t\t\t}\r\n\r\n\t\t\tPromise.all(dataPromises).then(() => resolve(chan), () => reject('fix-errors'))\r\n\t\t})\r\n\t},\r\n\tproceedWithData: function(role, isUpload) {\r\n\t\tlet mode = (isUpload && this.current && this.current.section === 'drafts') ? 'new' : this.mode\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet fd = new FormData(), chan = {}\r\n\t\t\t, errors = []\r\n\t\t\tthis.collectData(role).then(data => {\r\n\t\t\t\tif (mode === 'edit' && libchan.current.id !== data.id) {\r\n\t\t\t\t\terrors.push('id-changed')\r\n\t\t\t\t}\r\n\t\t\t\t_.each(this.schema, (propSchema, prop) => {\r\n\t\t\t\t\tlet val\r\n\r\n\t\t\t\t\tif (propSchema.adminOnly && !IS_ADMIN)\r\n\t\t\t\t\t\treturn\r\n\r\n\t\t\t\t\tif (! data.hasOwnProperty(prop)) {\r\n\t\t\t\t\t\tif (propSchema.required)\r\n\t\t\t\t\t\t\terrors.push('fill-required-fields')\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tval = null\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tval = data[prop]\r\n\r\n\t\t\t\t\tif (mode === 'edit' && prop !== 'id') {\r\n\t\t\t\t\t\tlet cur = libchan.current.hasOwnProperty(prop) ? libchan.current[prop] : propSchema.default\r\n\t\t\t\t\t\tif (propSchema.eqFn ? propSchema.eqFn(cur, val) : (cur===val))\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (val === null)\r\n\t\t\t\t\t\treturn\r\n\r\n\t\t\t\t\tchan[prop] = val\r\n\t\t\t\t\tif (role === 'upload') {\r\n\t\t\t\t\t\tif (propSchema.conv)\r\n\t\t\t\t\t\t\tval = propSchema.conv(val)\r\n\t\t\t\t\t\tfd.apnd(prop, val)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tif (errors.length) {\r\n\t\t\t\t\treject(_.uniq(errors))\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (DO_DEBUG)\r\n\t\t\t\t\t\tconsole.log(chan)\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\tobj: chan,\r\n\t\t\t\t\t\tfd: fd\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}, \r\n\t\t\terrors => {\r\n\t\t\t\treject(errors)\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tclone: function() {\r\n\t\tthis.setMode('new')\r\n\t\tball.toDataURL()\r\n\t\t$('#chan-id').val('')\r\n\t\t$('#chan-name')[0].value += ' (клон)'\r\n\t\t$('#chan-name').trigger('input')\r\n\t},\r\n\tclear: function() {\r\n\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'prefix', 'postfix']\r\n\t\t.forEach(field => $(jq`#chan-${field}`).val(''))\r\n\t\t$('#chan-userboards_catname').val('2.0')\r\n\t\tball.clear()\r\n\t\t;['from', 'to'].forEach(field => $(jq`#bgc-${field}`)[0].jscolor.fromString('ffffff'))\r\n\t\tgradient.update()\r\n\t\t;[radio, styles].forEach(w => w.reset())\r\n\t\ttree.build('[]')\r\n\t\ttree.toggleView('UI')\r\n\t\tthis.rinse()\r\n\t\tthis.current = null\r\n\t\tthis.setMode('new')\r\n\t\tupForm.toggle()\r\n\t\tif (library.sortingData) {\r\n\t\t\tlibrary.rebuild()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar drafts = {\r\n\tmodel: [],\r\n\tload: function() {\r\n\t\tlet lsDrafts = localStorage['mydrafts']\r\n\t\tif (lsDrafts) \r\n\t\t\ttry {\r\n\t\t\t\tlet parsed = JSON.parse(lsDrafts)\r\n\t\t\t\tif (typeof parsed !== 'object' || !parsed.hasOwnProperty('chans'))\r\n\t\t\t\t\tthrow new Error()\r\n\t\t\t\tthis.model = parsed.chans\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tconsole.error('Drafts in localStorage are corrupted and will be purged')\r\n\t\t\t\tlocalStorage.removeItem('mydrafts')\r\n\t\t\t}\r\n\t\tlibrary.build(this.model, 'drafts')\r\n\t},\r\n\tremove: function(id) {\r\n\t\tthis.model.splice(_.findIndex(this.model, {id: id}), 1)\r\n\t\tlibrary.deleteChan(id)\r\n\t\tlibchan.setMode('new')\r\n\t\tthis.sync()\r\n\t},\r\n\tadd: function(chan, over) {\r\n\t\tlet libdata = library.addChan(chan, 'drafts', 1)\r\n\t\tthis.model.push(chan)\r\n\t\tlibchan.current = libdata\r\n\t\tlibchan.setMode('edit', 'drafts')\r\n\t},\r\n\tedit: function(chan) {\r\n\t\tlet edited = library.editChan(chan)\r\n\t\tthis.model[_.findIndex(this.model, {id: chan.id})] = edited\r\n\t},\r\n\tsync: function() {\r\n\t\tlocalStorage['mydrafts'] = JSON.stringify({\r\n\t\t\tchans: this.model,\r\n\t\t\tversion: new Date().getTime()\r\n\t\t})\r\n\t},\r\n\tsubmit: function(over) {\r\n\t\tlet newid = $('#chan-id').val()\r\n\t\tif (libchan.mode === 'edit' && libchan.current.id !== newid) {\r\n\t\t\t$(\"#id-to-change\").text(libchan.current.id)\r\n\t\t\tupForm.toggle('prompt pr-idchanged')\r\n\t\t\treturn\r\n\t\t}\r\n\t\telse if (libchan.mode === 'new' && _.find(this.model, {id: newid})) {\r\n\t\t\t$(\"#id-to-overwrite\").text(newid)\r\n\t\t\tlet guro = /(.+?)(\\d+)$/.exec(newid)\r\n\t\t\t$(\"#proposed-id\").text(guro ? `${guro[1]}${(+guro[2])+1}` : `${newid}2`)\r\n\t\t\tupForm.toggle('prompt pr-idexists')\r\n\t\t\treturn\r\n\t\t}\r\n\t\telse {\r\n\t\t\tupForm.toggle()\r\n\t\t}\r\n\t\tlibchan.proceedWithData('draft')\r\n\t\t.then(res => {\r\n\t\t\tlet draft = res.obj\r\n\t\t\tif (libchan.mode === 'edit') {\r\n\t\t\t\tthis.edit(draft)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.add(draft)\r\n\t\t\t}\r\n\t\t\tthis.sync()\r\n\t\t}, errors => {\r\n\t\t\tupForm.showErrors(errors)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nlibchan.init()\r\n\r\nvar lessFormatter = {\r\n\tminify: less => less.replace(/\\n/g, ' ').replace(/\\s{2,}/g, ' ').trim(),\r\n\tprettify: function(less) {\r\n\t\treturn css_beautify(this.minify(less).replace(/([;{}])/g, '$1\\n').replace(/^\\s+/gm, '').trim(), {\r\n\t\t\t'indent_char': '\\t', \r\n\t\t\t'indent_size': 1, \r\n\t\t\t'newline_between_rules': false\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar validations = {\r\n\turlencode: val => encodeURI(val),\r\n\tcheckuniq: (val, prop) => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif(libchan.mode === 'edit' && libchan.current[prop]===val) {\r\n\t\t\t\tresolve()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t$.get(`api.php?checkuniq&prop=${prop}&val=${encodeURIComponent(val)}`)\r\n\t\t\t.then(data => {\r\n\t\t\t\tif (data.error)\r\n\t\t\t\t\treject('occupied')\r\n\t\t\t\telse \r\n\t\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t\t.fail(er => {\r\n\t\t\t\tconsole.error('XHR error during post-validation', er)\r\n\t\t\t\treject('XHR error')\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// eeeee prototypes\r\nNodeList.prototype.forEach = Array.prototype.forEach;\r\nNodeList.prototype.map = Array.prototype.map;\r\nFormData.prototype.apnd = function(k, v) {\r\n\tif (typeof v === 'object' && !( v instanceof Blob ))\r\n\t\tthis.append(k, JSON.stringify(v))\r\n\telse\r\n\t\tthis.append(k, v)\r\n}\r\nFormData.prototype.inspect = function() {\r\n\tfor (var pair of this.entries()) {\r\n\t\tconsole.log(pair[0]+ ' = ' + pair[1]); \r\n\t}\r\n}\r\n// Functions ooriginally from here:\r\n// http://stackoverflow.com/a/30407959/1561204\r\nBlob.prototype.readAsDataURL = function(callback) {\r\n\tlet fr = new FileReader();\r\n\tfr.onload = ev => callback(ev.target.result)\r\n\tfr.readAsDataURL(this);\r\n}\r\nString.prototype.toBlob = function() {\r\n\ttry {\r\n\t\tlet arr = this.split(','), mime = arr[0].match(/:(.*?);/)[1],\r\n\t\t\tbstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\r\n\t\twhile(n--){\r\n\t\t\tu8arr[n] = bstr.charCodeAt(n);\r\n\t\t}\r\n\t\treturn new Blob([u8arr], {type:mime});\r\n\t}\r\n\tcatch (e) {\r\n\t\tconsole.error(e)\r\n\t\treturn false\r\n\t}\r\n}\r\n\r\n// https://davidwalsh.name/convert-image-data-uri-javascript\r\nfunction getDataUri(url, callback) {\r\n\tvar image = new Image();\r\n\r\n\timage.onload = function () {\r\n\t\tvar canvas = document.createElement('canvas');\r\n\t\tcanvas.width = this.naturalWidth;\r\n\t\tcanvas.height = this.naturalHeight;\r\n\t\tcanvas.getContext('2d').drawImage(this, 0, 0);\r\n\t\tcallback(canvas.toDataURL('image/png'));\r\n\t};\r\n\r\n\timage.src = url;\r\n}\r\n\r\nfunction mixedRange(input) {\r\n\tvar m\r\n\t, output = []\r\n\t, re = /(?:([0-9]+)(?:\\-([0-9]+))?(?:, ?)?)/g;\r\n\t\r\n\twhile ((m = re.exec(input)) !== null) {\r\n\t\tif (m.index === re.lastIndex) {\r\n\t\t\tre.lastIndex++;\r\n\t\t}\r\n\t\tif(m[2]) {\r\n\t\t\toutput = output.concat(_.range(m[1], +m[2]+1))\r\n\t\t}\r\n\t\telse\r\n\t\t\toutput.push(+m[1])\r\n\t}\r\n\r\n\treturn output\r\n}\r\n\r\nvar upForm = {\r\n\t$form: null,\r\n\tinit: function() {\r\n\t\tthis.$form = $('#upload-form').on('submit', this.submit.bind(this))\r\n\t\t_.each(this.actorFieldMap, (fields, actor) => {\r\n\t\t\tfields.forEach(field => this.fieldActorMap[field] = actor)\r\n\t\t})\r\n\t},\r\n\ttoggle: function(type) {\r\n\t\tif (! type)\r\n\t\t\tthis.$form.removeClass('expanded')\r\n\t\telse {\r\n\t\t\tthis.$form.removeClass('f-upload f-delete f-prompt pr-idchanged pr-idexists f-sort').addClass(`f-${type} expanded`)\r\n\t\t\tlet draftDelete = false\r\n\t\t\tif (type != 'sort') {\r\n\t\t\t\tlet draftDelete = libchan.current && libchan.current.section === 'drafts' && type === 'delete'\r\n\t\t\t\t$('#upload-form input').prop('required', !draftDelete)\r\n\t\t\t}\r\n\t\t\tif (!draftDelete && $('.captcha').hasClass('not-loaded'))\r\n\t\t\t\trefreshCaptcha()\r\n\t\t}\r\n\t},\r\n\tcheckFields: function() {\r\n\t\treturn $('#pswd').val() && $('#captcha').val()\r\n\t},\r\n\tsubmit: function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tlet action = this.$form.hasClass('f-delete') \r\n\t\t\t? 'delete' \r\n\t\t\t: ( this.$form.hasClass('f-sort') \r\n\t\t\t\t? 'sort' \r\n\t\t\t\t: 'upload' )\r\n\t\tif (action != 'sort') {\r\n\t\t\tif (action === 'delete' && libchan.current && libchan.current.section === 'drafts') {\r\n\t\t\t\tdrafts.remove(libchan.current.id)\r\n\t\t\t\tthis.toggle()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (! this.checkFields()) \r\n\t\t\t\treturn this.showErrors('fill-required-fields')\r\n\t\t}\r\n\t\tthis.$form.addClass('busy')\r\n\t\tif (action == 'upload') {\r\n\t\t\tlibchan.proceedWithData(action, true)\r\n\t\t\t.then(res => {\r\n\t\t\t\tthis.candidate = res.obj\r\n\t\t\t\tthis.send(libchan.mode, res.fd)\r\n\t\t\t}, errors => {\r\n\t\t\t\tthis.showErrors(errors)\r\n\t\t\t\tthis.$form.removeClass('busy')\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (action == 'delete') {\r\n\t\t\tlet fd = new FormData()\r\n\t\t\t$('#chan-id')[0].validate(1).then(id => {\r\n\t\t\t\tfd.apnd('id', id)\r\n\t\t\t\tthis.candidate = {id: id}\r\n\t\t\t\tthis.send('delete', fd)\r\n\t\t\t}, \r\n\t\t\te => console.error(e))\r\n\t\t}\r\n\t\tif (action == 'sort') {\r\n\t\t\tif (!library?.sortingData?.length) {\r\n\t\t\t\tthis.showErrors('nothing-to-edit')\r\n\t\t\t\tthis.$form.removeClass('busy')\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tlet fd = new FormData()\r\n\t\t\tfd.apnd('data', library.sortingData)\r\n\t\t\tthis.send('sort', fd)\r\n\t\t}\r\n\t},\r\n\tsend: function(action, fd) {\r\n\t\tif (action != 'sort' && libchan.current && libchan.current.section === 'drafts')\r\n\t\t\taction = 'new'\r\n\t\tfd.apnd('action', action)\r\n\t\tfd.apnd('captcha', $('#captcha').val())\r\n\t\tfd.apnd('password', $('#pswd').val())\r\n\t\tif (DO_DEBUG)\r\n\t\t\tfd.inspect()\r\n\r\n\t\tvar request = new XMLHttpRequest()\r\n\t\trequest.open(\"POST\", \"api.php\")\r\n\t\trequest.send(fd);\r\n\t\tlet _this = this\r\n\t\trequest.onload = function(e) {\r\n\t\t\tif(this.status == 200) {\r\n\t\t\t\tlet res = 0\r\n\t\t\t\ttry {\r\n\t\t\t\t\tres = JSON.parse(this.response)\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\tconsole.warn(this.response)\r\n\t\t\t\t\t_this.unbusy()\r\n\t\t\t\t\t_this.showErrors('invalid-response')\r\n\t\t\t\t}\r\n\t\t\t\tif (res)\r\n\t\t\t\t\t_this.handleResponse(res)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t_this.unbusy()\r\n\t\t\t\t_this.showErrors('xhr-error')\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tshowErrors: mkErrorShower('submit'),\r\n\terrorDescriptors: {\r\n\t\t'fill-required-fields': 'Заполните необходимые поля',\r\n\t\t'xhr-error': 'Ошибка XHR. Подробности в консоли.',\r\n\t\t'invalid-response': 'Ошибка XHR (неверный формат ответа). Подробности в консоли.',\r\n\t\t'id-changed': 'ID был нелегально изменен.',\r\n\t\t'nothing-to-edit': 'Нечего редактировать',\r\n\t\t'missing': 'Не введен пароль',\r\n\t\t'wrong-captcha': 'Капча введена неверно',\r\n\t\t'wrong-password': 'Неверный пароль',\r\n\t\t'fix-errors': 'Исправьте ошибки!',\r\n\t\t'db-error': 'Ошибка при записи в БД',\r\n\t\t'not-admin': 'Непохоже, что вы администратор',\r\n\t\t'wrong-value': 'Неверное значение',\r\n\t\t'chan-does-not-exist': 'Запись отсутствует в БД',\r\n\t\t'data-corrupted': 'Данные повреждены'\r\n\t},\r\n\tactorFieldMap: {\r\n\t\tball: ['ball', 'catbg', 'offset'],\r\n\t\tstyles: ['colors', 'advanced_less'],\r\n\t\ttree: ['boards'],\r\n\t\tradio: ['radio'],\r\n\t\tadmin: ['admin']\r\n\t},\r\n\tfieldActorMap: {},\r\n\tunbusy: function() {\r\n\t\tthis.$form.removeClass('busy')\r\n\t\trefreshCaptcha()\r\n\t},\r\n\thandleResponse: function(res) {\r\n\t\tthis.unbusy()\r\n\t\tif (res.error) {\r\n\t\t\tlet errors = res.error\r\n\t\t\tif (! (errors instanceof Array)) \r\n\t\t\t\terrors = [errors]\r\n\t\t\terrors = errors.map(err => {\r\n\t\t\t\tif (! err.field) {\r\n\t\t\t\t\terr = {\r\n\t\t\t\t\t\tfield: this,\r\n\t\t\t\t\t\tmsg: err\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet $input = $(jq`#chan-${err.field}`)\r\n\t\t\t\t\tif ($input.length && $input[0].showErrors) {\r\n\t\t\t\t\t\terr.field = $input[0]\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (this.fieldActorMap.hasOwnProperty(err.field)) {\r\n\t\t\t\t\t\t\terr.field = window[this.fieldActorMap[err.field]]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\terr.field = this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\treturn err\r\n\t\t\t})\r\n\t\t\tlet fields = _.uniq(_.pluck(errors, 'field'))\r\n\t\t\tif (! _.includes(fields, this)) {\r\n\t\t\t\terrors.push({\r\n\t\t\t\t\tfield: this,\r\n\t\t\t\t\tmsg: 'fix-errors'\r\n\t\t\t\t})\r\n\t\t\t\tfields.push(this)\r\n\t\t\t}\r\n\t\t\tfields.forEach(field => {\r\n\t\t\t\tlet messages = _.pluck(_.filter(errors, {field: field}), 'msg')\r\n\t\t\t\t.map(msg => this.errorDescriptors[msg] || msg)\r\n\t\t\t\tfield.showErrors(_.uniq(messages))\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.showErrors([])\r\n\t\t\tif (res.action === 'new-success') {\r\n\t\t\t\t// library.deleteChan(upForm.candidate.id)\r\n\t\t\t\tdrafts.remove(upForm.candidate.id)\r\n\t\t\t\tdelete this.candidate.ball\r\n\t\t\t\tif (res.moveto) {\r\n\t\t\t\t\t// console.log(`Gotta move it to ${res.moveto}`);\r\n\t\t\t\t\tthis.candidate.section = res.moveto\r\n\t\t\t\t}\r\n\t\t\t\tlet sect = this.candidate.section\r\n\t\t\t\tlet added = library.addChan(this.candidate, sect, true)\r\n\t\t\t\tlibchan.load(added)\r\n\t\t\t\tconsole.log(upForm.candidate.id, this.candidate, sect);\r\n\t\t\t\t// libchan.setMode('edit', sect)\r\n\t\t\t}\r\n\t\t\tif (res.action === 'edit-success') {\r\n\t\t\t\tif (res.moveto) {\r\n\t\t\t\t\t// console.log(`Gotta move it to ${res.moveto}`);\r\n\t\t\t\t\tthis.candidate.section = res.moveto\r\n\t\t\t\t}\r\n\t\t\t\tlet edited = library.editChan(this.candidate)\r\n\t\t\t\tlibchan.load(edited)\r\n\t\t\t}\r\n\t\t\tif (res.action === 'delete-success') {\r\n\t\t\t\tlibrary.deleteChan(this.candidate.id)\r\n\t\t\t\tlibchan.setMode('new', 'draft')\r\n\t\t\t}\r\n\t\t\tif (res.action === 'sort-success') {\r\n\t\t\t\tlibrary.rebuild()\r\n\t\t\t}\r\n\t\t\tthis.toggle()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst DO_DEBUG = false;\r\n\r\n// Escape tag literal functions for jQuery queries and regular expressions\r\nvar jq = makeEscapeTagLiteralFn(v => v.replace(/([!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^`{|}~ ])/g, \"\\\\$1\"))\r\n, escHTML = makeEscapeTagLiteralFn(_.escape)\r\n\r\nfunction LSfetchJSON(key) {\r\n  let val = null, data = localStorage[key]\r\n  if (typeof data !== 'undefined') {\r\n    try {\r\n      val = JSON.parse(data)\r\n    }\r\n    catch(e) {\r\n      console.error(e)\r\n      localStorage.removeItem(key)\r\n    }\r\n  }\r\n  return val\r\n}\r\n\r\nfunction downloadJSON(obj, name) {\r\n\tvar dlAnchorElem = document.getElementById('dl-victim')\r\n\tdlAnchorElem.setAttribute(\"href\", \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(obj)))\r\n\tdlAnchorElem.setAttribute(\"download\", `${name}.json`)\r\n\tdlAnchorElem.click()\r\n}\r\n"],"mappings":"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"}