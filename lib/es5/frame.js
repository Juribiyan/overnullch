"use strict";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10;function _taggedTemplateLiteral(a,b){return b||(b=a.slice(0)),Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}var _WIKI="https://wiki.1chan.ca/",_SITENAME="\u041E\u0432\u0435\u0440\u043D\u0443\u043B\u044C\u0447";function main(){parent.allReady(),lazyBoy.init(),$.ajaxSetup({dataType:"json"}),$("body").on("click",".toggler",function(){$(jq(_templateObject||(_templateObject=_taggedTemplateLiteral(["#",""])),$(this).data("toggle"))).slideToggle("fast",function(){settings.onToggle($(this))})}),$("#pinunpin").click(parent.toggleBehavior),$(".menu-toggle").click(menu.toggle),$("#menu-show").on("mouseenter",function(){"vertical"==parent._frames.layout&&_.contains(["overlay","shift"],parent._frames.behavior)&&menu.open()}),settings.init(),chans.init(),live.init(),$("#refresh").click(function(){$(this).hasClass("script-installed")?parent.$("#main").attr("src",router.noFollow):$("#noscript-warning").fadeToggle("fast")}),"netscape"in window&&/ rv:/.test(navigator.userAgent)&&injector.inject("no-shadow-for-you",".showlive #live-toggle svg, #live-panel svg {filter: none!important; -webkit-filter: none!important;}")}function makeEscapeTagLiteralFn(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:function(a){return a};return function(b){for(var c="",d=0;d<b.length;d++)c+=b[d],d<(1>=arguments.length?0:arguments.length-1)&&(c+=a(""+(1>d+1||arguments.length<=d+1?void 0:arguments[d+1])));return c}}var jq=makeEscapeTagLiteralFn(function(a){return a.replace(/([!"#$%&'()*+,\-./:;<=>?@[\\\]^`{|}~ ])/g,"\\$1")}),rx=makeEscapeTagLiteralFn(_.escapeRegExp),menu={open:function open(){parent.openMenu()},close:function close(){parent.closeMenu()},toggle:function toggle(){parent._open?menu.close():menu.open()}},settings={flatProps:["hiddenChans","showDirs","useAnonym","headOnly"],assocProps:["hiddenCats","deletedCats","cachedUserboards"],init:function init(){var a=this;this.allProps=this.flatProps.concat(this.assocProps),["flatProps","assocProps"].forEach(function(b){a[b].forEach(function(c){var d=LSfetchJSON(c);a[c]=_.isEmpty(d)?"flatProps"===b?[]:{}:d})})},getChanSpecificPreferences:function getChanSpecificPreferences(a){var b=this,c={};return this.flatProps.forEach(function(d){c[d]=!!_.includes(b[d],a)}),this.assocProps.forEach(function(d){c[d]=b[d][a]||[]}),c},handleCheck:function handleCheck(a,b){var c=!_.includes(this[a],b),d=$(jq(_templateObject2||(_templateObject2=_taggedTemplateLiteral([".chan_",""])),b));return("showDirs"===a||"headOnly"===a)&&d.toggleClass(a,!!c),"useAnonym"===a&&d.find("a[data-href]").each(function(){var a=(c?"https://anonym.to?":"")+$(this).data("href");$(this).attr("href",a)}),this.toggle(b,a,c),!1},toggle:function toggle(a,b,c){c?this[b].push(a):this[b]=_.without(this[b],a),this.save()},toggleAssoc:function toggleAssoc(a,b,c,d){return this[a].hasOwnProperty(b)?d?this[a][b].push(c):this[a][b]=_.without(this[a][b],c):d&&(this[a][b]=[c]),this.save(),this[a][b].length},save:function save(a){var b=this,c=a?[a]:this.allProps;c.forEach(function(a){return localStorage[a]=JSON.stringify(b[a])})},onToggle:function onToggle(a){var b=a.is(":visible");if(a.hasClass("boards")){var c=a.attr("id").match(/^boards_(.+)/)[1];this.toggle(c,"hiddenChans",!b)}a.hasClass("cat-boards")&&this.toggleAssoc("hiddenCats",a.data("chid"),a.data("catname"),!b)},deleteCategory:function deleteCategory(a,b){var c=$(jq(_templateObject3||(_templateObject3=_taggedTemplateLiteral(["#cat_","_",""])),a,b)).parents(".category");c.hide(),this.toggleAssoc("deletedCats",a,b,!0),c.parents(".chan").find(".restore-cats").show()},restoreCats:function restoreCats(a){var b=$(jq(_templateObject4||(_templateObject4=_taggedTemplateLiteral([".chan_",""])),a));b.find(".category").show(),b.find(".restore-cats").hide(),this.deletedCats.hasOwnProperty(a)&&(this.deletedCats[a]=[],this.save())}};function handleBoardClick(a){handleLinkClick(a),$(a).addClass("boardover").parents(".chan").addClass("onchan")}function handleHomeClick(b){handleLinkClick(b),$(b).parents(".chan").addClass("onchan")}function handleLinkClick(b){$(".boardover").removeClass("boardover"),$(".onchan").removeClass("onchan"),"horizontal"==parent._frames.layout&&menu.close(),parent.history.replaceState(null,null,"/#/".concat(b.href))}var chans={own:{own:!0,id:"!OWN",wiki:"\u041E\u0432\u0435\u0440\u043D\u0443\u043B\u044C\u0447",boards:[{name:"",boards:[{desc:"\u041A\u0430\u0442\u0430\u043B\u043E\u0433 \u0441\u0430\u0439\u0442\u043E\u0432",dir:"catalog"},{desc:"\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0441\u0430\u0439\u0442\u043E\u0432",dir:"editor"},{desc:"Ballsmash",dir:"mash"},{desc:"\u0411\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u043B\u0443\u043F\u043E\u0432",dir:"loops"}]}],name:"\u041E\u0432\u0435\u0440\u043D\u0443\u043B\u044C\u0447",url:"//0chan.one"},build:function build(a){var b=this;this.model=a,$("#content").html([this.own].concat(a).reduce(function(a,c){return a+b.buildChan(c)},"")),this.insertWidgets();var c=localStorage.compiledCSS;c?injector.inject("framestyles",c):lessCompiler.compile(this.model.concat(this.own))},rebuildChan:function rebuildChan(a){this.model[_.findIndex(this.model,{id:a.id})]=a,$(jq(_templateObject5||(_templateObject5=_taggedTemplateLiteral([".chan_",""])),a.id)).html(this.buildChan(a)),this.insertWidgets(),this.sync()},buildChan:function buildChan(a){var b=this;_.assign(a,settings.getChanSpecificPreferences(a.id)),a.wiki&&a.wiki.match(/https?:\/\//)||(a.wiki=_WIKI+(a.wiki||a.name)),""===a.prefix&&delete a.prefix,_.defaults(a,this.defaults);var c=a.boards&&a.boards.length||a.userboards,d=a.own?"".concat(a.url,"/index.html"):(!a.own&&a.useAnonym?"https://anonym.to?":"")+a.url,e=_.escape(a.name),f="<div class=\"chan chan_".concat(a.id).concat(a.colors?"":" uncolorized").concat(a.headOnly?" headOnly":"").concat(a.showDirs?" showDirs":"").concat(c?"":" no-boards","\"><a onclick=\"handleHomeClick(this)\" target=\"main\" href=\"").concat(d,"\" class=\"chan-header head-link\" data-href=\"").concat(a.url,"\"").concat(a.own?" onclick=\"router.clearHash()\"":"","><div class=\"chan-name\">").concat(e,"</div></a><div class=\"chan-header\"><div class=\"chan-name toggler\" data-toggle=\"boards_").concat(a.id,"\">").concat(e,"</div></div><div class=\"chan-overlay chan-overlay-left\">").concat(c?"<a onclick=\"handleHomeClick(this)\" class=\"iconic-link home-link\" target=\"main\" href=\"".concat(d,"\" data-href=\"").concat(a.url,"\" title=\"\u0414\u043E\u043C\u0430\u0448\u043D\u044F\u044F \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0430\"").concat(a.own?" onclick=\"router.clearHash()\"":"","><svg class=\"icon\"><use xlink:href=\"#i-home\"></use></svg></a>"):"","<a class=\"iconic-link\" target=\"main\" href=\"").concat(a.wiki,"\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043D\u0430 \u0432\u0438\u043A\u0438\"><svg class=\"icon\"><use xlink:href=\"#i-info\"></use></svg></a></div><div class=\"chan-overlay chan-overlay-right\"><button class=\"toggler\" data-toggle=\"settings_").concat(a.id,"\" title=\"\u041C\u0435\u043D\u044E \u0441\u0430\u0439\u0442\u0430\"><svg class=\"icon\"><use xlink:href=\"#i-dots\"></use></svg></button></div><div class=\"chan-menu\" style=\"display:none\" id=\"settings_").concat(a.id,"\"><div class=\"settings-entry ifnoboards-hide\"><label for=\"showdirs_").concat(a.id,"\"><input type=\"checkbox\" id=\"showdirs_").concat(a.id,"\" ").concat(a.showDirs?"checked":""," onchange=\"settings.handleCheck('showDirs', '").concat(a.id,"')\"><span>\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u0438</span></label></div><div class=\"settings-entry ifnoboards-hide\"><label for=\"headonly_").concat(a.id,"\"><input type=\"checkbox\" id=\"headonly_").concat(a.id,"\" ").concat(a.headOnly?"checked":""," onchange=\"settings.handleCheck('headOnly', '").concat(a.id,"')\"><span>\u0421\u043A\u0440\u044B\u0442\u044C \u0434\u043E\u0441\u043A\u0438</span></label></div>").concat(a.own?"":"<div class=\"settings-entry\"><label for=\"useanonym_".concat(a.id,"\"><input type=\"checkbox\" id=\"useanonym_").concat(a.id,"\" ").concat(a.useAnonym?"checked":""," onchange=\"settings.handleCheck('useAnonym', '").concat(a.id,"')\"><span>\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C anonym.to</span></label></div><div class=\"settings-entry restore-cats\" ").concat(a.deletedCats.length?"":"style=\"display:none\"","><button class=\"trash-btn\" onclick=\"settings.restoreCats('").concat(a.id,"')\"><svg class=\"icon\"><use class=\"i-trash\" xlink:href=\"#i-trash\"></use><use class=\"i-trash-open\" xlink:href=\"#i-trash-open\"></use></svg><span>\u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438</span></button></div><div class=\"settings-entry\"><button onclick=\"chans.remove('").concat(a.id,"')\"><svg class=\"icon\"><use xlink:href=\"#i-delete\"></use></svg><span>\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438\u0437 \u0444\u0440\u0435\u0439\u043C\u0430</span></button></div>"),"</div>");this.preventRouterRegistering||router.register(a);var g=a.boards;if(widgets.supported.forEach(function(b){a.hasOwnProperty(b)&&(g=[{name:widgets[b].name,widgetType:b,widgetID:widgets[b].newWidget(a[b],a.id)}].concat(g))}),a.userboards){a.userboards_system||(a.userboards_system="instant"),g=[{name:a.userboards_catname,boards:a.cachedUserboards,userboards:!0}].concat(g);var h=function(c){var d=normalizeUbrds[a.userboards_system](c);_.eq(a.cachedUserboards,d)||b.updateUserboards(a,d)},i=!!localStorage["cors:".concat(a.id)];$.get(i?"/cors-proxy.php?url=".concat(a.userboards):a.userboards).done(function(b){i?200==b.status.http_code?(console.info("Loaded ".concat(a.userboards," using cors-proxy")),h(b.contents)):console.error("Unable to load ".concat(a.userboards," using cors-proxy"),b):(console.info("Loaded ".concat(a.userboards)),h(b))}).fail(function(){i?console.error("Unable to load ".concat(a.userboards," using cors-proxy")):(console.warn("Unable to load ".concat(a.userboards," natively; will try to use cors-proxy...")),$.get("/cors-proxy.php?url=".concat(a.userboards)).done(function(b){200==b.status.http_code?(localStorage["cors:".concat(a.id)]=1,console.info("Loaded ".concat(a.userboards," using cors-proxy")),h(b.contents)):console.error("Unable to load ".concat(a.userboards," using cors-proxy"),b)}).fail(function(){console.error("Unable to load ".concat(a.userboards," using cors-proxy"))}))})}return g&&g.length&&(f+="<div class=\"boards\" id=\"boards_".concat(a.id,"\" ").concat(a.hiddenChans?"style=\"display:none\"":"",">")+g.reduce(function(c,d){return c+b.buildCat(a,d,!(1<g.length))},"")+"</div>"),f+="</div>",f},buildCat:function buildCat(a,b,c){b.name=_.escape(b.name).replace(" ","\xA0");var d=b.widgetType?"!".concat(b.widgetType):b.name,e=_.includes(a.hiddenCats,d),f=b.boards&&b.boards.length,g=!b.widgetID&&!f||_.includes(a.deletedCats,d),h="<div class=\"category".concat(b.userboards?" userboards":"","\"").concat(g?" style=\"display:none\"":"").concat(b.widgetID?" data-widget=\"".concat(b.widgetID,"\""):"",">");return c||(h+="<div class=\"cat-header toggler\" data-toggle=\"cat_".concat(a.id,"_").concat(d,"\"><div class=\"ch-name\">").concat(b.name,"</div><div class=\"cat-options\"><svg class=\"icon i-delete del-cat\" onclick=\"event.stopPropagation();settings.deleteCategory('").concat(a.id,"', '").concat(d,"')\"><use xlink:href=\"#i-delete\"></use></svg></div></div>")),(f||b.widgetID)&&(h+="<div class=\"cat-boards\"".concat(e?" style=\"display:none\"":"").concat(c?"":" id=\"cat_".concat(a.id,"_").concat(d,"\" data-chid=\"").concat(a.id,"\" data-catname=\"").concat(d,"\""),">")),f&&(b.boards.forEach(function(b){var c=_.escape(b.desc),d=_.escape(b.dir),e=b.external?b.url:a.url+a.prefix+d+a.postfix,f=(a.useAnonym?"https://anonym.to?":"")+e;h+="<a target=\"main\" href=\"".concat(f,"\" class=\"board").concat(b.external?" external":"","\" data-href=\"").concat(e,"\" data-dir=\"").concat(d,"\" onclick=\"handleLinkClick(this)\">").concat(b.external?"":"<span class=\"board-dir\">/".concat(d,"/ - </span>"),"<span class=\"board-name\">").concat(c,"</span></a>")}),h+="</div>"),b.widgetID&&(h+="<div class=\"widget-placeholder\" id=\"".concat(b.widgetID,"\"></div></div>")),h+="</div>",h},defaults:{userboards_catname:"2.0",prefix:"/",postfix:""},init:function init(){var a=this,b=LSfetchJSON("myChans_new");b&&this.build(b);var c=[new Promise(function(a,b){$.getJSON("/chans/chans.json?v=".concat(new Date().getTime())).done(function(b){b.origin="server",a(b)}).fail(b)})],d=LSfetchJSON("mydrafts");d&&d.chans&&c.push(new Promise(function(a){var b=[];d.chans.forEach(function(a){a.name&&a.url&&(a.id="".concat(a.id,"!draft"),b.push(a))}),a({origin:"drafts",chans:b,version:d.version||"unknown"})}));var e=LSfetchJSON("catalogVersions");Promise.all(c).then(function(c){var d={},f=[],g=[];if(c.forEach(function(c){d[c.origin]=c.version,f=f.concat(c.chans);var h=e?+e[c.origin]||null:null;if(b&&b.length&&h!==+c.version){g.push({origin:c.origin,version:c.version});var i="drafts"==c.origin?{section:"drafts"}:function(a){return"default"==a.section||"custom"==a.section||"offline"==a.section};_.map(_.filter(b,i),"id").forEach(function(b){var d=_.find(c.chans,{id:b});d?a.rebuildChan(d):(a.remove(b),console.warn("Removed unknown chan #".concat(b," from frame")))})}}),f.forEach(router.register.bind(router)),a.preventRouterRegistering=!0,!(b&&b.length)){localStorage.removeItem("compiledCSS");var h=_.filter(f,"included");_.remove(h,"offline"),a.build(h)}g.length&&(lessCompiler.compile(a.model.concat(a.own)),g.forEach(function(a){console.info("Updated ".concat(a.origin,"-originated chans' cache to v.=").concat(a.version))})),a.versions=d,a.sync()})},preventRouterRegistering:!1,remove:function remove(a){return _.remove(this.model,{id:a}),$(jq(_templateObject6||(_templateObject6=_taggedTemplateLiteral([".chan_",""])),a)).remove(),this.sync(),!1},updateUserboards:function updateUserboards(a,b){var c={name:a.userboards_catname,boards:b,userboards:!0};$(jq(_templateObject7||(_templateObject7=_taggedTemplateLiteral([".chan_"," .userboards"])),a.id)).replaceWith(this.buildCat(a,c,!1)),settings.cachedUserboards[a.id]=b,settings.save("cachedUserboards")},sync:function sync(){_.each(this.model,function(a){return delete a.cachedUserboards}),localStorage.catalogVersions=JSON.stringify(this.versions),localStorage.myChans_new=JSON.stringify(this.model)},insertWidgets:function insertWidgets(){document.querySelectorAll(".widget-placeholder").forEach(function(a){var b=a.getAttribute("id");if(widgets.pool.hasOwnProperty(b)){var c=widgets.pool[b];a.parentNode.replaceChild(c.el,a)}})}},normalizeUbrds={instant:function instant(a){return a.map(function(a){return a.name&&(a.dir=a.name),a})},"0chan":function chan(a){return a.boards.map(function(a){return a.desc=a.name,a})},meguca:function meguca(a){return a.map(function(a){return a.dir=a.id,a.desc=a.title,a})},lynxchan:function lynxchan(a){return a.boards.map(function(a){return a.dir=a.boardUri,a.desc=a.boardName,a})},vichan:function vichan(a){return a.map(function(a){return a.dir=a.uri,a.desc=a.title,a})},"4chan":function chan(a){return a.boards.map(function(a){return a.dir=a.board,a.desc=a.title,a})},sosach:function sosach(a){return a.boards.map(function(a){return a.dir=a.id,a.desc=a.name,a})},jschan:function jschan(a){return a.boards.map(function(a){return a.dir=a.uri,a.desc=a.title,a})}};function LSfetchJSON(a){var b=null,c=localStorage[a];if("undefined"!=typeof c)try{b=JSON.parse(c)}catch(b){console.error(b),localStorage.removeItem(a)}return b}var lessCompiler={compile:function compile(a){var b=this,c="";a.forEach(function(a){if(a.colors){var d=("chan_"+a.id).replace("!","\\!");c+=".".concat(d," { \n          @bgcolor: #").concat(a.colors[0],";  @linkcolor: #").concat(a.colors[1],"; ")+(a.advanced_less||b.base)+"}\n\n"}}),less.render(c,function(a,b){a?console.error(a):(localStorage.compiledCSS=b.css,injector.inject("framestyles",b.css))})},base:"background: @bgcolor; a, .chan-overlay .icon { color: @linkcolor; } &:hover { background: darken(@bgcolor, 8%); } &.onchan { box-shadow: inset -2px 0 fadeout(@linkcolor, 25%); } & when (lightness(@bgcolor) < 70%) { color: #C3C3C3; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: white; } .board:hover { background: rgba(255, 255, 255, .08); } } & when (lightness(@bgcolor) > 70%) { color: #404040; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: black; } .board:hover { background: rgba(0, 0, 0, .08); } }"};NodeList.prototype.forEach=Array.prototype.forEach;var injector={inject:function inject(a,b){var c="injector:".concat(a),d=document.getElementById(c);if(d)return void(d.innerHTML=b);var e=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.type="text/css",f.id=c,f.styleSheet?f.styleSheet.cssText=b:f.appendChild(document.createTextNode(b)),e.appendChild(f)},remove:function remove(a){var b="injector:".concat(a),c=document.getElementById(b);if(c){var d=document.head||document.getElementsByTagName("head")[0];d&&d.removeChild(document.getElementById(b))}}},widgets={pool:{},supported:["radio"]};widgets.radio={name:"\u0420\u0430\u0434\u0438\u043E",newWidget:function newWidget(a,b){var c=this,d={streams:[],currentStream:null,url:a.url,$el:$("<div class=\"radio-widget disabled\"></div>")},e={volume:+(localStorage["radio_".concat(b,"_volume")]||1),stream:+(localStorage["radio_".concat(b,"_streamid")]||0)};a.streams.forEach(function(a){if(a.hasOwnProperty("n")){var b=_.template(a.name),e=_.template(a.path);c.mixedRange(a.n).forEach(function(c){d.streams.push({name:b({n:c}),path:e({n:c}),mime:a.mime})})}else d.streams.push(a)}),d.audio=$("<audio controls>").appendTo(d.$el)[0],d.playPause=this.playPause.bind(d),d.audio.volume=e.volume,d.audio.onloadeddata=function(){return d.$el.removeClass("disabled")},$("<div class=\"rw-playpause\"><div class=\"pause-icon\"></div><div class=\"play-icon\"></div></div>").appendTo(d.$el).click(d.playPause);var f=$("<div class=\"select-wrapper\">"),g=[];d.streams.forEach(function(a,b){g.push("<option value=\"".concat(b,"\">").concat(a.name,"</option>"))}),d.setStream=this.setStream.bind(d),$("<select>").append(g).val(e.stream).change(function(){d.setStream(+this.value),localStorage["radio_".concat(b,"_streamid")]=+this.value}).appendTo(f),f.appendTo(d.$el),lazyBoy.addJob(function(){return d.setStream(e.stream)});var h=this.buildVolumeter(b,70,20,function(a){d.audio.volume=a,localStorage["radio_".concat(b,"_volume")]=a},e.volume);return d.$el.append(h),d.reflectVolumeChange=h.setV,d.setVolume=this.setVolume.bind(d),d.onCategoryClose=function(){d.audio.paused||d.playPause()},d.el=d.$el[0],widgets.pool["radio_".concat(b)]=d,"radio_".concat(b)},all:{},setStream:function setStream(a){if(this.currentStream!==a){var b=this.streams[a],c=!this.audio.paused;this.audio.setAttribute("src",this.url+b.path),this.audio.setAttribute("type",b.mime),c&&this.audio.play()}},setVolume:function setVolume(a){this.audio.volume=a,this.reflectVolumeChange(a)},playPause:function playPause(a){a=a||null,3==this.audio.networkState?(this.audio.pause(),this.$el.removeClass("streaming")):this.audio.paused?($(".radio-widget audio").each(function(){this.pause()}),this.audio.play(),this.$el.addClass("streaming")):(this.audio.pause(),this.$el.removeClass("streaming"))},buildVolumeter:function buildVolumeter(a,b,c,d,e){function f(a){if(l){var c=(a.pageX-g.offset().left)/b;0>c&&(c=0),1<c&&(c=1),g.setV(c),d&&d(c)}}e=e||1;var g=$("<div class=\"volumeter\">"),h=function(a){var d=function(a){return document.createElementNS("https://www.w3.org/2000/svg",a)},e=d("svg");e.setAttribute("width",b),e.setAttribute("height",c),e.setAttribute("viewBox","0 0 ".concat(b," ").concat(c)),e.classList.add(a);var f=d("polygon");return f.setAttribute("points","0,".concat(c," ").concat(b,",0 ").concat(b,",").concat(c)),e.appendChild(f),e},i=h("vm-bg"),j=h("vm-fg"),k=$("<div class=\"vm-fg-wrapper\">");k[0].appendChild(j),g.append(k),g[0].appendChild(i),g.setV=function(a){return k.css({width:"".concat(a*b,"px")})},g.setV(e);var l=!1;return g.mousedown(function(a){l=!0,f(a)}),$("body").mousemove(f).on("mouseup mouseleave blur",function(){l=!1}),g},mixedRange:function mixedRange(a){for(var b,c=[],d=/(?:([0-9]+)(?:\-([0-9]+))?(?:, ?)?)/g;null!==(b=d.exec(a));)b.index===d.lastIndex&&d.lastIndex++,b[2]?c=c.concat(_.range(b[1],+b[2]+1)):c.push(+b[1]);return c}};var router={chans:{},register:function register(a){this.chans[a.id]={exp:new RegExp(rx(_templateObject8||(_templateObject8=_taggedTemplateLiteral(["^(https?://",")(?:","([^/?#]+))?"],["^(https?:\\/\\/",")(?:","([^\\/\\?#]+))?"])),a.url.split(/^https?:\/\//)[1]||a.url,a.prefix||chans.defaults.prefix)),name:a.name,boards:_.flatten(_.map(a.boards,"boards"))}},currentHash:"",determineIdentity:function determineIdentity(a){var b=null;return _.find(this.chans,function(c,d){var e=c.exp.exec(a);if(null!==e){var f=e[2]||null;if(b={id:d,name:c.name},f){b.dir=f;var g=_.find(c.boards,{dir:f});g&&(b.desc=g.desc)}return 1}return!1}),b},indicateOn:function indicateOn(a){var b=$(jq(_templateObject9||(_templateObject9=_taggedTemplateLiteral([".chan_",""])),a.id)),c="!OWN"===a.id,d=c?"":a.name;if($(".onchan").removeClass("onchan"),$(".boardover").removeClass("boardover"),b.length&&b.addClass("onchan"),a.dir){a.dir=decodeURIComponent(a.dir);var e=b.find(jq(_templateObject10||(_templateObject10=_taggedTemplateLiteral(["a[data-dir=\"","\"]"])),a.dir));e.length&&(e.addClass("boardover"),!a.desc&&(a.desc=e.find(".board-name").text())),a.desc&&(d+=(c?"":":")+a.desc)}parent.document.title=(d?"".concat(d," \u2022 "):"")+_SITENAME},sync:function sync(a){if("string"==typeof a.data){if(a.data.match(/overnullchlive\.html/)){parent.script_installed=!0,scriptInstalled();try{parent.frames.main.scriptInstalled()}catch(a){}return}if(a.data.split(/\/$/)[0]==parent.location.protocol+"//"+parent.location.host)return parent.frames.main.location.href="/index.html",void(this.noFollow="/index.html");router.noFollow=a.data,parent.history.replaceState(null,null,"/#/"+a.data);var b=router.determineIdentity(a.data);b?router.indicateOn(b):parent.document.title=_SITENAME}},follow:function follow(){if(parent.location.hash&&this.noFollow.split(/#\/?/)[1]!==parent.location.hash){var a=parent.location.hash.split(/#\/?/)[1];parent.frames.main.location.href=a,this.noFollow=a}},clearHash:function clearHash(){parent.document.title=_SITENAME,parent.history.replaceState({},parent.document.title,"/")},noFollow:!1};function scriptInstalled(){$("#refresh").addClass("script-installed").attr("title","\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C")}var lazyBoy={init:function init(){$(window).on("load",this.execute.bind(this))},que:[],execute:function execute(){for(this.ready=!0;this.que.length;)this.que.splice(0,1)[0]()},addJob:function addJob(a){this.ready?a():this.que.push(a)},ready:!1};window.addEventListener("message",router.sync,!1);try{parent.frames.main.document.location.pathname.match(/catalog/)&&parent.frames.main.window.postMessage("overnullchlive.html",chans.own.url)}catch(a){}function check3d(){if(!window.getComputedStyle)return!1;var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var d in document.body.insertBefore(b,null),c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&0<a.length&&"none"!==a}var live={init:function init(){var a=this,b="transform: translate".concat(check3d()?"3d":"","(-50%").concat(check3d()?",0,0":"",");");injector.inject("paneshift",".showlive .pane-container { ".concat(b," -o-").concat(b," -webkit-").concat(b," -moz-").concat(b," -ms-").concat(b," }")),this.update(),$("#live-toggle").click(function(){return"horizontal"!=parent._frames.layout||parent._open?void a.toggle():(menu.open(),void a.toggle(!0))}),$("#live-add").click(this.showForm.bind(this)),$("#live-refresh").click(this.update.bind(this)),this.scheduleUpdate(60000)},update:function update(){var a=this;$.get("/live/live.json?v=".concat(new Date().getTime())).done(function(b,c,d){a.hasOwnProperty("currentList")&&a.currentList===d.responseText||(a.build(b),a.currentList=d.responseText)})},toggle:function toggle(a){$("body").toggleClass("showlive",a)},build:function build(a){var b=this;$("#live-content").html(a.reduce(function(a,c){return a+b.buildLink(c)},""))},buildLink:function buildLink(a){return"<a target=\"main\" href=\"".concat(_.escape(a.url),"\" class=\"board external\" onclick=\"handleBoardClick(this)\"><span class=\"board-name\">").concat(_.escape(a.description),"</span><span class=\"link-domain\">").concat(_.escape(this.getDomainName(a.url)),"</span></a>")},showForm:function showForm(){"horizontal"==parent._frames.layout&&menu.close(),parent.frames.live.$("#url").val(parent.location.hash.split(/^#\/?/)[1]),parent.toggleShare(),parent.frames.live.$("#description").focus()},getDomainName:function getDomainName(a){return a.match(/^https?:\/\/(?:www\.)?([^\/#\?]+)/i)[1]},scheduleUpdate:function scheduleUpdate(a){clearInterval(this.interval),this.interval=setInterval(this.update.bind(this),a)}};
//# sourceMappingURL=frame.js.map