"use strict";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5;function _taggedTemplateLiteral(a,b){return b||(b=a.slice(0)),Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}var main=function(){$.ajaxSetup({dataType:"json"}),$("#drawer, #hijab").click(function(){return $("body").toggleClass("list-collapsed")});var a=[new Promise(function(a,b){$.getJSON("/chans/chans.json?v=".concat(new Date().getTime())).done(function(b){catalog.add(b.chans),a({origin:"server",version:b.version})}).fail(function(a){return b(a)})})];if(localStorage.mydrafts){var b=null;try{b=JSON.parse(localStorage.mydrafts),catalog.myDraftsRaw=_.cloneDeep(b.chans)}catch(a){localStorage.removeItem("mydrafts"),console.error(a)}b.chans&&a.push(new Promise(function(a){var c=[];b.chans.forEach(function(a){a.name&&a.url&&a.id&&a.id.match(/^[a-z\-_0-9]+$/)?(a.originalID=a.id,a.id+="!draft",c.push(a)):errorBoy.pushError("\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A #".concat(a.id," \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u0430\u0442\u0430\u043B\u043E\u0433: \u043D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u043B\u0438 \u043D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 ID."))}),catalog.add(c,"drafts"),a({origin:"drafts",version:b.version})}))}Promise.all(a).then(list.init.bind(list),function(a){return console.error(a)}),$(".tab").click(function(a){var b=$(this).parent().find(".icon");if("block"===b.css("display")&&1==b.css("opacity"))a.stopPropagation(),$("#catalog header").addClass("tab-selecting");else{var c=$(this).text().toLowerCase();switchTab(c)}});var c=localStorage["cat-tab"];c&&switchTab(c),$("#toggle-search").click(function(){$("#catalog").addClass("searching"),$("#search").focus()}),$("#search").on("input",function(){var a=$(this).val().trim().toLowerCase();$("#catalog").toggleClass("search-filter",!!a.length),injector.inject("cat-search",".search-filter .cat-chan[data-search *= \"".concat(a,"\"] {display: inline-block}"))}),$("#cancel-search").click(function(){$("#catalog").removeClass("searching search-filter"),$("#search").val("")}),$("body").click(function(){return $("#catalog header").removeClass("tab-selecting")}).on("click",".cc-install",function(){var a=$(this).parents(".cat-chan");list.toggle(a[0]._libdata)}).on("click",".make-embed",function(){$(this).parents(".cat-chan").toggleClass("code-on")}).on("dragenter dragend dragover drop dragleave",function(a){a.preventDefault(),a.stopPropagation()}).on("drop",function(a){return handleFile(a.originalEvent)}),$("#up-victim").on("change",function(a){return handleFile(a.originalEvent)}),$("#import-draft").click(function(){return $("#up-victim").click()})};function switchTab(a){$(".tab").removeClass("tab-selected"),$(jq(_templateObject||(_templateObject=_taggedTemplateLiteral(["#tab-",""])),a)).addClass("tab-selected"),$("#catalog").removeClass("tab-default tab-custom tab-offline tab-drafts").addClass("tab-".concat(a)),localStorage["cat-tab"]=a}var errorBoy={pushError:function pushError(a){$("#error-wrapper").append("<div class=\"errmsgbox\" onclick=\"this.remove()\"><svg id=\"close-errmsg\" class=\"icon\"><use xlink:href=\"#i-x\"></use></svg><p class=\"error-message\">".concat(_.escape(a),"</p></div>"))}},list={init:function init(a){var b={};a.forEach(function(a){return b[a.origin]=a.origin}),this.versions=b,localStorage.catalogVersions=JSON.stringify(b),this.sortable=Sortable.create(document.querySelector("#boardlist"),{handle:".dragger",animation:150,onSort:this.sync.bind(this)});var c=localStorage.myChans_new,d=[];if(c){try{c=JSON.parse(c)}catch(a){console.error(a),localStorage.removeItem("myChans_new"),c=null}c&&c.length&&c.forEach(function(a){var b=catalog.chanByID(a.id);b&&d.push(b)})}c||$(".included-chan").each(function(){d.push(this._libdata)}),this.add(d)},add:function add(a){var b=this;arrayify(a).forEach(function(a){["catbg","offset"].forEach(function(b){return delete a[b]});var c=$(b.buildChan(a));c[0]._libdata=a,$("#boardlist").append(c),$(jq(_templateObject2||(_templateObject2=_taggedTemplateLiteral(["#cat_",""])),a.id)).addClass("installed")}),this.sync()},buildChan:function buildChan(a){var b=_.escape(a.name),c=a.ball||"/chans/balls/".concat(a.section,"/").concat("drafts"==a.section?"no-ball":a.id,".png?uid=").concat(a._id).concat(a.ballv?"&v=".concat(a.ballv):"");return"<li class=\"list-chan\" id=\"installed_".concat(a.id,"\" data-id=\"").concat(a.id,"\"><img src=\"").concat(c,"\" class=\"list-chanball\"><div class=\"dragger\"><svg class=\"icon\"><use xlink:href=\"#i-drag\"></use></div><div class=\"list-chan-title\">").concat(b||"\u0411\u0435\u0437 \u0438\u043C\u0435\u043D\u0438","</div><div class=\"delete-chan\" onclick=\"javascript:list.remove('").concat(a.id,"')\"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></div></li>")},toggle:function toggle(a){_.includes(this.sortable.toArray(),a.id)?this.remove(a.id):this.add(a)},remove:function remove(a){$(jq(_templateObject3||(_templateObject3=_taggedTemplateLiteral(["#installed_",""])),a)).remove(),$(jq(_templateObject4||(_templateObject4=_taggedTemplateLiteral(["#cat_",""])),a)).removeClass("installed"),this.sync()},sync:function sync(){var a=[];document.querySelectorAll(".list-chan").forEach(function(b){a.push(b._libdata)}),localStorage.removeItem("compiledCSS"),localStorage.myChans_new=JSON.stringify(a)}},catalog={add:function add(a,b){var c=this;arrayify(a).forEach(function(a){a.section||(a.section=b||(a.offline?"offline":a["default"]?"default":"custom")),a.url=_.escape(a.url);var d=$(c.buildChan(a));d[0]._libdata=a,$("#catalog-contents").append(d),c.css+=c.makeOffset(a)}),$("#import-draft").insertAfter(".cat-chan:last"),injector.inject("chan-offsets",this.css)},buildChan:function buildChan(a){var b=_.escape(a.name),c=a.wiki&&a.wiki.match(/https?:\/\//)?a.wiki:conf.wiki+(a.wiki||b),d="".concat(a.originalID||a.id," ").concat(b," ").concat(a.url.replace(/^https?:\/\//,"")," ").concat((a.wiki||"").replace(/^https?:\/\//,"")),e=a.ball||"/chans/balls/".concat(a.section,"/").concat("drafts"==a.section?"no-ball":a.id,".png?uid=").concat(a._id).concat(a.ballv?"&v=".concat(a.ballv):"");return"<div class=\"cat-chan sect-".concat(a.section," ").concat(a.included?"included-chan":"","\" data-search=\"").concat(d.toLowerCase(),"\" id=\"cat_").concat(a.id,"\"><div class=\"cc-ball-wrap\" style=\"").concat(makeGradient(a.catbg),"\"><img src=\"").concat(e,"\" class=\"cc-ball\"></img><div class=\"channame-overlay\"><a href=\"").concat(a.url,"\">").concat(b,"</a></div></div><div class=\"cc-toolbar\"><button class=\"cc-install\"><span class=\"cci-i\">\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C</span><span class=\"cci-u\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</span></button></div><div class=\"chan-options make-embed\" title=\"\u041A\u043E\u0434 \u0434\u043B\u044F \u043A\u043D\u043E\u043F\u043A\u0438\"><svg class=\"icon\"><use class=\"co-code\" xlink:href=\"#i-code\"></use><use class=\"co-close\" xlink:href=\"#i-x\"></use></svg></div><a class=\"chan-options info-link\" target=\"_blank\" href=\"").concat(c,"\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F\"><svg class=\"icon\"><use xlink:href=\"#i-info\"></use></svg></a><textarea onclick=\"this.select()\">").concat(_.escape("<script src=\"".concat(document.location.origin||document.location.protocol+"//"+document.location.host,"/embed/add.js\" chan=\"").concat(a.id,"\"></script>")),"</textarea></div>")},css:"",makeOffset:function makeOffset(a){if(!a.offset)return"";var b=a.offset[0],c=a.offset[1],d="",e="";return 0==b&&0==c?"":(["","-webkit-","-ms-","-moz-","-o-"].forEach(function(a){var f=Math.round;d+="".concat(a,"transform: translate(").concat(b,"px, ").concat(c,"px) scale(1); "),e+="".concat(a,"transform: translate(").concat(f(.66*b),"px, ").concat(f(.66*c),"px) scale(0.66); ")}),"#cat_".concat(a.id.replace(/\!/g,"\\!")," .cc-ball {").concat(d,"}\n\t\t\t#cat_").concat(a.id.replace(/\!/g,"\\!"),":hover .cc-ball {").concat(e,"}"))},chanByID:function chanByID(a){var b=document.querySelector(jq(_templateObject5||(_templateObject5=_taggedTemplateLiteral(["#cat_",""])),a));return b&&b._libdata?b._libdata:null},myDraftsRaw:[],syncRawDrafts:function syncRawDrafts(){localStorage.mydrafts=JSON.stringify({version:new Date().getTime(),chans:this.myDraftsRaw})}};function arrayify(a){return a instanceof Array?a:[a]}var injector={inject:function inject(a,b){var c="injector:".concat(a),d=document.getElementById(c);if(d)return void(d.innerHTML=b);var e=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.type="text/css",f.id=c,f.styleSheet?f.styleSheet.cssText=b:f.appendChild(document.createTextNode(b)),e.appendChild(f)},remove:function remove(a){var b="injector:".concat(a),c=document.getElementById(b);if(c){var d=document.head||document.getElementsByTagName("head")[0];d&&d.removeChild(document.getElementById(b))}}};function makeGradient(a){var b="linear-gradient(to bottom, #".concat(a[0]," 0%, #").concat(a[1]," 100%)"),c=/(((?:radial|linear)-gradient)\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\));?/i.exec(b);if(null===c)return"background:"+b;c=_.rest(_.without(c,void 0));var d,e=c[0]+"; ",f=c[1];d=isNaN(c[2])?"bottom"==c[2]?"top, ":"right"==c[2]?"left, ":"center, ellipse cover, ":90-parseFloat(c[2])+"deg, ";var g=c[3];return _.each(["-o-","-webkit-","-moz-"],function(a){e+="background:"+a+f+"("+d+g+"); "}),"background:"+e}NodeList.prototype.forEach=Array.prototype.forEach;var jq=makeEscapeTagLiteralFn(function(a){return a.replace(/([!"#$%&'()*+,\-./:;<=>?@[\\\]^`{|}~ ])/g,"\\$1")}),conf={wiki:"http://wiki.1chan.ca/"};function reloadFrame(){parent.frames.list.document.location.reload(),parent.openMenu()}window.addEventListener("message",function(){parent.frames.live.document.location.reload()},!1);function handleFile(a){var b="drop"==a.type?a.dataTransfer.files:a.target.files,c=b[0];if(c){var d=new FileReader;d.onload=function(){return function(a){var b=null;try{b=JSON.parse(a.target.result)}catch(a){errorBoy.pushError("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0440\u0430\u0437\u043E\u0431\u0440\u0430\u0442\u044C JSON")}if(b){if(!(b.name&&b.url&&b.id&&b.id.match(/^[a-z\-_0-9]+$/)))return void errorBoy.pushError("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A. \u041D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u0434\u0430\u043D\u043D\u044B\u0445.");if(_.find(catalog.myDraftsRaw,{id:b.id}))return void errorBoy.pushError("\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A \u0441 \u0442\u0430\u043A\u0438\u043C id \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442");catalog.myDraftsRaw.push(_.cloneDeep(b)),catalog.syncRawDrafts(),b.id+="!draft",catalog.add(b,"drafts")}}.bind(this)}.bind(this)(c),d.readAsText(c)}}console.info("\u042F \u043D\u0435 \u043D\u0430 \u0430\u043D\u0433\u0443\u043B\u044F\u0440\u0435. \u041D\u0435 \u043D\u0430 \u0430\u043D\u0433\u0443\u043B\u044F\u0440\u0435.");
//# sourceMappingURL=catalog.js.map