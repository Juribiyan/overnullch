{"version":3,"file":"live.js","names":["main","location","search","_url","exec","_description","decodeURIComponent","$","val","ajaxSetup","dataType","click","parent","toggleShare","on","ev","preventDefault","addClass","post","url","description","done","handleResponse","bind","removeClass","data","error","err","text","errorDescriptors","hasOwnProperty","errtype","errdata","inFrame","_frames","frames","list","live","build","toggle","layout","menu","open","setTimeout","secs"],"sources":["../../babel/src/live.js"],"sourcesContent":["\"use strict\"\r\n\r\nfunction main() {\r\n  if (location.search) {\r\n    let _url = /url=([^&]+)/.exec(location.search)\r\n    , _description = /description=([^&]+)/.exec(location.search)\r\n    if (_url) {\r\n      _url = decodeURIComponent(_url[1])\r\n      $('#url').val(_url)\r\n    }\r\n    if (_description) {\r\n      _description = decodeURIComponent(_description[1])\r\n      $('#description').val(_description)\r\n    }\r\n  }\r\n\r\n\t$.ajaxSetup({ dataType: 'json' })\r\n  $('#closer').click(parent.toggleShare)\r\n  $('form').on('submit', function(ev) {\r\n  \tev.preventDefault()\r\n  \t$(this).addClass('busy')\r\n  \t$.post('api.php', {\r\n  \t\turl: $('#url').val(),\r\n  \t\tdescription: $('#description').val()\r\n  \t})\r\n  \t.done(handleResponse.bind(this))\r\n  })\r\n  $('#error-wrapper').click(() => $('form').removeClass('error'))\r\n}\r\n\r\nfunction handleResponse(data) {\r\n\t$('form').removeClass('busy'); \r\n\tif (data.error) {\r\n\t\tlet err = data.error\r\n\t\t$('form').addClass('error'); \r\n\t\t$('#errorbox')\r\n\t\t.text(typeof err === 'string'\r\n\t\t\t? errorDescriptors[err] || err\r\n\t\t\t: (errorDescriptors.hasOwnProperty(err.errtype)\r\n\t\t\t\t? errorDescriptors[err.errtype](err.errdata)\r\n\t\t\t\t: `${err.errtype} (${err.errdata})`)\r\n\t\t)\r\n\t}\r\n\telse {\r\n    let inFrame = false;\r\n    if (parent._frames && parent.frames.list && parent.frames.live) {\r\n      parent.frames.list.live.build(data.data)\r\n      parent.frames.list.live.toggle(true)\r\n      if (parent._frames.layout == 'horizontal') {\r\n        parent.frames.list.menu.open()\r\n      }\r\n      inFrame = true;\r\n    }\r\n\t\t$('form').addClass('success'); \r\n\t\tsetTimeout(() => {\r\n      if (inFrame) {\r\n        parent.$('#live').removeClass('shown'); \r\n      }\r\n\t\t\t$('input').val('')\r\n\t\t}, 1500)\r\n\t\tsetTimeout(() => {\r\n\t\t\t$('form').removeClass('success');\r\n\t\t}, 2000)\r\n\t}\r\n}\r\n\r\nconst errorDescriptors = {\r\n\t'no-data-provided': 'Недостаточно данных',\r\n\t'url-too-long': 'Слишком длинный URL',\r\n\t'description-too-long': 'Слишком длинное описание',\r\n\t'description-too-short': 'Слишком короткое описание',\r\n\t'bad-url': 'Неверный формат SQL',\r\n\t'url-exists': 'Данная ссылка уже присутствует в списке',\r\n\t'timeout': secs => `Таймаут ${secs} сек.`,\r\n\t'sql-error': 'Ошибка SQL'\r\n}"],"mappings":"AAAA,YAAY,CAEZ,QAASA,KAAI,EAAG,CACd,GAAIC,QAAQ,CAACC,MAAM,CAAE,CACnB,GAAIC,EAAI,CAAG,aAAa,CAACC,IAAI,CAACH,QAAQ,CAACC,MAAM,CAAC,CAC5CG,CAAY,CAAG,qBAAqB,CAACD,IAAI,CAACH,QAAQ,CAACC,MAAM,CAAC,CACxDC,CAAI,GACNA,CAAI,CAAGG,kBAAkB,CAACH,CAAI,CAAC,CAAC,CAAC,CAAC,CAClCI,CAAC,CAAC,MAAM,CAAC,CAACC,GAAG,CAACL,CAAI,CAAC,EAEjBE,CAAY,GACdA,CAAY,CAAGC,kBAAkB,CAACD,CAAY,CAAC,CAAC,CAAC,CAAC,CAClDE,CAAC,CAAC,cAAc,CAAC,CAACC,GAAG,CAACH,CAAY,CAAC,CAEvC,CAEDE,CAAC,CAACE,SAAS,CAAC,CAAEC,QAAQ,CAAE,MAAO,CAAC,CAAC,CAChCH,CAAC,CAAC,SAAS,CAAC,CAACI,KAAK,CAACC,MAAM,CAACC,WAAW,CAAC,CACtCN,CAAC,CAAC,MAAM,CAAC,CAACO,EAAE,CAAC,QAAQ,CAAE,SAASC,CAAE,CAAE,CACnCA,CAAE,CAACC,cAAc,EAAE,CACnBT,CAAC,CAAC,IAAI,CAAC,CAACU,QAAQ,CAAC,MAAM,CAAC,CACxBV,CAAC,CAACW,IAAI,CAAC,SAAS,CAAE,CACjBC,GAAG,CAAEZ,CAAC,CAAC,MAAM,CAAC,CAACC,GAAG,EAAE,CACpBY,WAAW,CAAEb,CAAC,CAAC,cAAc,CAAC,CAACC,GAAG,EACnC,CAAC,CAAC,CACDa,IAAI,CAACC,cAAc,CAACC,IAAI,CAAC,IAAI,CAAC,CAChC,CAAC,CAAC,CACFhB,CAAC,CAAC,gBAAgB,CAAC,CAACI,KAAK,CAAC,iBAAMJ,EAAC,CAAC,MAAM,CAAC,CAACiB,WAAW,CAAC,OAAO,CAAC,EAChE,CAEA,QAASF,eAAc,CAACG,CAAI,CAAE,CAE7B,GADAlB,CAAC,CAAC,MAAM,CAAC,CAACiB,WAAW,CAAC,MAAM,CAAC,CACzBC,CAAI,CAACC,KAAK,CAAE,CACf,GAAIC,EAAG,CAAGF,CAAI,CAACC,KAAK,CACpBnB,CAAC,CAAC,MAAM,CAAC,CAACU,QAAQ,CAAC,OAAO,CAAC,CAC3BV,CAAC,CAAC,WAAW,CAAC,CACbqB,IAAI,CAAgB,QAAQ,EAAvB,MAAOD,EAAgB,CAC1BE,gBAAgB,CAACF,CAAG,CAAC,EAAIA,CAAG,CAC3BE,gBAAgB,CAACC,cAAc,CAACH,CAAG,CAACI,OAAO,CAAC,CAC5CF,gBAAgB,CAACF,CAAG,CAACI,OAAO,CAAC,CAACJ,CAAG,CAACK,OAAO,CAAC,WACvCL,CAAG,CAACI,OAAO,cAAKJ,CAAG,CAACK,OAAO,KAAI,CAEvC,CAAC,IACI,CACF,GAAIC,EAAO,GAAQ,CACfrB,MAAM,CAACsB,OAAO,EAAItB,MAAM,CAACuB,MAAM,CAACC,IAAI,EAAIxB,MAAM,CAACuB,MAAM,CAACE,IAAI,GAC5DzB,MAAM,CAACuB,MAAM,CAACC,IAAI,CAACC,IAAI,CAACC,KAAK,CAACb,CAAI,CAACA,IAAI,CAAC,CACxCb,MAAM,CAACuB,MAAM,CAACC,IAAI,CAACC,IAAI,CAACE,MAAM,IAAM,CACP,YAAY,EAArC3B,MAAM,CAACsB,OAAO,CAACM,MAAsB,EACvC5B,MAAM,CAACuB,MAAM,CAACC,IAAI,CAACK,IAAI,CAACC,IAAI,EAAE,CAEhCT,CAAO,GAAO,EAElB1B,CAAC,CAAC,MAAM,CAAC,CAACU,QAAQ,CAAC,SAAS,CAAC,CAC7B0B,UAAU,CAAC,UAAM,CACTV,CAAO,EACTrB,MAAM,CAACL,CAAC,CAAC,OAAO,CAAC,CAACiB,WAAW,CAAC,OAAO,CAAC,CAE3CjB,CAAC,CAAC,OAAO,CAAC,CAACC,GAAG,CAAC,EAAE,CAClB,CAAC,CAAE,IAAI,CAAC,CACRmC,UAAU,CAAC,UAAM,CAChBpC,CAAC,CAAC,MAAM,CAAC,CAACiB,WAAW,CAAC,SAAS,CAChC,CAAC,CAAE,GAAI,CACR,CACD,CAEA,GAAMK,iBAAgB,CAAG,CACxB,mBAAoB,+GAAqB,CACzC,eAAgB,2FAAqB,CACrC,uBAAwB,wIAA0B,CAClD,wBAAyB,8IAA2B,CACpD,UAAW,2FAAqB,CAChC,aAAc,mNAAyC,CACvD,QAAW,iBAAAe,CAAI,6DAAeA,CAAI,yBAAO,CACzC,YAAa,0CACd,CAAC"}