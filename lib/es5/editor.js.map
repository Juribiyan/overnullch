{"version":3,"sources":["../../babel/src/editor.js"],"names":["IS_ADMIN","max_ball_size","width","height","main","saveAsNewDraft","libchan","setMode","drafts","submit","LSfetchJSON","$","addClass","toggleClass","setTimeout","injector","inject","ajaxSetup","dataType","each","prepend","append","$tipper","parents","find","showErrors","mkErrorShower","errorDescriptors","attr","patternRX","RegExp","validate","silent","isDraft","Promise","resolve","reject","$this","val","errors","trim","maxlength","minlength","length","push","match","vconv","data","validations","hasOwnProperty","prop","finalize","setTipperState","afterValid","then","err","on","$sect","_","noop","change","gradient","update","bind","click","$use","minus","indexOf","_from","_to","_ref","id","tree","addBoard","removeBoard","$cat","hasClass","removeCategory","removeClass","addCategory","isMouseDown","radio","removeStream","focus","validateUI","load","_libdata","ev","preventDefault","stopPropagation","clearTimeout","offTimeout","currentTarget","target","$ch","parent","downloadJSON","ball","handleFile","getData","toggleView","text","removeAttribute","setAttribute","inc","override","clearInterval","incrementor","$input","offset","setInterval","validateJSON","styles","html","preamble","base","bindID","$b","jq","trigger","window","updateBindings","$area","slideDown","preValue","refreshCaptcha","toggle","addStream","Sortable","create","document","querySelector","handle","animation","toggleLib","lastTab","tabID","$lib","f","replace","toLowerCase","remove","upForm","init","getJSON","Date","getTime","done","library","build","chans","clear","clone","current","Math","random","localStorage","make","direction","stop1","stop2","prefixify","input","res","exec","rest","without","gradientDirection","ret","gradientType","isNaN","parseFloat","gradientStops","prefix","getValue","grad","alias","css","existing","getElementById","innerHTML","head","getElementsByTagName","style","createElement","type","styleSheet","cssText","appendChild","createTextNode","removeChild","originalEvent","files","dataTransfer","reader","FileReader","onload","e","setBall","result","readAsDataURL","chan","src","section","_id","ballv","$ball","one","file","fType","map","pos","abs","sign","catbg","stop","jscolor","fromString","toDataURL","getDataUri","top","left","cats","htm","JSON","parse","isFlat","name","boards","forEach","buildCat","cat","querySelectorAll","makeBoardsSortable","stringify","deconstruct","boardHeight","addBoardButtonHeight","buildBoards","empty","maxHeight","escape","buildBoard","brd","escHTML","external","dir","url","desc","recalcHeight","$brds","jQuery","n","px","$btn","board","$parent","el","group","onAdd","from","to","shake","obj","keys","r","allDirs","walkCat","catNames","dupCats","findDuplicates","$cats","i","dupDirs","$dirs","k","join","flat","$boards","$desc","$dir","$name","JSON_valid","errs","Array","$msgbox","any","mul","reduce","er","HTMLElement","fn","state","arr","dubs","role","vars","v","bgColor","linkColor","callback","userCode","parseInput","lessCode","less","render","message","colors","c","advanced_less","lessFormatter","minify","succ","errors_found","brackets","isBalanced","str","bracket","openBrackets","isClean","len","pop","reset","field","buildStream","strm","path","mime","$strm","streams","hide","proceed","$streams","stream","$range","mixedRange","dupProps","pluck","$inputs","addChan","default","buildChan","console","error","ballSrc","search","wiki","dlbtn","$chan","fresh","appendTo","highlight","libdata","editChan","assign","replaceWith","deleteChan","sect","included","userboards","userboards_catname","userboards_system","postfix","show","prettify","rinse","_schema","integrity","required","optional","adminOnly","specialComps","pairs","objects","isNewBall","conversions","toFile","defaults","fns","eq","first","second","vals","cur","nu","toBlob","schema","props","intCls","cmpCls","eqFn","convCls","conv","defCls","mode","collectData","dataPromises","pr","treeToUI","validUI","admy","all","proceedWithData","isUpload","fd","FormData","propSchema","apnd","uniq","DO_DEBUG","log","value","w","model","lsDrafts","parsed","Error","removeItem","splice","findIndex","sync","add","edit","edited","version","newid","guro","draft","css_beautify","urlencode","encodeURI","checkuniq","get","encodeURIComponent","fail","NodeList","prototype","Blob","inspect","pair","entries","fr","String","split","bstr","atob","u8arr","Uint8Array","charCodeAt","image","Image","canvas","naturalWidth","naturalHeight","getContext","drawImage","m","output","re","index","lastIndex","concat","range","$form","actorFieldMap","fields","actor","fieldActorMap","draftDelete","checkFields","action","candidate","send","request","XMLHttpRequest","open","_this","status","response","warn","unbusy","handleResponse","admin","msg","includes","messages","filter","added","moveto","makeEscapeTagLiteralFn","strings","key","dlAnchorElem"],"mappings":"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","file":"editor.js","sourcesContent":["\"use strict\";\n\nvar IS_ADMIN = false;\n\nconst max_ball_size = {width: 300, height: 300}\n\nconst main = () => {\n\tif(LSfetchJSON('IS_ADMIN')) {\n\t\tIS_ADMIN = true\n\t\t$('body').addClass('is-admin')\n\t}\n\n\t$('#chan-library').toggleClass('expanded', localStorage['chanlib-expanded'] == 1)\n\tsetTimeout(() => injector.inject('lib-collapse', `.collapsible-content {  transition: width 0.3s; }`), 100)\n\n\t$.ajaxSetup({\n\t\tdataType: 'json'\n\t})\n\n\t$('.tipper').each(function() {\n\t\t$(this).prepend(`\n\t\t\t<svg class=\"icon t-i-q\"><use xlink:href=\"#i-question\"></use></svg>\n\t\t\t<svg class=\"icon t-i-e\"><use xlink:href=\"#i-warning\"></use></svg>\n\t\t\t<svg class=\"icon t-i-s spinning\"><use xlink:href=\"#i-spinner\"></use></svg>\n\t\t\t<svg class=\"icon t-i-ok\"><use xlink:href=\"#i-check\"></use></svg>`)\n\t})\n\t.append(`<div class=\"tooltip-wrap error-msg\"><div class=\"tooltip\"></div></div>`)\n\t\n\t$('.validable')\n\t.each(function() {\n\t\tlet $tipper = $(this).parents('.tip-container').find('.tipper')\n\t\tthis.showErrors = mkErrorShower($tipper)\n\t\tthis.errorDescriptors = {\n\t\t\t'too-long': '   ',\n\t\t\t'too-short': '   ',\n\t\t\t'invalid': '  ',\n\t\t\t'missing': '   ',\n\t\t\t'occupied': ' '\n\t\t}\n\t\tif ($(this).attr('pattern'))\n\t\t\tthis.patternRX = new RegExp($(this).attr('pattern'))\n\t\tthis.validate = (silent, isDraft) => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tlet $this = $(this)\n\t\t\t\t, val = $this.val()\n\t\t\t\t, errors = []\n\n\t\t\t\tval = val.trim()\n\t\t\t\t$this.val(val)\n\n\t\t\t\tif (val) {\n\t\t\t\t\tlet maxlength = $this.attr('maxlength')\n\t\t\t\t\t, minlength = $this.attr('minlength')\n\t\t\t\t\t\n\t\t\t\t\tif (minlength && val.length < minlength)\n\t\t\t\t\t\terrors.push(`    (  ${minlength} .)`)\n\n\t\t\t\t\tif (this.patternRX && !val.match(this.patternRX)) \n\t\t\t\t\t\terrors.push('invalid')\n\n\t\t\t\t\tlet vconv = $this.data('valconvert')\n\t\t\t\t\tif (vconv && validations.hasOwnProperty(vconv)) {\n\t\t\t\t\t\tval = validations[vconv](val)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (maxlength && val.length > maxlength)\n\t\t\t\t\t\terrors.push(` .   (${maxlength} )`)\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif ($(this).prop('required')) {\n\t\t\t\t\t\terrors.push('missing')\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet finalize = () => {\n\t\t\t\t\tif (! silent)\n\t\t\t\t\t\tthis.showErrors(errors)\n\t\t\t\t\tif (! errors.length) {\n\t\t\t\t\t\t$tipper.setTipperState('valid')\n\t\t\t\t\t\tresolve(val)\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (isDraft)\n\t\t\t\t\t\t\tresolve(val)\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\treject(errors)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet afterValid = $this.data('aftervalid')\n\t\t\t\tif (! errors.length) {\n\t\t\t\t\t$tipper.setTipperState('spinner')\n\t\t\t\t\tif (afterValid && validations[afterValid]) {\n\t\t\t\t\t\tvalidations[afterValid](val, $this.data('uniq'))\n\t\t\t\t\t\t.then(() => finalize(), err => {\n\t\t\t\t\t\t\terrors.push(err)\n\t\t\t\t\t\t\tfinalize()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\telse finalize()\n\t\t\t\t}\n\t\t\t\telse finalize()\n\t\t\t})\n\t\t}\n\t})\n\t.on('focus', function() {\n\t\tlet $this = $(this)\n\t\t, $sect = $this.parents('.tip-container')\n\t\t, $tipper = $sect.find('.tipper')\n\t})\n\n\t$('.validable:not(.no-val-onblur)').on('blur', function() { \n\t\tthis.validate().then(_.noop, _.noop)\n\t})\n\t\n\t$('#color-selector .colorbox').change(gradient.update.bind(gradient))\n\n\t$('#change-direction').click(function() {\n\t\tlet $use = $(this).find('use')\n\t\t, minus = $use.attr('transform').indexOf('-90') < 0\n\t\t$use.attr('transform', `rotate(${minus ? '-' : ''}90 8 8)`)\n\t\tvar _from = $('#bgc-from')[0], _to = $('#bgc-to')[0];\n\t\tvar _ref = [_to.id, _from.id];\n\t\t_from.id = _ref[0];\n\t\t_to.id = _ref[1];\n\t\tgradient.update()\n\t})\n\n\t$('body')\n\t.on('click', '.add-board', function() {\n\t\ttree.addBoard($(this))\n\t})\n\t.on('click', '.delboard', function() {\n\t\ttree.removeBoard($(this))\n\t})\n\t.on('click', '.delcat', function() {\n\t\tlet $cat = $(this).parents('.tree-cat')\n\t\tif ($cat.hasClass('predelete') || $cat.hasClass('empty'))\n\t\t\ttree.removeCategory($(this))\n\t\telse\n\t\t\t$cat.addClass('predelete')\n\t})\n\t.on('click', '.cat-undelete', function() {\n\t\t$(this).parents('.tree-cat').removeClass('predelete')\n\t})\n\t.on('click', '.f-minus, .f-plus', function() {\n\t\t$(this).parents('.tree-cat').toggleClass('hidden')\n\t})\n\t.on('click', '.add-cat', tree.addCategory.bind(tree))\n\t.on('input', '.board-dir', function() {\n\t\t$(this).parents('.cat-brd').toggleClass('external', !! $(this).val().match(/^https?:\\/\\//))\n\t})\n\t.on('mouseup mouseleave blur touchend touchcancel', function(ev) {\n\t\tisMouseDown = false\n\t})\n\t.on('click', '.delstream', function() { radio.removeStream($(this)) })\n\t.on('click', '.templatize', function() {\n\t\t$(this).parents('.stream').toggleClass('templated').find('.stream-range').focus()\n\t})\n\t.on('blur', '#tree input', tree.validateUI.bind(tree))\n\t.on('click', '.lib-chan', function() {\n\t\tlibchan.load(this._libdata)\n\t})\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\n\t\tev.preventDefault()\n\t\tev.stopPropagation()\n\t})\n\t.on('dragenter', function(ev) {\n\t\t$(this).addClass('dropping')\n\t\tclearTimeout(this.offTimeout)\n\t})\n\t.on('dragend drop dragleave', function(ev) {\n\t\tif (ev.currentTarget === ev.target) {\n\t\t\tthis.offTimeout = setTimeout(() => {\n\t\t\t\t$(this).removeClass('dropping')\n\t\t\t}, 100)\n\t\t}\n\t})\n\t.on('click', '.export-draft', function(ev) {\n\t\tev.stopPropagation()\n\t\tlet $ch = $(this).parent('.lib-chan')\n\t\t, data = $ch[0]._libdata\n\t\tdownloadJSON(data, data.id)\n\t})\n\n\t$('.chanball-wrap')\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\n\t\tev.preventDefault()\n\t\tev.stopPropagation()\n\t})\n\t.on('dragenter dragover', function(ev) {\n\t\t$(this).addClass('file-over')\n\t\tclearTimeout(this.offTimeout)\n\t})\n\t.on('dragend drop dragleave', function(ev) {\n\t\tthis.offTimeout = setTimeout(() => {\n\t\t\t$(this).removeClass('file-over')\n\t\t}, 100)\n\t})\n\t.on('drop', ball.handleFile.bind(ball))\n\n\t$('#radio-editor').on('blur', 'input', () => {\n\t\tradio.getData().then(_.noop, _.noop)\n\t})\n\n\tvar isMouseDown = false\n\n\t$('.chanball-dropzone').click(() => $('#chanballFileInput').click())\n\t$('#chanballFileInput').on('change', ball.handleFile.bind(ball))\n\n\t$('#view-toggle .switch-body').click(() => tree.toggleView())\n\t$('#view-toggle label').click(function(ev) {\n\t\ttree.toggleView($(this).text())\n\t})\n\n\t$('#reup-chanball').click(() => {\n\t\t$('#chanballFileInput').click()\n\t})\n\n\t$('.password-reveal').on('mousedown', function() {\n\t\t$(this).parent().find('input').attr('type', 'text')\n\t})\n\t.on('mouseleave mouseup', function() {\n\t\t$(this).parent().find('input').attr('type', 'password')\n\t});\n\n\t$('#pswd').on('focus', function() {\n\t\tthis.removeAttribute('readonly')\n\t})\n\t.on('blur', function() {\n\t\tthis.setAttribute('readonly', true)\n\t})\n\n\t$('.cb-position-tweaker button')\n\t.on('mousedown touchstart', function() {\n\t\tisMouseDown = true\n\t\tlet inc = override => {\n\t\t\tif (!override && !isMouseDown)\n\t\t\t\treturn clearInterval(this.incrementor)\n\t\t\tlet $input = $(this).parent().find('input')\n\t\t\t, inc = +$(this).data('inc')\n\t\t\t$input.val(+$input.val() + inc)\n\t\t\tball.offset()\n\t\t}\n\t\tinc(true)\n\t\tthis.incrementor = setInterval(inc, 150)\n\t})\n\t.parent().find('input').on('input paste change', ball.offset)\n\n\t$('#tree-json').on('blur', function() {\n\t\ttree.validateJSON()\n\t})\n\n\t$('#chan-name').on('input paste change', function() {\n\t\t$('.channame-overlay').text($(this).val())\n\t})\n\n\t$('#color-theme input.color').change(styles.update.bind(styles))\n\t$('#less-enter').on('input', styles.update.bind(styles))\n\n\t$('#less-preamble').html(styles.preamble('html'))\n\t$('#less-enter').val(styles.base)\n\n\t$('.binded').each(function() {\n\t\tlet $this =  $(this)\n\t\t, bindID = $this.data('bind')\n\t\t, $b = $(jq`#${bindID}`)\n\t\tif (! $b.length) return;\n\t\t$b.on('input change paste', function() {\n\t\t\t$this.text($(this).val() || `{${bindID}}`)\n\t\t}).trigger('change')\n\t})\n\twindow.updateBindings = () => {\n\t\t$('.binded').each(function() {\n\t\t\t$(jq`#${$(this).data('bind')}`).trigger('change')\n\t\t})\n\t}\n\n\t$('#advance-less').change(function() {\n\t\tlet $area = $('#less-enter');\n\t\tif ($(this).prop('checked')) {\n\t\t\t$('.advanced-less').slideDown(() => {\n\t\t\t\t$area.prop('disabled', 0)\n\t\t\t\tif ($area[0].preValue)\n\t\t\t\t\t$area.val($area[0].preValue)\n\t\t\t})\n\t\t}\n\t\telse {\n\t\t\t$area[0].preValue = $area.val()\n\t\t\t$area.val(styles.base).prop('disabled', 1)\n\t\t}\n\t\tstyles.update()\n\t})\n\n\t$('.captcha').click(refreshCaptcha).addClass('not-loaded')\n\n\t$('.widget-list input').on('change', function() {\n\t\t$(jq`#${$(this).attr('name')}`).toggle($(this).prop('checked'))\n\t})\n\n\t$('.expander').click(function() {\n\t\t$(this).parents('.expandee').toggleClass('expanded')\n\t})\n\n\t$('#onchan').on('change', function() {\n\t\t$('.chan').toggleClass('onchan', $(this).prop('checked'))\n\t})\n\n\tstyles.update()\n\n\t$('#add-stream').click(radio.addStream.bind(radio))\n\n\tSortable.create(document.querySelector('#categories'), {\n\t\thandle: '.cat-dragger',\n\t\tanimation: 150\n\t})\n\n\tSortable.create(document.querySelector('#streams'), {\n\t\thandle: '.dragger',\n\t\tanimation: 150\n\t})\n\n\t$('.sidebar').click(toggleLib)\n\n\tlet lastTab = 'default'\n\t$('.tab').click(function() {\n\t\tlet tabID = $(this).data('tab')\n\t\t, $lib = $('#chan-library')\n\t\t, f = false\n\t\tif (tabID === 'search') {\n\t\t\tif ($lib.hasClass('show-search'))\n\t\t\t\ttabID = lastTab\n\t\t\telse\n\t\t\t\tf = true\n\t\t}\n\t\telse lastTab = tabID\n\t\t$lib.find('.tab').removeClass('selected')\n\t\t$lib.find(`.tab[data-tab=${tabID}]`).addClass('selected')\n\t\t$lib.removeClass('show-custom show-default show-drafts show-search').addClass(`show-${tabID}`)\n\t\tf && $('#searchbox').focus()\n\t})\n\n\t$('#searchbox').on('input paste', function() {\n\t\tlet val = $(this).val().trim().replace(/\\\"/g, '\\\\\"').toLowerCase()\n\t\tif (val.length)\n\t\t\tinjector.inject('lib-search', `.show-search .lib-chan[data-search *= \"${val}\"] {height: 40px}`)\n\t\telse\n\t\t\tinjector.remove('lib-search')\n\t})\n\n\tupForm.init()\n\n\t$.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\n\t.done(data => library.build(data.chans)) \n\n\t$('#new-chan').click(() => libchan.clear())\n\t$('#clone-this').click(() => libchan.clone())\n\t$('#publish').click(() => upForm.toggle('upload'))\n\t$('#delete-this').click(() => upForm.toggle('delete'))\n\t$('#save-draft').click(() => drafts.submit())\n\n\tfunction saveAsNewDraft() {\n\t\tlibchan.setMode('new', 'drafts')\n\t\tdrafts.submit(1)\n\t\treturn false\n\t}\n\t$('#draft-saveasnew').click(saveAsNewDraft)\n\t$('#draft-changeid').click(() => {\n\t\tdrafts.remove(libchan.current.id)\n\t\tsaveAsNewDraft()\n\t})\n\t$('#draft-savemodifiedid').click(() => {\n\t\t$('#chan-id').val($('#proposed-id').text())\n\t\tdrafts.submit()\n\t\treturn false\n\t})\n\t$('#draft-overwrite').click(() => {\n\t\tdrafts.remove($('#id-to-overwrite').text())\n\t\tdrafts.submit()\n\t\treturn false\n\t})\n\n\tdrafts.load()\n}\n\nfunction refreshCaptcha() {\n\t$('.captcha').attr('src', `/captcha.php?color=255,255,255&v=${Math.random()}`).removeClass('not-loaded')\n\t$('#captcha').val('')\n}\n\nfunction toggleLib(on) {\n\t$('#chan-library').toggleClass('expanded', on)\n\tlocalStorage['chanlib-expanded'] = +$('#chan-library').hasClass('expanded')\n}\n\nvar gradient = {\n\tmake: (direction, stop1, stop2) =>\n\t\t(direction !== 'radial') \n\t\t\t? `linear-gradient(to ${direction}, ${stop1} 0%, ${stop2} 100%)`\n\t\t\t: `radial-gradient(ellipse at center, ${stop1} 0%, ${stop2} 100%)`,\n\tprefixify: function(input) {\n\t\tvar res = /(((?:radial|linear)-gradient)\\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\\));?/i.exec(input);\n\t\tif (res === null) return 'background:' + input;\n\t\tres = _.rest(_.without(res, undefined));\n\t\tvar ret = res[0]+'; ';\n\t\tvar gradientType = res[1];\n\t\tvar gradientDirection;\n\t\tif (!isNaN(res[2])) gradientDirection = (90 - parseFloat(res[2])) + 'deg, ';\n\t\telse if (res[2] == 'bottom') gradientDirection = 'top, ';\n\t\telse if (res[2] == 'right') gradientDirection = 'left, ';\n\t\telse gradientDirection = 'center, ellipse cover, ';\n\t\tvar gradientStops = res[3];\n\t\t_.each(['-o-', '-webkit-', '-moz-'], function(prefix) {\n\t\t\tret += 'background:' + prefix + gradientType + '(' + gradientDirection + gradientStops + '); ';\n\t\t});\n\t\treturn 'background:' + ret;\n\t},\n\tgetValue: function() {\n\t\tlet stop1 = '#' + $('#bgc-from').val()\n\t\t, stop2 = '#' + $('#bgc-to').val()\n\t\treturn this.make('bottom', stop1, stop2)\n\t},\n\tupdate: function() {\n\t\tlet grad = this.getValue()\n\t\tinjector.inject('chanball-background', `.chanball-wrap { ${this.prefixify(grad)} }`)\n\t}\n}\n\nvar injector = {\n\tinject: function(alias, css) {\n\t\tvar id = `injector:${alias}`\n\t\tvar existing = document.getElementById(id)\n\t\tif (existing) {\n\t\t\texisting.innerHTML = css\n\t\t\treturn\n\t\t}\n\t\tvar head = document.head || document.getElementsByTagName('head')[0]\n\t\t, style = document.createElement('style');\n\t\tstyle.type = 'text/css'\n\t\tstyle.id = id\n\t\tif (style.styleSheet) {\n\t\t\tstyle.styleSheet.cssText = css\n\t\t} else {\n\t\t\tstyle.appendChild(document.createTextNode(css))\n\t\t}\n\t\thead.appendChild(style)\n\t},\n\tremove: function(alias) {\n\t\tvar id = `injector:${alias}`\n\t\tvar style = document.getElementById(id)\n\t\tif (style) {\n\t\t\tvar head = document.head || document.getElementsByTagName('head')[0]\n\t\t\tif (head)\n\t\t\t\thead.removeChild(document.getElementById(id))\n\t\t}\n\t}\n}\n\nvar ball = {\n\thandleFile: function(ev) {\n\t\tev.stopPropagation()\n\t\tev.preventDefault()\n\t\tev = ev.originalEvent\n\n\t\t$('body').removeClass('dropping')\n\n\t\tlet files = (ev.type == \"drop\") ? ev.dataTransfer.files : ev.target.files\n\t\t, f = files[0]\n\n\t\tif (f && f.type == 'image/png') {\n\t\t\tvar reader = new FileReader()\n\t\t\t\n\t\t\treader.onload = (function(theFile) {\n\t\t\t\treturn (function(e) {\n\t\t\t\t\tthis.setBall(e.target.result)\n\t\t\t\t}).bind(this)\n\t\t\t}).bind(this)(f)\n\n\t\t\treader.readAsDataURL(f)\n\t\t}\n\t\telse if(f)\n\t\t\tthis.showErrors('image-not-png')\n\t},\n\tsetBall: function(chan) {\n\t\tlet src\n\t\tif (typeof chan === 'string') {\n\t\t\tsrc = chan\n\t\t}\n\t\telse {\n\t\t\tif (! chan.ball) {\n\t\t\t\tif(chan.section !== 'drafts') {\n\t\t\t\t\tsrc = `/chans/balls/${chan.section}/${chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.clear()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsrc = chan.ball\n\t\t\t}\n\t\t}\n\n\t\tlet $ball = $('#chanball').attr('src', src)\n\t\t$ball.one('load', () => {\n\t\t\tif ($ball.width() > max_ball_size.width || $ball.height > max_ball_size.height) \n\t\t\t\tthis.showErrors('image-too-large')\n\t\t\telse {\n\t\t\t\tthis.file = src\n\t\t\t\tthis.fType = src.indexOf('data:') === 0 ? 'dataURL' : 'file'\n\t\t\t\tthis.showErrors([])\n\t\t\t\t$('#chanball-sect').addClass('chanball-present')\n\t\t\t}\n\t\t})\n\n\t\tgradient.update()\n\t},\n\tclear: function() {\n\t\t$('#chanball-sect').removeClass('chanball-present')\n\t\tthis.file = null\n\t},\n\tgetData: function(isDraft) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet errors = []\n\t\t\tif (!this.file)\n\t\t\t\terrors.push('no-file')\n\t\t\t\n\t\t\tlet offset = ['left', 'top'].map(pos => {\n\t\t\t\tlet $input = $(jq`#position-tweak-${pos}`)\n\t\t\t\t, val = +$input.val()\n\t\t\t\tif (isNaN(val))\n\t\t\t\t\tval = 0\n\t\t\t\tif (Math.abs(val) > 100)\n\t\t\t\t\tval = 100 * Math.sign(val)\n\t\t\t\t$input.val(val)\n\t\t\t\treturn val\n\t\t\t})\n\n\t\t\t, catbg = ['from', 'to'].map(stop => {\n\t\t\t\tlet $input = $(jq`#bgc-${stop}`)\n\t\t\t\t, val = $input.val()\n\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\n\t\t\t\t\tval = 'ffffff'\n\t\t\t\t\t$input[0].jscolor.fromString(val)\n\t\t\t\t}\n\t\t\t\treturn val\n\t\t\t})\n\n\t\t\tthis.offset()\n\t\t\tgradient.update()\n\n\t\t\tthis.showErrors(errors)\n\n\t\t\tif (errors.length && !isDraft) \n\t\t\t\treject(errors)\n\t\t\telse resolve({\n\t\t\t\tball: this.fType === 'file' ? 'default' : this.file,\n\t\t\t\toffset: offset,\n\t\t\t\tcatbg: catbg\n\t\t\t})\n\t\t})\n\t\t\n\t},\n\ttoDataURL: function() {\n\t\tif (this.fType == 'data' || !this.file)\n\t\t\treturn\n\t\tgetDataUri(this.file, data => {\n\t\t\tthis.file = data,\n\t\t\tthis.fType = 'data'\n\t\t})\n\t},\n\terrorDescriptors: {\n\t\t'no-file': ' ',\n\t\t'image-not-png': '   (  PNG)',\n\t\t'image-too-large': '     200 ',\n\t\t'upload-error': '   '\n\t},\n\tfile: null, fType: null,\n\toffset: function() {\n\t\tlet top = +$('#position-tweak-top').val(),\n\t\tleft = +$('#position-tweak-left').val()\n\t\t$('#chanball').css({\n\t\t\t'transform': `translate(${left}px, ${top}px)`,\n\t\t\t'-webkit-transform': `translate(${left}px, ${top}px)`,\n\t\t\t'-ms-transform': `translate(${left}px, ${top}px)`,\n\t\t\t'-moz-transform': `translate(${left}px, ${top}px)`,\n\t\t\t'-o-transform': `translate(${left}px, ${top}px)`\n\t\t})\n\t\treturn [top, left]\n\t},\n\tshowErrors: mkErrorShower('ball')\n}\n\nvar tree = {\n\tbuild: function(cats) {\n\t\tvar htm= ''\n\t\tif (cats) {\n\t\t\tif(typeof cats === 'string') {\n\t\t\t\ttry {\n\t\t\t\t\tcats = JSON.parse(cats)\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tthis.toggleView('JSON', true)\n\t\t\t\t\t$('#tree-json').val(cats)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (cats.length && this.isFlat(cats)) \n\t\t\t\tcats = [{name: '', boards: cats}]\n\t\t\tcats.forEach(cat => {\n\t\t\t\thtm += this.buildCat(cat)\n\t\t\t})\n\t\t}\n\t\t$('#categories').html(htm)\n\t\t\n\t\tdocument.querySelectorAll('.tree-cat ul').forEach(this.makeBoardsSortable.bind(this));\n\n\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\n\n\t\treturn this.validateUI()\n\t},\n\tisFlat: cats => cats[0].hasOwnProperty('dir'),\n\tboardHeight: 24,\n\taddBoardButtonHeight: 27,\n\tbuildCat: function(cat) {\n\t\tcat.boards = cat.boards || []\n\t\tvar boards = this.buildBoards(cat.boards)\n\t\t, empty = (cat.boards.length === 0)\n\t\t, maxHeight = (cat.boards.length+1) * this.boardHeight + this.addBoardButtonHeight\n\t\treturn `<div class=\"tree-cat ${empty ? 'empty': ''}\">\n\t\t<div class=\"tree-cathead\">\n\t\t\t<svg class=\"icon f-plus\" title=\"\"><use xlink:href=\"#i-folder-plus-fill\"></use></svg>\n\t\t\t<svg class=\"icon f-minus\" title=\"\"><use xlink:href=\"#i-folder-minus-fill\"></use></svg>\n\t\t\t<svg class=\"icon f-empty\"><use xlink:href=\"#i-folder-empty\"></use></svg>\n\t\t\t<input type=\"text\" class=\"cat-title\" value=\"${_.escape(cat.name) || ''}\"></input>\n\t\t\t<button class=\"b-option cat-undelete\" title=\" \">\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-undo\"></use></svg>\n\t\t\t</button>\n\t\t\t<div class=\"cat-dragger\" title=\" \">\n\t\t\t\t<svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg>\n\t\t\t</div>\n\t\t\t<button class=\"b-option delb delcat\" title=\" \">\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"tree-catboards\" style=\"max-height: ${maxHeight}px\">${boards}</div></div>`\n\t},\n\tbuildBoards: function(boards) {\n\t\tvar htm ='<ul>'\n\t\tboards.forEach(brd => {\n\t\t\thtm += this.buildBoard(brd)\n\t\t})\n\t\thtm += `</ul><button class=\"tree-add add-board\" title=\" \">\n\t\t\t<div class=\"inner-border\">\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-slash-plus-slash\"></use></svg>\n\t\t\t</div>\n\t\t</button>`\n\t\treturn htm\n\t},\n\tbuildBoard: brd => escHTML\n\t`<li class=\"cat-brd ${brd.external ? 'external' : ''}\">\n\t\t<input type=\"text\" class=\"board-dir\" value=\"${brd.dir || brd.url || ''}\">\n\t\t<input type=\"text\" class=\"board-desc\" value=\"${brd.desc || ''}\">\n\t\t<div class=\"dragger\" title=\" \"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\n\t\t<button class=\"b-option delb delboard\" title=\" \"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button>\n\t</li>`,\n\trecalcHeight: function($brds) {\n\t\tif (!($brds instanceof jQuery)) \n\t\t\t$brds = $($brds).parent()\n\t\tlet n = $brds.find('.cat-brd').length\n\t\t, px = (n+1) * this.boardHeight + this.addBoardButtonHeight\n\t\t$brds.css({'max-height': `${px}px`})\n\t\t$brds.parent().toggleClass('empty', n == 0)\n\t},\n\taddBoard: function($btn, board) {\n\t\tboard = board || {}\n\t\t$btn.parent().find('ul').append(this.buildBoard)\n\t\tthis.recalcHeight($btn.parent())\n\t\t$btn.parent().find('.cat-brd:last input:first').focus()\n\t},\n\tremoveBoard: function($btn) {\n\t\tlet $parent = $btn.parents('.tree-catboards')\n\t\t$btn.parents('.cat-brd').remove()\n\t\tthis.recalcHeight($parent)\n\t\tthis.validateUI()\n\t},\n\taddCategory: function(cat) {\n\t\tif (!cat.hasOwnProperty('boards'))\n\t\t\tcat = {name: '', boards: []}\n\t\tlet $cat = $(this.buildCat(cat))\n\t\tthis.makeBoardsSortable($cat.find('ul')[0])\n\t\t$('#categories').append($cat)\n\t\t$cat.find('.cat-title').focus()\n\t},\n\tremoveCategory: function($btn) {\n\t\t$btn.parents('.tree-cat').remove()\n\t\tthis.validateUI()\n\t},\n\tmakeBoardsSortable: function(el) {\n\t\tSortable.create(el, {\n\t\t\thandle: '.dragger',\n\t\t\tanimation: 150, \n\t\t\tgroup: 'boards',\n\t\t\tonAdd: ev => {\n\t\t\t\t[ev.from, ev.to].forEach(this.recalcHeight.bind(this))\n\t\t\t\tthis.validateUI()\n\t\t\t}\n\t\t})\n\t},\n\tvalidateJSON: function() {\n\t\ttry {\n\t\t\tlet cats = JSON.parse($('#tree-json').val())\n\t\t\tthis.build(cats)\n\t\t\treturn 1\n\t\t}\n\t\tcatch (e) {\n\t\t\tthis.showErrors(e)\n\t\t\t$('#view-toggle').shake()\n\t\t\treturn 0\n\t\t}\n\t},\n\tvalidateUI: function(isDraft) {\n\t\tlet errors = []\n\t\t, obj = this.deconstruct()\n\n\t\tif ($('#tree .invalid').length)\n\t\t\t_.keys(this.errorDescriptors).forEach(r => {\n\t\t\t\tif ($(jq`#tree .invalid.inv_${r}`).length) \n\t\t\t\t\terrors.push(r)\n\t\t\t})\n\n\t\tlet allDirs = []\n\t\t, walkCat = brd => allDirs.push(brd.external ? brd.url : brd.dir)\n\n\t\tlet catNames = []\n\t\tobj.forEach(cat => {\n\t\t\tcatNames.push(cat.name)\n\t\t\tcat.boards.forEach(walkCat)\n\t\t})\n\t\tlet dupCats = findDuplicates(catNames)\n\t\tif (dupCats.length) {\n\t\t\terrors.push('mul-cat')\n\t\t\tlet $cats = $('.cat-title')\n\t\t\tdupCats.forEach(i => $($cats[i]).addClass('invalid'))\n\t\t}\n\n\t\tlet dupDirs = findDuplicates(allDirs)\n\t\tif (dupDirs.length) {\n\t\t\terrors.push('mul-dir')\n\t\t\tlet $dirs = $('.board-dir')\n\t\t\tdupDirs.forEach(i => $($dirs[i]).addClass('invalid'))\n\t\t}\n\n\t\tthis.showErrors(errors)\n\t\treturn (errors.length && !isDraft) ? false : obj\n\t},\n\tdeconstruct: function() {\n\t\t$('#tree .invalid').removeClass('invalid ' + \n\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\n\t\tlet cats = []\n\t\t, $cats = $('.tree-cat')\n\t\t, flat = false\n\t\tif ($cats.length == 1)\n\t\t\tflat = true\n\t\t$('.tree-cat').each(function() {\n\t\t\tvar $cat = $(this)\n\t\t\t, boards = []\n\t\t\t, $boards = $cat.find('.cat-brd')\n\t\t\tif (! $boards.length)\n\t\t\t\t$cat.addClass('invalid inv_empty-dir')\n\t\t\telse $boards.each(function() {\n\t\t\t\tlet $desc = $(this).find('.board-desc')\n\t\t\t\t, desc = $desc.val().trim()\n\t\t\t\tif (!desc) \n\t\t\t\t\t$desc.addClass('invalid inv_no-desc')\n\t\t\t\tlet board = {desc: desc}\n\n\t\t\t\tlet $dir = $(this).find('.board-dir')\n\t\t\t\t, dir = $dir.val().trim()\n\t\t\t\tif (!dir)\n\t\t\t\t\t$dir.addClass('invalid inv_no-dir')\n\n\t\t\t\tlet external = !! dir.match(/^https?:\\/\\//)\n\t\t\t\t$(this).toggleClass('external', external)\n\t\t\t\tboard[external ? 'url' : 'dir'] = dir\n\t\t\t\tif (external) \n\t\t\t\t\tboard.external = true\n\n\t\t\t\tboards.push(board)\n\t\t\t})\n\n\t\t\tlet $name = $cat.find('.cat-title')\n\t\t\t, name = $name.val().trim()\n\t\t\tif (!flat && ! name) {\n\t\t\t\t$name.addClass('invalid inv_no-name')\n\t\t\t}\n\t\t\tcats.push({\n\t\t\t\tname: name,\n\t\t\t\tboards: boards\n\t\t\t})\n\t\t})\n\t\treturn cats\n\t},\n\ttoggleView: function(to, isDraft) {\n\t\tlet current = $('#chan-structure').hasClass('sw_UI') ? 'UI' : 'JSON'\n\n\t\tif (typeof to === 'undefined') \n\t\t\tto = current=='UI' ? 'JSON' : 'UI'\n\n\t\tif (current == to)\n\t\t\treturn null\n\n\t\tif (to === 'JSON') {\n\t\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\n\t\t}\n\n\t\telse {\n\t\t\tlet JSON_valid = this.validateJSON()\n\t\t\tif (isDraft)\n\t\t\t\treturn $('#tree-json').val()/*.replace(/\\t|\\n/g, '')*/\n\t\t\telse if (! JSON_valid) \n\t\t\t\treturn false\n\t\t}\n\n\t\t$('#chan-structure')\n\t\t.removeClass('sw_UI sw_JSON')\n\t\t.addClass(`sw_${to}`)\n\n\t\treturn 1\n\t},\n\terrorDescriptors: {\n\t\t'no-name': '  ',\n\t\t'no-dir': '  ',\n\t\t'no-desc': '  ',\n\t\t'mul-dir': '  ',\n\t\t'mul-cat': '  ',\n\t\t'empty-dir': ' ',\n\t\t'bad-json': 'JSON  '\n\t},\n\tshowErrors: mkErrorShower('struct')\n}\n\nfunction mkErrorShower(id) {\n\treturn function(errs) {\n\t\tif (! (errs instanceof Array))\n\t\t\terrs = [errs]\n\t\tlet $tipper = id instanceof jQuery ? id : $(jq`#${id}-tipper`)\n\t\t, $msgbox = $tipper.find('.error-msg .tooltip')\n\t\t, any = errs.length > 0\n\t\t, mul = errs.length > 1\n\t\tlet htm = (mul ? ` : <ul>` : '')\n\t\t+ errs.reduce((htm, er) => htm + escHTML`${mul ? '<li>' : ''}${this.errorDescriptors && this.errorDescriptors[er] || er}${mul ? '</li>' : ''}`, '')\n\t\t+ (mul ? '</ul>' : '')\n\t\t$msgbox.html(htm)\n\t\t$tipper.setTipperState(any ? 'error-tip' : 'question')\n\t\tif (any) \n\t\t\t$tipper.shake()\n\t\tif(this instanceof HTMLElement) {\n\t\t\t$(this).toggleClass('invalid', any)\n\t\t}\n\t}\n}\n\n$.fn.shake = function() {\n\tthis.addClass('shake')\n\tsetTimeout(() => this.removeClass('shake'), 900)\n}\n$.fn.setTipperState = function(state) {\n\tthis.removeClass(_.without(['question', 'error-tip', 'spinner', 'valid'], state).join(' '))\n\t.addClass(state)\n}\n\n/*function hasDuplicates(a) {\n\treturn _.uniq(a).length !== a.length; \n}*/\n\nfunction findDuplicates(arr) {\n\tlet dubs = []\n\tarr.forEach((el, i) => {\n\t\tif (arr.length - _.without(arr, el).length > 1)\n\t\t\tdubs.push(i)\n\t})\n\treturn dubs\n}\n\nvar styles = {\n\tpreamble: function(role) {\n\t\tlet vars = []\n\t\t;['chan-id', 'bgColor', 'linkColor'].forEach(v =>\n\t\t\tvars[v] = (role == 'html')\n\t\t\t\t? `<span class=\"binded\" data-bind=\"${v}\"></span>`\n\t\t\t\t: $(jq`#${v}`).val()\n\t\t)\n\t\tif (role == 'less')\n\t\t\tvars['chan-id'] = 'css-preview'\n\t\treturn `.chan-${vars['chan-id']} {`+\n\t\t\t`\\n  @bgcolor: #${vars.bgColor};`+\n\t\t\t`\\n  @linkcolor: #${vars.linkColor};`;\n\t},\n\tupdate: function(callback) {\n\t\tcallback = (typeof callback === 'function') ? callback : null\n\t\tlet userCode = this.parseInput()\n\t\tif (!userCode) {\n\t\t\tif (callback)\n\t\t\t\tcallback(false)\n\t\t\treturn\n\t\t}\n\t\tlet lessCode = this.preamble('less') + userCode + '}';\n\t\tless.render(lessCode).then(r => {\n\t\t\tinjector.inject('chanclass-preview', r.css)\n\t\t\tif (callback)\n\t\t\t\tcallback(true)\n\t\t},\n\t\terr => {\n\t\t\tthis.showErrors(err.message)\n\t\t\tif (callback)\n\t\t\t\tcallback(false)\n\t\t})\n\t},\n\tgetData: function(isDraft) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet res = {\n\t\t\t\tcolors: ['bg', 'link'].map(c => {\n\t\t\t\t\tlet $input = $(jq`#${c}Color`)\n\t\t\t\t\t, val = $input.val()\n\t\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\n\t\t\t\t\t\tval = $input.attr('value')\n\t\t\t\t\t\t$input[0].jscolor.fromString(val)\n\t\t\t\t\t}\n\t\t\t\t\treturn val\n\t\t\t\t})\n\t\t\t}\n\t\t\tif ($('#advance-less').prop('checked')) {\n\t\t\t\tres.advanced_less = lessFormatter.minify($('#less-enter').val())\n\t\t\t\tthis.update(succ => {\n\t\t\t\t\tif (isDraft || succ) \n\t\t\t\t\t\tresolve(res) \n\t\t\t\t\telse \n\t\t\t\t\t\treject()\n\t\t\t\t})\n\t\t\t}\n\t\t\telse resolve(res)\n\t\t})\n\t},\n\terrorDescriptors: {\n\t\t'bracket-imbalance': '  ',\n\t\t// 'parent-selector': '   (&)  (    )'\n\t},\n\tparseInput: function() {\n\t\tlet errors_found = []\n\t\t, val = $('#less-enter').val()\n\t\t// check for bracket balance | http://codereview.stackexchange.com/a/15339\n\t\tlet brackets = val.replace(/\\/\\*.+?\\*\\/|\".+?\"|'.+?'/, '').replace(/[^()\\[\\]{}]/g, '')\n\t\t, isBalanced = (function(str) {\n\t\t\tvar bracket = {\n\t\t\t\t\"]\": \"[\",\n\t\t\t\t\"}\": \"{\",\n\t\t\t\t\")\": \"(\"\n\t\t\t},\n\t\t\topenBrackets = [], \n\t\t\tisClean = true,\n\t\t\ti = 0,\n\t\t\tlen = str.length;\n\n\t\t\tfor(; isClean && i<len; i++ ){\n\t\t\t\tif ( bracket[ str[ i ] ] ){\n\t\t\t\t\tisClean = ( openBrackets.pop() === bracket[ str[ i ] ] );\n\t\t\t\t}else{\n\t\t\t\t\topenBrackets.push( str[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn isClean && !openBrackets.length;\n\t\t})(brackets)\n\t\t\n\t\tif (!isBalanced)\n\t\t\terrors_found.push('bracket-imbalance')\n\n\t\t// check for parent selectors\n\t\t/*if (val.match(/&(?![:\\.])/))\n\t\t\terrors_found.push('parent-selector')*/\n\n\t\tthis.showErrors(errors_found)\n\n\t\treturn errors_found.length ? false : val\n\t},\n\tshowErrors: mkErrorShower('style'),\n\treset: function() {\n\t\t;['bg', 'link'].forEach(field => {\n\t\t\tlet $input = $(jq`#${field}Color`)\n\t\t\t$input[0].jscolor.fromString($input.data('default'))\n\t\t})\n\t\t$('#advance-less').prop('checked', 0).trigger('change')\n\t\tthis.update()\n\t\t$('#custom-css').prop('checked', 0).trigger('change')\n\t}\n}\n\nstyles.base = `background: @bgcolor;\na, .chan-overlay .icon {\n\tcolor: @linkcolor;\n}\n&:hover {\n\tbackground: darken(@bgcolor, 8%);\n}\n&.onchan {\n\tbox-shadow: inset -2px 0 fadeout(@linkcolor, 25%);\n}\n& when (lightness(@bgcolor) < 70%) {\n\tcolor: #C3C3C3;\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\n\t\tcolor: white;\n\t}\n\t.board:hover {\n\t\tbackground: rgba(255, 255, 255, .08);\n\t}\n}\n& when (lightness(@bgcolor) > 70%) {\n\tcolor: #404040;\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\n\t\tcolor: black;\n\t}\n\t.board:hover {\n\t\tbackground: rgba(0, 0, 0, .08);\n\t}\n}\n`;\n\n\nvar radio = {\n\tbuildStream: strm => escHTML\n\t`<li class=\"stream${strm.n ? ' templated' : ''}\">\n\t\t<input type=\"text\" class=\"stream-name\" placeholder=\" \" title=\" \" maxlength=\"20\" value=\"${strm.name || ''}\">\n\t\t<input type=\"text\" class=\"stream-range\" placeholder=\"\" title=\"\" maxlength=\"20\" value=\"${strm.n || ''}\">\n\t\t<div class=\"stream-options\">\n\t\t\t<button class=\"b-option templatize\" title=\"  \"><svg class=\"icon\">\n\t\t\t\t<use class=\"for-templated-hide\" xlink:href=\"#i-template\"></use>\n\t\t\t\t<use class=\"for-templated-show\" xlink:href=\"#i-untemplate\"></use>\n\t\t\t</svg></button>\n\t\t\t<div class=\"dragger\" title=\" \"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\n\t\t\t<button class=\"b-option delstream\" title=\" \"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button><br>\n\t\t</div>\n\t\t<br>\n\t\t<input type=\"text\" class=\"stream-path\" placeholder=\"/path \" title=\"/path \" maxlength=\"50\" value=\"${strm.path || ''}\">\n\t\t<input type=\"text\" class=\"stream-mime\" placeholder=\"MIME \" title=\"MIME \" maxlength=\"20\" value=\"${strm.mime || ''}\">\n\t</li>`,\n\taddStream: function(strm) {\n\t\tstrm = strm || {}\n\t\tlet $strm = $(this.buildStream(strm))\n\t\t$('#streams').append($strm)\n\t},\n\tbuild: function(r) {\n\t\t$('#chan-radiourl').val(r.url)\n\t\t$('#streams').html(r.streams.reduce((htm, strm) => htm + this.buildStream(strm), ''))\n\t},\n\tremoveStream: $btn => $btn.parents('.stream').remove(),\n\treset: function() {\n\t\tthis.build({url: '', streams: []})\n\t\t$('#radio-editor').hide()\n\t\t$('#radio').prop('checked', false)\n\t},\n\tgetData: function(isDraft) { //aka validate\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet proceed = (url, errors) => {\n\t\t\t\terrors = errors ? errors.map(v => `URL: ${v}`) : []\n\t\t\t\t$('#chan-radiourl').toggleClass('invalid', !!errors.length)\n\n\t\t\t\t$('#streams input').removeClass('invalid ' + \n\t\t\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\n\t\t\t\tlet streams = []\n\t\t\t\t, $streams = $('.stream')\n\t\t\t\tif (! $streams.length)\n\t\t\t\t\terrors.push('no-streams')\n\t\t\t\telse {\n\t\t\t\t\t$streams.each(function() {\n\t\t\t\t\t\tlet $strm = $(this)\n\t\t\t\t\t\t, stream = {}\n\t\t\t\t\t\t;['name', 'path', 'mime'].forEach(prop => {\n\t\t\t\t\t\t\tlet $input = $strm.find(`.stream-${prop}`)\n\t\t\t\t\t\t\t, val = $input.val()\n\t\t\t\t\t\t\tif(!val)\n\t\t\t\t\t\t\t\t$input.addClass(`invalid inv_no-${prop}`)\n\t\t\t\t\t\t\tstream[prop] = val\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tstreams.push(stream)\n\n\t\t\t\t\t\tif ($strm.hasClass('templated')) {\n\t\t\t\t\t\t\tlet $range = $strm.find(`.stream-range`)\n\t\t\t\t\t\t\t, n = $range.val()\n\t\t\t\t\t\t\tif (! n)\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_no-range')\n\t\t\t\t\t\t\telse if(! mixedRange(n).length)\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_bad-range')\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tstream.n = n\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\tif ($('#streams .invalid').length)\n\t\t\t\t\t\t_.keys(this.errorDescriptors).forEach(r => {\n\t\t\t\t\t\t\tif ($(jq`#streams .invalid.inv_${r}`).length) \n\t\t\t\t\t\t\t\terrors.push(r)\n\t\t\t\t\t\t})\n\n\t\t\t\t\t;['name', 'path'].forEach(prop => {\n\t\t\t\t\t\tlet dupProps = findDuplicates(_.pluck(streams, prop))\n\t\t\t\t\t\tif (dupProps.length) {\n\t\t\t\t\t\t\terrors.push(`mul-${prop}`)\n\t\t\t\t\t\t\tlet $inputs = $(jq`.stream-${prop}`)\n\t\t\t\t\t\t\tdupProps.forEach(i => $($inputs[i]).addClass('invalid'))\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tthis.showErrors(errors)\n\n\t\t\t\tif (!isDraft && errors.length)\n\t\t\t\t\treject(errors)\n\t\t\t\telse\n\t\t\t\t\tresolve({\n\t\t\t\t\t\turl: url,\n\t\t\t\t\t\tstreams: streams\n\t\t\t\t\t})\n\t\t\t}\n\t\t\t$('#chan-radiourl')[0].validate(true).then(val => {\n\t\t\t\tproceed(val, null)\n\t\t\t},\n\t\t\terrors => {\n\t\t\t\tproceed(null, errors)\n\t\t\t})\n\t\t})\n\t},\n\tshowErrors: mkErrorShower('radio'),\n\terrorDescriptors: {\n\t\t'no-streams': '    ',\n\t\t'no-name': '  ',\n\t\t'no-path': '   ',\n\t\t'no-mime': ' MIME',\n\t\t'mul-name': '  ',\n\t\t'mul-path': '   ',\n\t\t'no-range': '   ',\n\t\t'bad-range': '   '\n\t}\n}\n\nvar library = {\n\tbuild: function(chans, section) {\n\t\tchans.forEach(chan => this.addChan(chan, section || (chan.default ? 'default' : 'custom')))\n\t},\n\tbuildChan: function(chan, section) {\n\t\tsection = section || chan.section\n\t\tif (! section)\n\t\t\treturn console.error('No section specified for buildChan()')\n\t\tlet ballSrc = chan.ball || `/chans/balls/${section}/${section == 'drafts' ? 'no-ball' : chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\n\t\t, search = `${chan.id} ${chan.name} ${chan.url.replace(/^https?:\\/\\//, '')} ${(chan.wiki || '').replace(/^https?:\\/\\//, '')}`\n\t\t.toLowerCase().trim().replace(/[<>\"\"]/g, '')\n\t\t, dlbtn = section === 'drafts' ? `\n\t\t<button class=\"btn export-draft\">\n\t\t\t<svg class=\"icon\" title=\" \"><use xlink:href=\"#i-download\"></use></svg>\n\t\t</button>` : ''\n\t\t, htm = escHTML`<li class=\"lib-chan sect-${section}${!chan.name ? ' no-name' : ''}\" id=\"chan_${chan.id}\" data-search=\"${search}\">\n\t\t\t<img src=\"${ballSrc}\" class=\"lib-chanball\">\n\t\t\t<div class=\"chan-title\">${chan.name || ' '}</div>`+dlbtn+`\n\t\t</li>`\n\t\t, $chan = $(htm)\n\t\tchan.section = section\n\t\t$chan[0]._libdata = chan\n\t\treturn $chan\n\t},\n\taddChan: function(chan, section, fresh) {\n\t\tif (typeof fresh === 'undefined') fresh = false\n\t\tsection = section || chan.section\n\t\tif (! section)\n\t\t\treturn console.error('No section specified for addChan()')\n\t\tlet $chan = this.buildChan(chan, section)\n\t\t$chan.appendTo('#chans')\n\t\tfresh && this.highlight($chan)\n\t\tlet libdata = $chan[0]._libdata\n\t\treturn libdata\n\t},\n\teditChan: function(chan) {\n\t\tlet $chan = $(jq`#chan_${chan.id}`)\n\t\t, libdata = $chan[0]._libdata\n\t\t_.assign(libdata, chan)\n\t\t$chan.replaceWith(this.buildChan(libdata, libdata.section))\n\t\tthis.highlight($(jq`#chan_${chan.id}`))\n\t\treturn libdata\n\t},\n\tdeleteChan: function(id) {\n\t\t$(jq`#chan_${id}`).remove()\n\t},\n\thighlight: function($chan) {\n\t\tlet sect = $chan[0]._libdata.section\n\t\t$(jq`.tab[data-tab=${sect}]`).click()\n\t\t$chan.addClass('fresh')\n\t\ttoggleLib(true)\n\t}\n}\n\nvar libchan = {\n\tload: function(chan) {\n\t\tupForm.toggle()\n\n\t\tthis.current = chan\n\n\t\tthis.current.default = +(chan.section == 'default')\n\t\tthis.current.included = +chan.included\n\n\t\tthis.setMode('edit', chan.section)\n\n\t\t$('#chan-id').val(chan.id)\n\t\t$('#chan-name').val(chan.name).trigger('input')\n\t\t$('#chan-url').val(chan.url)\n\t\t$('#chan-wiki').val(chan.wiki || '')\n\t\t$('#chan-userboards').val(chan.userboards || '')\n\t\t$('#chan-userboards_catname').val(chan.userboards_catname || '2.0')\n\t\t$('#chan-userboards_system').val(chan.userboards_system || 'instant')\n\t\t\n\t\tball.setBall(chan)\n\n\t\tlet offset = chan.offset || [0, 0]\n\t\t$('#position-tweak-left').val(offset[0])\n\t\t$('#position-tweak-top').val(offset[1])\n\t\tball.offset()\n\n\t\t$('#bgc-from')[0].jscolor.fromString(chan.catbg[0])\n\t\t$('#bgc-to')[0].jscolor.fromString(chan.catbg[1])\n\t\tgradient.update()\n\n\t\t$('#chan-prefix').val(chan.prefix || '')\n\t\t$('#chan-postfix').val(chan.postfix || '')\n\n\t\ttree.build(chan.boards)\n\n\t\t$('#custom-css').prop('checked', !!chan.colors)\n\t\tif (chan.colors) {\n\t\t\t$('#color-theme').show()\n\t\t\t$('#bgColor')[0].jscolor.fromString(chan.colors[0])\n\t\t\t$('#linkColor')[0].jscolor.fromString(chan.colors[1])\n\t\t\tif (chan.advanced_less) {\n\t\t\t\t$('#advance-less').prop('checked', 1).trigger('change')\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(chan.advanced_less))\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(styles.base))\n\t\t\t\t$('#advance-less').prop('checked', 0).trigger('change')\n\t\t\t}\n\t\t\tstyles.update()\n\t\t}\n\t\telse {\n\t\t\tstyles.reset()\n\t\t}\n\t\t\n\t\tif (chan.radio) {\n\t\t\t$('#radio-editor').show()\n\t\t\tradio.build(chan.radio)\n\t\t\t$('#radio').prop('checked', true)\n\t\t}\n\t\telse {\n\t\t\tradio.reset()\n\t\t}\n\n\t\t$('#default').prop('checked', chan.section === 'default')\n\t\t$('#included').prop('checked', !!chan.included)\n\n\t\tthis.rinse()\n\t},\n\t_schema: {\n\t\tintegrity: {\n\t\t\trequired: ['id', 'name', 'url', 'boards', 'ball', 'offset', 'catbg'],\n\t\t\toptional: ['userboards', 'prefix', 'postfix', 'wiki', 'radio', 'colors', 'advanced_less', 'userboards_catname', 'userboards_system'],\n\t\t\tadminOnly: ['default', 'included']\n\t\t},\n\t\tspecialComps: {\n\t\t\tpairs: ['catbg', 'offset', 'colors'],\n\t\t\tobjects: ['boards', 'radio'],\n\t\t\tisNewBall: ['ball']\n\t\t},\n\t\tconversions: {\n\t\t\ttoFile: ['ball']\n\t\t},\n\t\tdefaults: {\n\t\t\t'': ['userboards', 'prefix', 'postfix', 'wiki'],\n\t\t\t'FFFFFF|FFFFFF': ['catbg'],\n\t\t\t'0|0': ['offset'],\n\t\t\t'2C333D|37C999': ['colors'],\n\t\t\t'2.0': ['userboards_catname'],\n\t\t\t'instant': ['userboards_system']\n\t\t},\n\t\tfns: {\n\t\t\tobjects: _.eq.bind(_),\n\t\t\tpairs: (first, second) => {\n\t\t\t\tlet vals = [first, second].map(val => (val instanceof Array) ? val.join('|').toLowerCase() : val)\n\t\t\t\treturn vals[0] === vals[1]\n\t\t\t},\n\t\t\tisNewBall: (cur, nu) => cur ? (nu===cur) : (nu==='default'),\n\t\t\ttoFile: v => v.indexOf('data:') === 0 ? v.toBlob() : v\n\t\t}\n\t},\n\tinit: function() {\n\t\tlet allProps = []\n\t\t, schema = {}\n\n\t\t_.each(this._schema.integrity, (props, intCls) => {\n\t\t\tprops.forEach(prop => {\n\t\t\t\tschema[prop] = {}\n\t\t\t\tschema[prop][intCls] = true\n\t\t\t\tif (intCls === 'optional')\n\t\t\t\t\tschema[prop].default = null\n\t\t\t})\n\t\t})\n\n\t\t_.each(this._schema.specialComps, (props, cmpCls) => {\n\t\t\tprops.forEach(prop => {\n\t\t\t\tschema[prop].eqFn = this._schema.fns[cmpCls]\n\t\t\t})\n\t\t})\n\n\t\t_.each(this._schema.conversions, (props, convCls) => {\n\t\t\tprops.forEach(prop => {\n\t\t\t\tschema[prop].conv = this._schema.fns[convCls]\n\t\t\t})\n\t\t})\n\n\t\t_.each(this._schema.defaults, (props, defCls) => {\n\t\t\tprops.forEach(prop => {\n\t\t\t\tschema[prop].default = defCls\n\t\t\t})\n\t\t})\n\n\t\t/*schema.offset.default = '0|0'\n\t\tschema.catbg.default = 'ffffff|ffffff'\n*/\n\t\tthis.schema = schema\n\t},\n\tmode: 'new',\n\tsetMode: function(mode, section) {\n\t\tthis.mode = mode\n\t\t$('body').toggleClass('edit-draft', mode === 'edit' && section === 'drafts')\n\t\t$('#chan-id, #save-draft').prop('disabled', mode === 'edit' && section !== 'drafts')\n\t\t$('#clone-this, #delete-this').prop('disabled', mode === 'new')\n\t},\n\trinse: () => {\n\t\t$('.tipper').setTipperState('question')\n\t\t$('input').removeClass('invalid')\n\t},\n\tcollectData: function(role) {\n\t\tlet isDraft = (role === 'draft')\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet chan = {}\n\t\t\t, dataPromises = []\n\t\t\t// basic data\n\t\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'userboards_catname', 'prefix', 'postfix'].forEach(prop => {\n\t\t\t\tlet pr = $(jq`#chan-${prop}`)[0].validate(0, isDraft).then(val => {\n\t\t\t\t\tchan[prop] = val\n\t\t\t\t})\n\t\t\t\tdataPromises.push(pr)\n\t\t\t})\n\t\t\t// ball data\n\t\t\tdataPromises.push(ball.getData(isDraft).then(data => {\n\t\t\t\t_.assign(chan, data)\n\t\t\t}))\n\t\t\t// tree data\n\t\t\tdataPromises.push(new Promise((resolve, reject) => {\n\t\t\t\tlet treeToUI = tree.toggleView('UI', isDraft)\n\t\t\t\tif (treeToUI)\n\t\t\t\t\tresolve(treeToUI)\n\t\t\t\telse {\n\t\t\t\t\tif (treeToUI === false)\n\t\t\t\t\t\treject()\n\t\t\t\t\telse {\n\t\t\t\t\t\tlet validUI = tree.validateUI(isDraft)\n\t\t\t\t\t\tif (validUI)\n\t\t\t\t\t\t\tresolve(validUI)\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\treject()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tchan.boards = (tree.toggleView('UI') === false) ? false : tree.validateUI()\n\t\t\t}).then(data => {\n\t\t\t\tchan.boards = data\n\t\t\t}))\n\t\t\tchan.userboards_system = $('#chan-userboards_system').val()\n\t\t\t// options: radio\n\t\t\tif ($('#radio').prop('checked')) {\n\t\t\t\tdataPromises.push(radio.getData(isDraft).then(data => {\n\t\t\t\t\tchan.radio = data\n\t\t\t\t}))\n\t\t\t}\n\t\t\t// options: styles\n\t\t\tif ($('#custom-css').prop('checked')) {\n\t\t\t\tdataPromises.push(styles.getData(isDraft).then(data => {\n\t\t\t\t\t_.assign(chan, data)\n\t\t\t\t}))\n\t\t\t}\n\t\t\t// options: admy\n\t\t\tif (IS_ADMIN) {\n\t\t\t\tlet admy = {}\n\t\t\t\t;['default', 'included'].forEach(prop => {\n\t\t\t\t\tadmy[prop] = +$(jq`#${prop}`).prop('checked')\n\t\t\t\t})\n\t\t\t\t_.assign(chan, admy)\n\t\t\t}\n\n\t\t\tPromise.all(dataPromises).then(() => resolve(chan), () => reject('fix-errors'))\n\t\t})\n\t},\n\tproceedWithData: function(role, isUpload) {\n\t\tlet mode = (isUpload && this.current && this.current.section === 'drafts') ? 'new' : this.mode\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet fd = new FormData(), chan = {}\n\t\t\t, errors = []\n\t\t\tthis.collectData(role).then(data => {\n\t\t\t\tif (mode === 'edit' && libchan.current.id !== data.id) {\n\t\t\t\t\terrors.push('id-changed')\n\t\t\t\t}\n\t\t\t\t_.each(this.schema, (propSchema, prop) => {\n\t\t\t\t\tlet val\n\n\t\t\t\t\tif (propSchema.adminOnly && !IS_ADMIN)\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tif (! data.hasOwnProperty(prop)) {\n\t\t\t\t\t\tif (propSchema.required)\n\t\t\t\t\t\t\terrors.push('fill-required-fields')\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tval = null\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tval = data[prop]\n\n\t\t\t\t\tif (mode === 'edit' && prop !== 'id') {\n\t\t\t\t\t\tlet cur = libchan.current.hasOwnProperty(prop) ? libchan.current[prop] : propSchema.default\n\t\t\t\t\t\tif (propSchema.eqFn ? propSchema.eqFn(cur, val) : (cur===val))\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\telse if (val === null)\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tchan[prop] = val\n\t\t\t\t\tif (role === 'upload') {\n\t\t\t\t\t\tif (propSchema.conv)\n\t\t\t\t\t\t\tval = propSchema.conv(val)\n\t\t\t\t\t\tfd.apnd(prop, val)\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tif (errors.length) {\n\t\t\t\t\treject(_.uniq(errors))\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (DO_DEBUG)\n\t\t\t\t\t\tconsole.log(chan)\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tobj: chan,\n\t\t\t\t\t\tfd: fd\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}, \n\t\t\terrors => {\n\t\t\t\treject(errors)\n\t\t\t})\n\t\t})\n\t},\n\tclone: function() {\n\t\tthis.setMode('new')\n\t\tball.toDataURL()\n\t\t$('#chan-id').val('')\n\t\t$('#chan-name')[0].value += ' ()'\n\t\t$('#chan-name').trigger('input')\n\t},\n\tclear: function() {\n\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'prefix', 'postfix']\n\t\t.forEach(field => $(jq`#chan-${field}`).val(''))\n\t\t$('#chan-userboards_catname').val('2.0')\n\t\tball.clear()\n\t\t;['from', 'to'].forEach(field => $(jq`#bgc-${field}`)[0].jscolor.fromString('ffffff'))\n\t\tgradient.update()\n\t\t;[radio, styles].forEach(w => w.reset())\n\t\ttree.build('[]')\n\t\ttree.toggleView('UI')\n\t\tthis.rinse()\n\t\tthis.current = null\n\t\tthis.setMode('new')\n\t\tupForm.toggle()\n\t}\n}\n\nvar drafts = {\n\tmodel: [],\n\tload: function() {\n\t\tlet lsDrafts = localStorage['mydrafts']\n\t\tif (lsDrafts) \n\t\t\ttry {\n\t\t\t\tlet parsed = JSON.parse(lsDrafts)\n\t\t\t\tif (typeof parsed !== 'object' || !parsed.hasOwnProperty('chans'))\n\t\t\t\t\tthrow new Error()\n\t\t\t\tthis.model = parsed.chans\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error('Drafts in localStorage are corrupted and will be purged')\n\t\t\t\tlocalStorage.removeItem('mydrafts')\n\t\t\t}\n\t\tlibrary.build(this.model, 'drafts')\n\t},\n\tremove: function(id) {\n\t\tthis.model.splice(_.findIndex(this.model, {id: id}), 1)\n\t\tlibrary.deleteChan(id)\n\t\tlibchan.setMode('new')\n\t\tthis.sync()\n\t},\n\tadd: function(chan, over) {\n\t\tlet libdata = library.addChan(chan, 'drafts', 1)\n\t\tthis.model.push(chan)\n\t\tlibchan.current = libdata\n\t\tlibchan.setMode('edit', 'drafts')\n\t},\n\tedit: function(chan) {\n\t\tlet edited = library.editChan(chan)\n\t\tthis.model[_.findIndex(this.model, {id: chan.id})] = edited\n\t},\n\tsync: function() {\n\t\tlocalStorage['mydrafts'] = JSON.stringify({\n\t\t\tchans: this.model,\n\t\t\tversion: new Date().getTime()\n\t\t})\n\t},\n\tsubmit: function(over) {\n\t\tlet newid = $('#chan-id').val()\n\t\tif (libchan.mode === 'edit' && libchan.current.id !== newid) {\n\t\t\t$(\"#id-to-change\").text(libchan.current.id)\n\t\t\tupForm.toggle('prompt pr-idchanged')\n\t\t\treturn\n\t\t}\n\t\telse if (libchan.mode === 'new' && _.find(this.model, {id: newid})) {\n\t\t\t$(\"#id-to-overwrite\").text(newid)\n\t\t\tlet guro = /(.+?)(\\d+)$/.exec(newid)\n\t\t\t$(\"#proposed-id\").text(guro ? `${guro[1]}${(+guro[2])+1}` : `${newid}2`)\n\t\t\tupForm.toggle('prompt pr-idexists')\n\t\t\treturn\n\t\t}\n\t\telse {\n\t\t\tupForm.toggle()\n\t\t}\n\t\tlibchan.proceedWithData('draft')\n\t\t.then(res => {\n\t\t\tlet draft = res.obj\n\t\t\tif (libchan.mode === 'edit') {\n\t\t\t\tthis.edit(draft)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.add(draft)\n\t\t\t}\n\t\t\tthis.sync()\n\t\t}, errors => {\n\t\t\tupForm.showErrors(errors)\n\t\t})\n\t}\n}\n\nlibchan.init()\n\nvar lessFormatter = {\n\tminify: less => less.replace(/\\n/g, ' ').replace(/\\s{2,}/g, ' ').trim(),\n\tprettify: function(less) {\n\t\treturn css_beautify(this.minify(less).replace(/([;{}])/g, '$1\\n').replace(/^\\s+/gm, '').trim(), {\n\t\t\t'indent_char': '\\t', \n\t\t\t'indent_size': 1, \n\t\t\t'newline_between_rules': false\n\t\t});\n\t}\n}\n\nvar validations = {\n\turlencode: val => encodeURI(val),\n\tcheckuniq: (val, prop) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif(libchan.mode === 'edit' && libchan.current[prop]===val) {\n\t\t\t\tresolve()\n\t\t\t\treturn\n\t\t\t}\n\t\t\t$.get(`api.php?checkuniq&prop=${prop}&val=${encodeURIComponent(val)}`)\n\t\t\t.then(data => {\n\t\t\t\tif (data.error)\n\t\t\t\t\treject('occupied')\n\t\t\t\telse \n\t\t\t\t\tresolve()\n\t\t\t})\n\t\t\t.fail(er => {\n\t\t\t\tconsole.error('XHR error during post-validation', er)\n\t\t\t\treject('XHR error')\n\t\t\t})\n\t\t})\n\t}\n}\n\n// eeeee prototypes\nNodeList.prototype.forEach = Array.prototype.forEach;\nNodeList.prototype.map = Array.prototype.map;\nFormData.prototype.apnd = function(k, v) {\n\tif (typeof v === 'object' && !( v instanceof Blob ))\n\t\tthis.append(k, JSON.stringify(v))\n\telse\n\t\tthis.append(k, v)\n}\nFormData.prototype.inspect = function() {\n\tfor (var pair of this.entries()) {\n\t\tconsole.log(pair[0]+ ' = ' + pair[1]); \n\t}\n}\n// Functions ooriginally from here:\n// http://stackoverflow.com/a/30407959/1561204\nBlob.prototype.readAsDataURL = function(callback) {\n\tlet fr = new FileReader();\n\tfr.onload = ev => callback(ev.target.result)\n\tfr.readAsDataURL(this);\n}\nString.prototype.toBlob = function() {\n\ttry {\n\t\tlet arr = this.split(','), mime = arr[0].match(/:(.*?);/)[1],\n\t\t\tbstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n\t\twhile(n--){\n\t\t\tu8arr[n] = bstr.charCodeAt(n);\n\t\t}\n\t\treturn new Blob([u8arr], {type:mime});\n\t}\n\tcatch (e) {\n\t\tconsole.error(e)\n\t\treturn false\n\t}\n}\n\n// https://davidwalsh.name/convert-image-data-uri-javascript\nfunction getDataUri(url, callback) {\n\tvar image = new Image();\n\n\timage.onload = function () {\n\t\tvar canvas = document.createElement('canvas');\n\t\tcanvas.width = this.naturalWidth;\n\t\tcanvas.height = this.naturalHeight;\n\t\tcanvas.getContext('2d').drawImage(this, 0, 0);\n\t\tcallback(canvas.toDataURL('image/png'));\n\t};\n\n\timage.src = url;\n}\n\nfunction mixedRange(input) {\n\tvar m\n\t, output = []\n\t, re = /(?:([0-9]+)(?:\\-([0-9]+))?(?:, ?)?)/g;\n\t\n\twhile ((m = re.exec(input)) !== null) {\n\t\tif (m.index === re.lastIndex) {\n\t\t\tre.lastIndex++;\n\t\t}\n\t\tif(m[2]) {\n\t\t\toutput = output.concat(_.range(m[1], +m[2]+1))\n\t\t}\n\t\telse\n\t\t\toutput.push(+m[1])\n\t}\n\n\treturn output\n}\n\nvar upForm = {\n\t$form: null,\n\tinit: function() {\n\t\tthis.$form = $('#upload-form').on('submit', this.submit.bind(this))\n\t\t_.each(this.actorFieldMap, (fields, actor) => {\n\t\t\tfields.forEach(field => this.fieldActorMap[field] = actor)\n\t\t})\n\t},\n\ttoggle: function(type) {\n\t\tif (! type)\n\t\t\tthis.$form.removeClass('expanded')\n\t\telse {\n\t\t\tthis.$form.removeClass('f-upload f-delete f-prompt pr-idchanged pr-idexists').addClass(`f-${type} expanded`)\n\t\t\tlet draftDelete = libchan.current && libchan.current.section === 'drafts' && type === 'delete'\n\t\t\t$('#upload-form input').prop('required', !draftDelete)\n\t\t\tif (!draftDelete && $('.captcha').hasClass('not-loaded'))\n\t\t\t\trefreshCaptcha()\n\t\t}\n\t},\n\tcheckFields: function() {\n\t\treturn $('#pswd').val() && $('#captcha').val()\n\t},\n\tsubmit: function(ev) {\n\t\tev.preventDefault()\n\t\tlet action = this.$form.hasClass('f-delete') ? 'delete' : 'upload'\n\t\tif (libchan.current && libchan.current.section === 'drafts') {\n\t\t\tif (action === 'delete') {\n\t\t\t\tdrafts.remove(libchan.current.id)\n\t\t\t\tthis.toggle()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t\tif (! this.checkFields()) \n\t\t\treturn this.showErrors('fill-required-fields')\n\t\tthis.$form.addClass('busy')\n\t\tif (action == 'upload') {\n\t\t\tlibchan.proceedWithData(action, true)\n\t\t\t.then(res => {\n\t\t\t\tthis.candidate = res.obj\n\t\t\t\tthis.send(libchan.mode, res.fd)\n\t\t\t}, errors => {\n\t\t\t\tthis.showErrors(errors)\n\t\t\t\tthis.$form.removeClass('busy')\n\t\t\t})\n\t\t}\n\t\telse {\n\t\t\tlet fd = new FormData()\n\t\t\t$('#chan-id')[0].validate(1).then(id => {\n\t\t\t\tfd.apnd('id', id)\n\t\t\t\tthis.candidate = {id: id}\n\t\t\t\tthis.send('delete', fd)\n\t\t\t}, \n\t\t\te => console.error(e))\n\t\t}\n\t},\n\tsend: function(action, fd) {\n\t\tif (libchan.current && libchan.current.section === 'drafts')\n\t\t\taction = 'new'\n\t\tfd.apnd('action', action)\n\t\tfd.apnd('captcha', $('#captcha').val())\n\t\tfd.apnd('password', $('#pswd').val())\n\t\tif (DO_DEBUG)\n\t\t\tfd.inspect()\n\n\t\tvar request = new XMLHttpRequest()\n\t\trequest.open(\"POST\", \"api.php\")\n\t\trequest.send(fd);\n\t\tlet _this = this\n\t\trequest.onload = function(e) {\n\t\t\tif(this.status == 200) {\n\t\t\t\tlet res = 0\n\t\t\t\ttry {\n\t\t\t\t\tres = JSON.parse(this.response)\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tconsole.error(e)\n\t\t\t\t\tconsole.warn(this.response)\n\t\t\t\t\t_this.unbusy()\n\t\t\t\t\t_this.showErrors('invalid-response')\n\t\t\t\t}\n\t\t\t\tif (res)\n\t\t\t\t\t_this.handleResponse(res)\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_this.unbusy()\n\t\t\t\t_this.showErrors('xhr-error')\n\t\t\t\tconsole.error(e)\n\t\t\t}\n\t\t}\n\t},\n\tshowErrors: mkErrorShower('submit'),\n\terrorDescriptors: {\n\t\t'fill-required-fields': '  ',\n\t\t'xhr-error': ' XHR.   .',\n\t\t'invalid-response': ' XHR (  ).   .',\n\t\t'id-changed': 'ID   .',\n\t\t'nothing-to-edit': ' ',\n\t\t'missing': '  ',\n\t\t'wrong-captcha': '  ',\n\t\t'wrong-password': ' ',\n\t\t'fix-errors': ' !',\n\t\t'db-error': '    ',\n\t\t'not-admin': ',   ',\n\t\t'wrong-value': ' ',\n\t\t'chan-does-not-exist': '   '\n\t},\n\tactorFieldMap: {\n\t\tball: ['ball', 'catbg', 'offset'],\n\t\tstyles: ['colors', 'advanced_less'],\n\t\ttree: ['boards'],\n\t\tradio: ['radio'],\n\t\tadmin: ['admin']\n\t},\n\tfieldActorMap: {},\n\tunbusy: function() {\n\t\tthis.$form.removeClass('busy')\n\t\trefreshCaptcha()\n\t},\n\thandleResponse: function(res) {\n\t\tthis.unbusy()\n\t\tif (res.error) {\n\t\t\tlet errors = res.error\n\t\t\tif (! (errors instanceof Array)) \n\t\t\t\terrors = [errors]\n\t\t\terrors = errors.map(err => {\n\t\t\t\tif (! err.field) {\n\t\t\t\t\terr = {\n\t\t\t\t\t\tfield: this,\n\t\t\t\t\t\tmsg: err\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tlet $input = $(jq`#chan-${err.field}`)\n\t\t\t\t\tif ($input.length && $input[0].showErrors) {\n\t\t\t\t\t\terr.field = $input[0]\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (this.fieldActorMap.hasOwnProperty(err.field)) {\n\t\t\t\t\t\t\terr.field = window[this.fieldActorMap[err.field]]\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\terr.field = this\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\t\t\t\t\n\t\t\t\treturn err\n\t\t\t})\n\t\t\tlet fields = _.uniq(_.pluck(errors, 'field'))\n\t\t\tif (! _.includes(fields, this)) {\n\t\t\t\terrors.push({\n\t\t\t\t\tfield: this,\n\t\t\t\t\tmsg: 'fix-errors'\n\t\t\t\t})\n\t\t\t\tfields.push(this)\n\t\t\t}\n\t\t\tfields.forEach(field => {\n\t\t\t\tlet messages = _.pluck(_.filter(errors, {field: field}), 'msg')\n\t\t\t\t.map(msg => this.errorDescriptors[msg] || msg)\n\t\t\t\tfield.showErrors(_.uniq(messages))\n\t\t\t})\n\t\t}\n\t\telse {\n\t\t\tthis.showErrors([])\n\t\t\tif (res.action === 'new-success') {\n\t\t\t\t// library.deleteChan(upForm.candidate.id)\n\t\t\t\tdrafts.remove(upForm.candidate.id)\n\t\t\t\tdelete this.candidate.ball\n\t\t\t\tlet sect = (this.candidate.section && this.candidate.section === 'default') ? 'default' : 'custom'\n\t\t\t\tlet added = library.addChan(this.candidate, sect, true)\n\t\t\t\tlibchan.load(added)\n\t\t\t\tconsole.log(upForm.candidate.id, this.candidate, sect);\n\t\t\t\t// libchan.setMode('edit', sect)\n\t\t\t}\n\t\t\tif (res.action === 'edit-success') {\n\t\t\t\tif (res.moveto) {\n\t\t\t\t\t// console.log(`Gotta move it to ${res.moveto}`);\n\t\t\t\t\tthis.candidate.section = res.moveto\n\t\t\t\t}\n\t\t\t\tlet edited = library.editChan(this.candidate)\n\t\t\t\tlibchan.load(edited)\n\t\t\t}\n\t\t\tif (res.action === 'delete-success') {\n\t\t\t\tlibrary.deleteChan(this.candidate.id)\n\t\t\t\tlibchan.setMode('new', 'draft')\n\t\t\t}\n\t\t\tthis.toggle()\n\t\t}\n\t}\n}\n\nconst DO_DEBUG = false;\n\nfunction makeEscapeTagLiteralFn(fn = v => v) {\n  return function(strings, ...values) {\n    let result = \"\"\n    for (let i = 0; i < strings.length; i++) {\n      result += strings[i]\n      if (i < values.length) {\n        result += fn(''+values[i])\n      }\n    }\n    return result\n  }\n}\n// Escape tag literal functions for jQuery queries and regular expressions\nvar jq = makeEscapeTagLiteralFn(v => v.replace(/([!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^`{|}~ ])/g, \"\\\\$1\"))\n, escHTML = makeEscapeTagLiteralFn(_.escape)\n\nfunction LSfetchJSON(key) {\n  let val = null, data = localStorage[key]\n  if (typeof data !== 'undefined') {\n    try {\n      val = JSON.parse(data)\n    }\n    catch(e) {\n      console.error(e)\n      localStorage.removeItem(key)\n    }\n  }\n  return val\n}\n\nfunction downloadJSON(obj, name) {\n\tvar dlAnchorElem = document.getElementById('dl-victim')\n\tdlAnchorElem.setAttribute(\"href\", \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(obj)))\n\tdlAnchorElem.setAttribute(\"download\", `${name}.json`)\n\tdlAnchorElem.click()\n}"]}